import{r as i,j as e,S as oe,R as pa,e as ma,b as ua,c as nt,s as ha,f as Ue,g as He,i as qe,h as Pt,k as Xe,l as $t,m as Dt,n as Ot,o as gt,p as ga,q as xa,t as ia,u as fa}from"./vendor-C_eiAwLH.js";import{X as ce,C as it,S as Je,D as rt,a as kt,F as vt,b as wt,P as _t,c as st,d as St,e as Ze,f as Qe,g as De,h as et,T as Bt,i as Ht,j as Gt,U as Vt,k as ba,l as ya,m as ja,B as Ut,L as Jt,n as Kt,o as jt,H as sa,p as oa,q as ka,r as la,R as va,E as wa,Z as Nt,M as qt,s as _a,t as Sa}from"./vendor-icons-DQC2_IQT.js";import{E as Ct,a as At}from"./vendor-jspdf-CwNpbytw.js";import{u as Ie,w as Tt}from"./vendor-xlsx-C2K9OxTh.js";(function(){const H=document.createElement("link").relList;if(H&&H.supports&&H.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))I(v);new MutationObserver(v=>{for(const O of v)if(O.type==="childList")for(const w of O.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&I(w)}).observe(document,{childList:!0,subtree:!0});function A(v){const O={};return v.integrity&&(O.integrity=v.integrity),v.referrerPolicy&&(O.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?O.credentials="include":v.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function I(v){if(v.ep)return;v.ep=!0;const O=A(v);fetch(v.href,O)}})();const Ke=({label:S,options:H,value:A,onChange:I,placeholder:v="Pilih...",searchPlaceholder:O="Cari...",disabled:w=!1,displayTop:G=!1,required:T=!1,containerStyle:Q={},hideValue:ae=!1})=>{const[ee,L]=i.useState(!1),[W,g]=i.useState(""),[x,u]=i.useState("bottom"),Y=i.useRef(null);i.useEffect(()=>{const p=z=>{Y.current&&!Y.current.contains(z.target)&&L(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]),i.useLayoutEffect(()=>{if(ee&&Y.current){const p=Y.current.getBoundingClientRect(),ke=window.innerHeight-p.bottom,pe=p.top;ke<300&&pe>ke?u("top"):u("bottom")}},[ee]);const xe=G?"top":x,V=H.filter(p=>(p.label||"").toLowerCase().includes(W.toLowerCase())||(p.value||"").toLowerCase().includes(W.toLowerCase())),k=H.find(p=>p.value===A);return e.jsxs("div",{className:"searchable-select-container",style:{position:"relative",width:"100%",marginBottom:S?"1rem":"0",...Q},ref:Y,children:[S&&e.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"var(--text-secondary)",fontSize:"0.875rem"},children:[S," ",T&&e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("div",{onClick:()=>!w&&L(!ee),style:{width:"100%",padding:S?"0.5rem 0.75rem":"0.5rem 0.5rem",borderRadius:"8px",border:"1px solid var(--border)",fontSize:"0.875rem",background:w?"#f8fafc":"white",cursor:w?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:S?"0.5rem":"0.25rem",minHeight:"42px",transition:"all 0.2s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",overflow:"hidden"},children:[e.jsx("span",{style:{flex:1,minWidth:0,color:A?"var(--text-primary)":"#94a3b8",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:k?ae?k.label||k.value:k.label&&k.label!==k.value?`${k.value} - ${k.label}`:k.value:v}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[A&&!w&&e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),I({target:{value:""}}),L(!1)},style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:"#94a3b8",display:"flex",alignItems:"center",borderRadius:"50%",transition:"background 0.2s"},onMouseEnter:p=>p.currentTarget.style.background="#f1f5f9",onMouseLeave:p=>p.currentTarget.style.background="none",children:e.jsx(ce,{size:14})}),e.jsx(it,{size:16,style:{color:"#94a3b8",transform:ee?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),ee&&e.jsxs("div",{style:{position:"absolute",[xe==="top"?"bottom":"top"]:"100%",left:0,right:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"8px",[xe==="top"?"marginBottom":"marginTop"]:"4px",boxShadow:xe==="top"?"0 -10px 15px -3px rgba(0, 0, 0, 0.1)":"0 10px 15px -3px rgba(0, 0, 0, 0.1)",overflow:"hidden",animation:xe==="top"?"fadeInUp 0.15s ease-out":"fadeIn 0.1s ease-out"},children:[e.jsx("div",{style:{padding:"0.5rem",borderBottom:"1px solid #f1f5f9",background:"#f8fafc"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Je,{size:14,style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:O,value:W,onChange:p=>g(p.target.value),onClick:p=>p.stopPropagation(),style:{width:"100%",padding:"0.4rem 0.5rem 0.4rem 2rem",borderRadius:"6px",border:"1px solid var(--border)",fontSize:"0.8125rem",outline:"none"}})]})}),e.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto"},children:[V.map(p=>e.jsx("div",{onClick:z=>{z.stopPropagation(),I({target:{value:p.value}}),L(!1),g("")},style:{padding:"0.625rem 0.75rem",cursor:"pointer",fontSize:"0.8125rem",borderBottom:"1px solid #f8fafc",background:A===p.value?"#f0f9ff":"white",color:A===p.value?"var(--primary)":"var(--text-primary)",transition:"background 0.2s"},onMouseEnter:z=>z.currentTarget.style.background="#f8fafc",onMouseLeave:z=>z.currentTarget.style.background=A===p.value?"#f0f9ff":"white",children:ae?e.jsx("div",{style:{fontWeight:600},children:p.label||p.value}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontWeight:600},children:p.value}),p.label&&e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:p.label})]})},p.value)),V.length===0&&e.jsx("div",{style:{padding:"1.5rem",textAlign:"center",color:"#94a3b8",fontSize:"0.8125rem"},children:"Data tidak ditemukan"})]})]})]})},It="./api/customers.php",xt="http://localhost",ft=[{id:"id_sambungan",label:"NO. SAMBUNGAN"},{id:"nomor_urut",label:"NO. URUT"},{id:"id_meter",label:"ID METER"},{id:"id_tag",label:"ID TAG"},{id:"foto_rumah",label:"FOTO RUMAH"},{id:"foto_meter",label:"FOTO METER"},{id:"nama",label:"NAMA PELANGGAN"},{id:"alamat",label:"ALAMAT"},{id:"koordinat",label:"KOORDINAT"},{id:"telepon",label:"TELEPON"},{id:"kode_tarif",label:"TARIF"},{id:"kode_rute",label:"RUTE"},{id:"kode_cabang",label:"CABANG"},{id:"kode_kecamatan",label:"KEC"},{id:"kode_desa",label:"DESA"},{id:"kode_rw",label:"RW"},{id:"kode_rt",label:"RT"},{id:"active_date",label:"TANGGAL AKTIF"}],Xt=["id_sambungan","nomor_urut","id_meter","id_tag","foto_rumah","foto_meter","nama","alamat","telepon","kode_tarif","kode_rute","kode_cabang","kode_kecamatan","kode_desa","kode_rw","kode_rt","active_date"];function Ca(){const[S,H]=i.useState([]),[A,I]=i.useState(!0),[v,O]=i.useState(""),[w,G]=i.useState(!1),[T,Q]=i.useState(null),[ae,ee]=i.useState([]),[L,W]=i.useState([]),[g,x]=i.useState([]),[u,Y]=i.useState([]),[xe,V]=i.useState([]),[k,p]=i.useState([]),[z,ke]=i.useState([]),[pe,fe]=i.useState({kec:null,desa:null,rw:null}),[me,Ae]=i.useState(!1),[Ce,Fe]=i.useState(!1),se=i.useRef(null),Pe=i.useRef(null),[y,F]=i.useState(()=>{const n=localStorage.getItem("pdam_visible_columns_v4");return n?JSON.parse(n):Xt}),[U,J]=i.useState(Number(localStorage.getItem("pdam_current_page"))||1),[le,Me]=i.useState(Number(localStorage.getItem("pdam_items_per_page"))||10),[ue,We]=i.useState("nama"),[je,Ee]=i.useState(null),[ve,E]=i.useState(null),[be,ye]=i.useState(null),[q,Te]=i.useState({meter:!1,rumah:!1}),[$e,we]=i.useState(0),[ze,_e]=i.useState(null),[o,_]=i.useState(null),[s,R]=i.useState({id_sambungan:"",id_meter:"",id_tag:"",nama:"",alamat:"",telepon:"",kode_tarif:"",kode_rute:"",kode_cabang:"",kode_kecamatan:"",kode_desa:"",kode_rw:"",kode_rt:"",nomor_urut:"",longitude:"",latitude:"",active_date:"",foto_meter:"",foto_rumah:""}),K=async()=>{try{I(!0);const j=await(await fetch(It)).json();H(j)}catch(n){console.error("Failed to fetch customers:",n)}finally{I(!1)}},Z=async(n,j={})=>{let N=`./api/zones.php?${new URLSearchParams({type:n,...j}).toString()}`;try{return await(await fetch(N)).json()}catch(B){return console.error(`Failed to fetch ${n}:`,B),[]}},r=async(n,j={})=>{const M=new URLSearchParams({type:n,...j});try{return await(await fetch(`./api/options.php?${M.toString()}`)).json()}catch(N){return console.error(`Failed to fetch ${n}:`,N),[]}};i.useEffect(()=>{localStorage.setItem("pdam_current_page",U)},[U]),i.useEffect(()=>{localStorage.setItem("pdam_items_per_page",le)},[le]),i.useEffect(()=>{localStorage.setItem("pdam_visible_columns_v2",JSON.stringify(y))},[y]),i.useEffect(()=>{function n(j){se.current&&!se.current.contains(j.target)&&Ae(!1),Pe.current&&!Pe.current.contains(j.target)&&Fe(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),i.useEffect(()=>{K(),Z("kecamatan").then(ee),r("tarif").then(V),r("rute").then(p),r("cabang").then(ke)},[]),i.useEffect(()=>{w&&T?(T.kode_kecamatan&&Z("desa",{kec_kode:T.kode_kecamatan}).then(W),T.kode_desa&&Z("rw",{kec_kode:T.kode_kecamatan,desa_kode:T.kode_desa}).then(x),T.kode_rw&&Z("rt",{kec_kode:T.kode_kecamatan,desa_kode:T.kode_desa,rw_kode:T.kode_rw}).then(Y),T.kode_cabang&&r("rute",{kode_cabang:T.kode_cabang}).then(p)):w||(W([]),x([]),Y([]),r("rute").then(p))},[w,T]);const h=(n=null)=>{n?(Q(n),R({...n}),Ee(n.foto_meter||null),E(n.foto_rumah||null),_e(null),_(null)):(Q(null),R({id_sambungan:"",id_meter:"",id_tag:"",nama:"",alamat:"",telepon:"",kode_tarif:"",kode_rute:"",kode_cabang:"",kode_kecamatan:"",kode_desa:"",kode_rw:"",kode_rt:"",nomor_urut:"",longitude:"",latitude:"",active_date:"",foto_meter:"",foto_rumah:""}),Ee(null),E(null),_e(null),_(null)),G(!0)},c=()=>{G(!1),Q(null),Ee(null),E(null),_e(null),_(null),Te({meter:!1,rumah:!1}),we(0)},$=(n,j="foto_meter")=>{const M=n.target.files[0];if(M){const N=j==="foto_rumah"?"rumah":"meter";Te(ge=>({...ge,[N]:!0})),we(0);const B=new FileReader;let ne=0;const re=setInterval(()=>{ne+=Math.random()*30,ne>=100&&(ne=100,clearInterval(re),B.onloadend=()=>{j==="foto_rumah"?(E(B.result),_(M)):(Ee(B.result),_e(M)),setTimeout(()=>{Te(ge=>({...ge,[N]:!1})),we(0)},500)},B.readAsDataURL(M)),we(ne)},100)}},X=async n=>{if(n.preventDefault(),q.meter||q.rumah)return;const j=new FormData;Object.keys(s).forEach(N=>{N!=="foto_meter"&&N!=="foto_rumah"&&j.append(N,s[N]||"")}),ze?j.append("foto_meter",ze):s.foto_meter&&j.append("foto_meter",s.foto_meter),o?j.append("foto_rumah",o):s.foto_rumah&&j.append("foto_rumah",s.foto_rumah);const M=T?`${It}?id=${T.id}`:It;try{oe.fire({title:"Menyimpan Data...",text:"Mohon tunggu sebentar",allowOutsideClick:!1,didOpen:()=>{oe.showLoading()}});const B=await(await fetch(M,{method:"POST",body:j})).json();B.message?(oe.fire({title:"Berhasil!",text:"Data pelanggan berhasil disimpan.",icon:"success",timer:1500,showConfirmButton:!1}),K(),c()):oe.fire("Gagal!",B.error||"Terjadi kesalahan saat menyimpan.","error")}catch(N){console.error("Save failed:",N),oe.fire("Error!","Gagal menghubungi server.","error")}},D=async n=>{if((await oe.fire({title:"Hapus Pelanggan?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#64748b",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{(await(await fetch(`${It}?id=${n}`,{method:"DELETE"})).json()).message&&(oe.fire({title:"Berhasil!",text:"Data pelanggan telah dihapus.",icon:"success",timer:1500,showConfirmButton:!1}),K())}catch(M){console.error("Delete failed:",M),oe.fire("Error!","Gagal menghapus data.","error")}},te=S.filter(n=>{const j=v.toLowerCase().trim();return j?ue==="kode"?(n.kode_kecamatan?.toLowerCase()||"").includes(j)||(n.kode_desa?.toLowerCase()||"").includes(j)||(n.kode_rw?.toLowerCase()||"").includes(j)||(n.kode_rt?.toLowerCase()||"").includes(j)||(n.nomor_urut?.toLowerCase()||"").includes(j):({nama:n.nama,rute:n.kode_rute,id_pelanggan:n.id_sambungan,tag:n.id_tag,meter:n.id_meter}[ue]?.toLowerCase()||"").includes(j):!0});i.useEffect(()=>{J(1)},[v,le]);const he=Math.ceil(te.length/le),Oe=U*le,Ge=Oe-le,Ye=te.slice(Ge,Oe),tt=()=>{let n=[],M=Math.max(1,U-2),N=Math.min(he,M+5-1);N-M+1<5&&(M=Math.max(1,N-5+1));for(let B=M;B<=N;B++)n.push(B);return n},ot=()=>{const n=ft.filter(ge=>y.includes(ge.id)&&ge.id!=="foto_rumah"&&ge.id!=="foto_meter"),j=n.map(ge=>ge.label),M=te.map(ge=>n.map(Re=>Re.id==="koordinat"?ge.latitude&&ge.longitude?`${ge.latitude}, ${ge.longitude}`:"-":ge[Re.id]||"-")),N=[j,...M].map(ge=>ge.map(Re=>`"${Re}"`).join(",")).join(`
`),B=new Blob([N],{type:"text/csv;charset=utf-8;"}),ne=URL.createObjectURL(B),re=document.createElement("a");re.setAttribute("href",ne),re.setAttribute("download",`data_pelanggan_${new Date().toISOString().split("T")[0]}.csv`),re.style.visibility="hidden",document.body.appendChild(re),re.click(),document.body.removeChild(re)},ct=()=>{const n=ft.filter(B=>y.includes(B.id)&&B.id!=="foto_rumah"&&B.id!=="foto_meter"),j=te.map(B=>{const ne={};return n.forEach(re=>{re.id==="koordinat"?ne[re.label]=B.latitude&&B.longitude?`${B.latitude}, ${B.longitude}`:"-":ne[re.label]=B[re.id]||"-"}),ne}),M=Ie.json_to_sheet(j),N=Ie.book_new();Ie.book_append_sheet(N,M,"Pelanggan"),Tt(N,`data_pelanggan_${new Date().toISOString().split("T")[0]}.xlsx`)},pt=()=>{try{const n=new Ct("l","mm","a4"),j=new Date().toLocaleString("id-ID");n.setFontSize(18),n.setTextColor(14,165,233),n.text("Laporan Data Pelanggan PDAM",14,15),n.setFontSize(10),n.setTextColor(100),n.text(`Jumlah Total: ${te.length} Pelanggan`,14,22),n.text(`Waktu Cetak: ${j}`,280,22,{align:"right"});const M=ft.filter(ne=>y.includes(ne.id)&&ne.id!=="foto_rumah"&&ne.id!=="foto_meter"),N=["No",...M.map(ne=>ne.label)],B=te.map((ne,re)=>[re+1,...M.map(ge=>ge.id==="koordinat"?ne.latitude&&ne.longitude?`${ne.latitude}, ${ne.longitude}`:"-":ne[ge.id]||"-")]);At(n,{head:[N],body:B,startY:28,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"},margin:{left:10,right:10}}),n.save(`data_pelanggan_${new Date().toISOString().split("T")[0]}.pdf`)}catch(n){console.error("PDF Export Error:",n),alert("Gagal mengekspor PDF. Pastikan library tersedia.")}},mt=()=>{window.print()};return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .customer-table thead th {
                        position: sticky;
                        top: 0;
                        z-index: 30;
                        background: #f1f5f9 !important;
                        box-shadow: 0 2px 4px -1px rgba(0,0,0,0.06);
                        border-bottom: 2px solid var(--border) !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) td {
                        background-color: #f8fafc;
                    }
                    .customer-table tbody tr:hover td {
                        background-color: #f1f5f9 !important;
                    }
                    .customer-table td, .customer-table th {
                        padding: 0.625rem 0.75rem !important;
                        vertical-align: middle;
                        font-size: 0.875rem;
                    }
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left,
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #f8fafc !important;
                    }

                    @media print {
                        .no-print, .no-print * {
                            display: none !important;
                        }
                        
                        body {
                            background: white !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .card {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .table-container {
                            overflow: visible !important;
                            max-height: none !important;
                            width: 100% !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .customer-table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            table-Layout: auto !important;
                            font-size: 8pt !important;
                        }

                        .customer-table th, .customer-table td {
                            border: 1px solid #e2e8f0 !important;
                            padding: 4pt !important;
                            overflow: visible !important;
                            white-space: normal !important;
                            word-break: break-word !important;
                            min-width: 0 !important;
                            width: auto !important;
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .sticky-col-left, .sticky-col-right {
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        @page {
                            size: landscape;
                            margin: 1cm;
                        }

                        header.header {
                            margin-bottom: 1rem !important;
                        }

                        h1 {
                            font-size: 16pt !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.875rem"},children:[e.jsx(rt,{size:32,color:"var(--primary)"}),"Data Pelanggan"]}),e.jsx("p",{style:{color:"var(--text-light)",marginTop:"0.25rem"},children:"Management Data Pelanggan PDAM"})]}),e.jsxs("div",{className:"header-actions no-print",children:[e.jsx("button",{className:"btn btn-outline",onClick:ot,title:"Export CSV",style:{padding:"0.5rem"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:ct,title:"Export Excel",style:{padding:"0.5rem"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:pt,title:"Export PDF",style:{padding:"0.5rem"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:mt,title:"Print",style:{padding:"0.5rem"},children:e.jsx(_t,{size:18})}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>h(),style:{whiteSpace:"nowrap"},children:[e.jsx(st,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Pelanggan"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flex:1,minWidth:"min-content",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative"},ref:se,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>Ae(!me),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",background:me?"#f1f5f9":"#f8fafc",border:`1px solid ${me?"var(--primary)":"var(--border)"}`,color:me?"var(--primary)":"var(--text)",borderRadius:"10px"},children:[e.jsx(St,{size:18}),e.jsx("span",{style:{fontWeight:500},children:"Pilih Kolom"})]}),me&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px",maxHeight:"450px",overflowY:"auto",animation:"fadeIn 0.2s ease-out"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",color:"var(--text)",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem"},children:ft.map(n=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px",transition:"background 0.2s"},onMouseEnter:j=>j.currentTarget.style.background="#f8fafc",onMouseLeave:j=>j.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:y.includes(n.id),onChange:()=>{F(j=>j.includes(n.id)?j.filter(M=>M!==n.id):[...j,n.id])}}),e.jsx("span",{style:{color:y.includes(n.id)?"var(--text)":"var(--text-light)",fontWeight:y.includes(n.id)?500:400},children:n.label})]},n.id))}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",gap:"1rem"},children:[e.jsx("button",{style:{background:"none",border:"none",color:"var(--primary)",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>F(ft.map(n=>n.id)),onMouseEnter:n=>n.currentTarget.style.background="rgba(14, 165, 233, 0.05)",onMouseLeave:n=>n.currentTarget.style.background="none",children:"Pilih Semua"}),e.jsx("button",{style:{background:"none",border:"none",color:"#64748b",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>F(Xt),onMouseEnter:n=>n.currentTarget.style.background="#f1f5f9",onMouseLeave:n=>n.currentTarget.style.background="none",children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:Pe,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>Fe(!Ce),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",background:Ce?"#f1f5f9":"#f8fafc",border:`1px solid ${Ce?"var(--primary)":"var(--border)"}`,color:Ce?"var(--primary)":"var(--text)",borderRadius:"10px",minWidth:"100px"},children:[e.jsx("span",{style:{fontWeight:600},children:"Filter"}),e.jsx(it,{size:16,style:{transform:Ce?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),Ce&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px",animation:"fadeIn 0.2s ease-out"},children:[{id:"nama",label:"By Nama"},{id:"kode",label:"By Kode Area"},{id:"rute",label:"By Rute"},{id:"id_pelanggan",label:"By ID. Pelanggan"},{id:"tag",label:"By ID. Tag"},{id:"meter",label:"By No. Meter"}].map(n=>e.jsx("button",{onClick:()=>{We(n.id),Fe(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:ue===n.id?"#f1f5f9":"none",color:ue===n.id?"var(--primary)":"var(--text)",borderRadius:"8px",fontSize:"0.875rem",fontWeight:ue===n.id?600:400,cursor:"pointer",transition:"background 0.2s"},onMouseEnter:j=>{ue!==n.id&&(j.currentTarget.style.background="#f8fafc")},onMouseLeave:j=>{ue!==n.id&&(j.currentTarget.style.background="none")},children:n.label},n.id))})]}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(Je,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:v?"2.5rem":"0.625rem",height:"42px",borderRadius:"10px",border:"1px solid var(--border)",background:"#f8fafc"},placeholder:"Ketik kata kunci pencarian...",value:v,onChange:n=>O(n.target.value)}),v&&e.jsx("button",{onClick:()=>O(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",padding:"4px",cursor:"pointer",color:"var(--text-light)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%"},onMouseEnter:n=>n.currentTarget.style.background="#f1f5f9",onMouseLeave:n=>n.currentTarget.style.background="none",title:"Bersihkan pencarian",children:e.jsx(ce,{size:16})})]})]}),!A&&te.length>0&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:U===1,onClick:()=>J(n=>Math.max(1,n-1)),children:e.jsx(Ze,{size:16})}),e.jsxs("span",{style:{fontSize:"0.875rem"},children:["Halaman ",e.jsx("strong",{children:U})," dari ",he]}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:U===he,onClick:()=>J(n=>Math.min(he,n+1)),children:e.jsx(Qe,{size:16})})]})]}),A?e.jsx("div",{style:{padding:"4rem",textAlign:"center",color:"var(--text-light)"},children:"Loading customers..."}):e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:e.jsxs("table",{className:"customer-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"60px",textAlign:"center"},children:"NO"}),y.includes("id_sambungan")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"No. Sambungan"}),y.includes("nomor_urut")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"No. Urut"}),y.includes("id_meter")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID Meter"}),y.includes("id_tag")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID Tag"}),y.includes("foto_rumah")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"FOTO RUMAH"}),y.includes("foto_meter")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"FOTO METER"}),y.includes("nama")&&e.jsx("th",{style:{width:"200px",minWidth:"200px",textAlign:"left"},children:"Nama Pelanggan"}),y.includes("alamat")&&e.jsx("th",{style:{width:"250px",minWidth:"250px",textAlign:"left"},children:"Alamat"}),y.includes("koordinat")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"Koordinat"}),y.includes("telepon")&&e.jsx("th",{style:{width:"130px",minWidth:"130px",textAlign:"left"},children:"Telepon"}),y.includes("kode_tarif")&&e.jsx("th",{style:{width:"70px",minWidth:"70px",textAlign:"center"},children:"Tarif"}),y.includes("kode_rute")&&e.jsx("th",{style:{width:"90px",minWidth:"90px",textAlign:"center"},children:"Rute"}),y.includes("kode_cabang")&&e.jsx("th",{style:{width:"70px",minWidth:"70px",textAlign:"center"},children:"Cabang"}),y.includes("kode_kecamatan")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"Kec"}),y.includes("kode_desa")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"Desa"}),y.includes("kode_rw")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"RW"}),y.includes("kode_rt")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"RT"}),y.includes("active_date")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"Tanggal Aktif"}),e.jsx("th",{className:"no-print sticky-col-right",style:{width:"100px",minWidth:"100px",textAlign:"center",background:"#f8fafc",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Aksi"})]})}),e.jsx("tbody",{children:Ye.length>0?Ye.map((n,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{textAlign:"center",fontWeight:500,color:"#64748b",padding:"0.625rem 0.75rem"},children:(U-1)*le+j+1}),y.includes("id_sambungan")&&e.jsx("td",{style:{fontWeight:600,width:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.id_sambungan}),y.includes("nomor_urut")&&e.jsx("td",{style:{width:"100px",textAlign:"center"},children:n.nomor_urut}),y.includes("id_meter")&&e.jsx("td",{style:{width:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.id_meter}),y.includes("id_tag")&&e.jsx("td",{style:{width:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.id_tag}),y.includes("foto_rumah")&&e.jsx("td",{style:{width:"100px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:n.foto_rumah?"pointer":"default"},onClick:()=>n.foto_rumah&&ye(n.foto_rumah),title:n.foto_rumah?"Klik untuk memperbesar":"Tidak ada foto rumah",children:n.foto_rumah?e.jsx("img",{src:n.foto_rumah&&n.foto_rumah.startsWith("/")?`${xt}${n.foto_rumah}`:n.foto_rumah,alt:"Foto Rumah",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(De,{size:18})})}),y.includes("foto_meter")&&e.jsx("td",{style:{width:"100px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:n.foto_meter?"pointer":"default"},onClick:()=>n.foto_meter&&ye(n.foto_meter),title:n.foto_meter?"Klik untuk memperbesar":"Tidak ada foto meter",children:n.foto_meter?e.jsx("img",{src:n.foto_meter&&n.foto_meter.startsWith("/")?`${xt}${n.foto_meter}`:n.foto_meter,alt:"Foto Meter",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(rt,{size:18})})}),y.includes("nama")&&e.jsx("td",{style:{width:"200px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n.nama,children:n.nama}),y.includes("alamat")&&e.jsx("td",{style:{width:"250px",maxWidth:"250px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n.alamat,children:n.alamat}),y.includes("koordinat")&&e.jsx("td",{style:{width:"150px"},children:n.latitude&&n.longitude?e.jsx("a",{href:`https://www.google.com/maps?q=${n.latitude},${n.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",fontWeight:500,textDecoration:"underline",fontSize:"0.75rem"},title:"Buka di Google Maps",children:e.jsxs("span",{style:{letterSpacing:"-0.02em"},children:[n.latitude,", ",n.longitude]})}):"-"}),y.includes("telepon")&&e.jsx("td",{style:{width:"130px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.telepon}),y.includes("kode_tarif")&&e.jsx("td",{style:{width:"70px",textAlign:"center"},children:n.kode_tarif}),y.includes("kode_rute")&&e.jsx("td",{style:{width:"90px",textAlign:"center"},children:n.kode_rute}),y.includes("kode_cabang")&&e.jsx("td",{style:{width:"70px",textAlign:"center"},children:n.kode_cabang}),y.includes("kode_kecamatan")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_kecamatan}),y.includes("kode_desa")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_desa}),y.includes("kode_rw")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_rw}),y.includes("kode_rt")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_rt}),y.includes("active_date")&&e.jsx("td",{style:{width:"120px",whiteSpace:"nowrap",textAlign:"left"},children:n.active_date}),e.jsx("td",{className:"no-print sticky-col-right",style:{textAlign:"center",background:"inherit",padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px"},onClick:()=>h(n),children:e.jsx(et,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px",color:"#ef4444"},onClick:()=>D(n.id),children:e.jsx(Bt,{size:14})})]})})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:y.length+2,style:{textAlign:"center",padding:"3rem",color:"var(--text-light)"},children:y.length===0?"Pilih setidaknya satu kolom untuk menampilkan data.":"Tidak ada data ditemukan."})})})]})}),!A&&te.length>0&&e.jsxs("div",{className:"no-print",style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:["Menampilkan ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Ge+1})," sampai ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Math.min(Oe,te.length)})," dari ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:te.length})," pelanggan"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",marginBottom:0},children:"Baris per halaman:"}),e.jsx("select",{value:le,onChange:n=>Me(Number(n.target.value)),style:{width:"auto",padding:"0.25rem 0.5rem",height:"auto"},children:[10,25,50,100].map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:U===1,onClick:()=>J(1),children:e.jsx(Ht,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:U===1,onClick:()=>J(n=>Math.max(1,n-1)),children:e.jsx(Ze,{size:18})}),tt().map(n=>e.jsx("button",{className:`btn ${U===n?"btn-primary":"btn-outline"}`,style:{minWidth:"36px",height:"36px",padding:0,justifyContent:"center"},onClick:()=>J(n),children:n},n)),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:U===he,onClick:()=>J(n=>Math.min(he,n+1)),children:e.jsx(Qe,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:U===he,onClick:()=>J(he),children:e.jsx(Gt,{size:18})})]})]})]})]}),w&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{paddingBottom:"3rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:0},children:[T?e.jsx(et,{size:24}):e.jsx(st,{size:24}),T?"Edit Pelanggan":"Tambah Pelanggan Baru"]}),e.jsx("button",{onClick:c,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s",marginTop:"-0.5rem",marginRight:"-0.5rem"},onMouseEnter:n=>n.currentTarget.style.color="#64748b",onMouseLeave:n=>n.currentTarget.style.color="#94a3b8",children:e.jsx(ce,{size:24})})]}),e.jsxs("form",{onSubmit:X,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"2rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"12px",border:"3px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",background:"#f8fafc",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",cursor:je?"pointer":"default"},onClick:()=>je&&ye(je),title:je?"Klik untuk memperbesar":"Belum ada foto meter",children:je?e.jsx("img",{src:je&&je.startsWith("/")?`${xt}${je}`:je,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{textAlign:"center",color:"#94a3b8"},children:[e.jsx(rt,{size:40}),e.jsx("p",{style:{fontSize:"0.65rem",marginTop:"0.25rem",fontWeight:600},children:"FOTO METER"})]})}),e.jsxs("label",{style:{position:"absolute",bottom:"4px",right:"4px",background:q.meter?"#94a3b8":"var(--primary)",color:"white",padding:"0.625rem",borderRadius:"8px",cursor:q.meter?"not-allowed":"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",transition:"all 0.2s"},children:[q.meter?e.jsx("div",{className:"animate-spin",style:{width:"16px",height:"16px",border:"2px solid white",borderTopColor:"transparent",borderRadius:"50%"}}):e.jsx(Vt,{size:16}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:n=>$(n,"foto_meter"),disabled:q.meter})]})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"12px",border:"3px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",background:"#f8fafc",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",cursor:ve?"pointer":"default"},onClick:()=>ve&&ye(ve),title:ve?"Klik untuk memperbesar":"Belum ada foto rumah",children:ve?e.jsx("img",{src:ve&&ve.startsWith("/")?`${xt}${ve}`:ve,alt:"Preview Rumah",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{textAlign:"center",color:"#94a3b8"},children:[e.jsx(De,{size:40}),e.jsx("p",{style:{fontSize:"0.65rem",marginTop:"0.25rem",fontWeight:600},children:"FOTO RUMAH"})]})}),e.jsxs("label",{style:{position:"absolute",bottom:"4px",right:"4px",background:q.rumah?"#94a3b8":"var(--primary)",color:"white",padding:"0.625rem",borderRadius:"8px",cursor:q.rumah?"not-allowed":"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",transition:"all 0.2s"},children:[q.rumah?e.jsx("div",{className:"animate-spin",style:{width:"16px",height:"16px",border:"2px solid white",borderTopColor:"transparent",borderRadius:"50%"}}):e.jsx(Vt,{size:16}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:n=>$(n,"foto_rumah"),disabled:q.rumah})]})]}),(q.meter||q.rumah)&&e.jsx("div",{style:{position:"absolute",bottom:"-15px",left:"50%",transform:"translateX(-50%)",width:"200px",height:"6px",background:"#f1f5f9",borderRadius:"3px",overflow:"hidden",border:"1px solid #e2e8f0"},children:e.jsx("div",{style:{height:"100%",width:`${$e}%`,background:"var(--primary)",transition:"width 0.1s linear"}})})]}),e.jsxs("div",{className:"grid-6-col-responsive",children:[e.jsx("div",{style:{gridColumn:"span 6",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("h3",{style:{fontSize:"1rem",color:"var(--primary)"},children:"Informasi Identitas"})}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 4"},children:[e.jsx("label",{children:"Nama Lengkap"}),e.jsx("input",{required:!0,value:s.nama,onChange:n=>R({...s,nama:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"ID Sambungan"}),e.jsx("input",{required:!0,value:s.id_sambungan,onChange:n=>R({...s,id_sambungan:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Telepon"}),e.jsx("input",{value:s.telepon,onChange:n=>R({...s,telepon:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"ID Meter"}),e.jsx("input",{value:s.id_meter,onChange:n=>R({...s,id_meter:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"ID Tag"}),e.jsx("input",{value:s.id_tag,onChange:n=>R({...s,id_tag:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Active Date"}),e.jsx("input",{type:"date",value:s.active_date,onChange:n=>R({...s,active_date:n.target.value})})]}),e.jsx("div",{style:{gridColumn:"span 6",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",marginTop:"1rem",marginBottom:"0.5rem"},children:e.jsx("h3",{style:{fontSize:"1rem",color:"var(--primary)"},children:"Informasi Alamat & Lokasi"})}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 6"},children:[e.jsx("label",{children:"Alamat Lengkap"}),e.jsx("textarea",{rows:"2",value:s.alamat,onChange:n=>R({...s,alamat:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Longitude"}),e.jsx("input",{value:s.longitude,onChange:n=>R({...s,longitude:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Latitude"}),e.jsx("input",{value:s.latitude,onChange:n=>R({...s,latitude:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Nomor Urut"}),e.jsx("input",{value:s.nomor_urut,onChange:n=>R({...s,nomor_urut:n.target.value})})]}),e.jsx("div",{style:{gridColumn:"span 6",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",marginTop:"1rem",marginBottom:"0.5rem"},children:e.jsx("h3",{style:{fontSize:"1rem",color:"var(--primary)"},children:"Kode Area & Klasifikasi"})}),e.jsx(Ke,{label:"Tarif",containerStyle:{gridColumn:"span 2",marginBottom:0},options:xe.map(n=>({value:n.kode_tarif,label:n.tarif})),value:s.kode_tarif,onChange:n=>R({...s,kode_tarif:n.target.value}),placeholder:"Pilih Tarif",searchPlaceholder:"Cari tarif..."}),e.jsx(Ke,{label:"Cabang",containerStyle:{gridColumn:"span 2",marginBottom:0},options:z.map(n=>({value:n.kode_cabang,label:n.cabang})),value:s.kode_cabang,onChange:async n=>{const j=n.target.value;if(R({...s,kode_cabang:j,kode_rute:""}),p([]),j){const M=await r("rute",{kode_cabang:j});p(M)}else{const M=await r("rute");p(M)}},placeholder:"Pilih Cabang",searchPlaceholder:"Cari cabang...",displayTop:!0}),e.jsx(Ke,{label:"Rute",containerStyle:{gridColumn:"span 2",marginBottom:0},disabled:!s.kode_cabang,options:k.map(n=>({value:n.kode_rute,label:n.rute})),value:s.kode_rute,onChange:n=>R({...s,kode_rute:n.target.value}),placeholder:s.kode_cabang?"Pilih Rute":"Pilih Cabang Dahulu",searchPlaceholder:"Cari rute...",displayTop:!0}),e.jsx(Ke,{label:"Kecamatan",containerStyle:{gridColumn:"span 2",marginBottom:0},required:!0,options:ae.map(n=>({value:n.kode_kecamatan,label:n.kecamatan})),value:s.kode_kecamatan,onChange:async n=>{const j=n.target.value,M=ae.find(N=>N.kode_kecamatan===j);if(R({...s,kode_kecamatan:j,kode_desa:"",kode_rw:"",kode_rt:""}),fe({kec:M?.id||null,desa:null,rw:null}),W([]),x([]),Y([]),M){const N=await Z("desa",{kec_id:M.id});W(N)}},placeholder:"Pilih Kecamatan",searchPlaceholder:"Cari kecamatan...",displayTop:!0}),e.jsx(Ke,{label:"Desa",containerStyle:{gridColumn:"span 2",marginBottom:0},required:!0,disabled:!s.kode_kecamatan,options:L.map(n=>({value:n.kode_desa,label:n.desa})),value:s.kode_desa,onChange:async n=>{const j=n.target.value,M=L.find(N=>N.kode_desa===j);if(R({...s,kode_desa:j,kode_rw:"",kode_rt:""}),fe(N=>({...N,desa:M?.id||null,rw:null})),x([]),Y([]),M){const N=await Z("rw",{kec_id:pe.kec,desa_id:M.id});x(N)}},placeholder:"Pilih Desa",searchPlaceholder:"Cari desa...",displayTop:!0}),e.jsxs("div",{className:"form-row",style:{gridColumn:"span 2"},children:[e.jsx(Ke,{label:"RW",options:g.map(n=>({value:n.kode_rw,label:n.rw})),value:s.kode_rw,disabled:!s.kode_desa,onChange:async n=>{const j=n.target.value,M=g.find(N=>N.kode_rw===j);if(R({...s,kode_rw:j,kode_rt:""}),Y([]),M){const N=await Z("rt",{kec_id:pe.kec,desa_id:pe.desa,rw_id:M.id});Y(N)}},placeholder:"RW",searchPlaceholder:"Cari RW...",displayTop:!0}),e.jsx(Ke,{label:"RT",options:u.map(n=>({value:n.kode_rt,label:n.rt})),value:s.kode_rt,disabled:!s.kode_rw,onChange:n=>R({...s,kode_rt:n.target.value}),placeholder:"RT",searchPlaceholder:"Cari RT...",displayTop:!0})]})]}),e.jsxs("div",{style:{borderTop:"1px solid var(--border)",marginTop:"2rem",paddingTop:"1.5rem",paddingBottom:"1rem",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{minWidth:"100px"},onClick:c,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{minWidth:"160px",opacity:q.meter||q.rumah?.7:1,cursor:q.meter||q.rumah?"not-allowed":"pointer"},disabled:q.meter||q.rumah,children:q.meter||q.rumah?"Memproses Foto...":T?"Simpan Perubahan":"Tambah Pelanggan"})]})]})]})}),be&&e.jsx("div",{className:"modal-overlay",style:{zIndex:2e3,background:"rgba(0,0,0,0.85)"},onClick:()=>ye(null),children:e.jsxs("div",{style:{position:"relative",maxWidth:"90vw",maxHeight:"90vh",display:"flex",flexDirection:"column",alignItems:"center"},onClick:n=>n.stopPropagation(),children:[e.jsxs("button",{onClick:()=>ye(null),style:{position:"absolute",top:"-40px",right:"0",background:"none",border:"none",color:"white",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"1rem",padding:"0.5rem"},children:[e.jsx(ce,{size:24})," Tutup"]}),e.jsx("img",{src:be&&be.startsWith("/")?`${xt}${be}`:be,alt:"Preview Meteran",style:{width:"100%",height:"auto",maxHeight:"80vh",borderRadius:"8px",border:"4px solid white",boxShadow:"0 0 20px rgba(0,0,0,0.5)"}}),e.jsx("p",{style:{color:"white",marginTop:"1rem",fontSize:"1.1rem",fontWeight:600},children:"Foto Meteran Pelanggan"})]})})]})}function Aa({isOpen:S,onClose:H,onConfirm:A,title:I,message:v,type:O="danger"}){return S?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"400px",textAlign:"center"},children:[e.jsx("button",{onClick:H,style:{position:"absolute",right:"1.5rem",top:"1.5rem",background:"none",border:"none",color:"var(--text-light)",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ce,{size:20})}),e.jsx("div",{style:{width:"64px",height:"64px",background:O==="danger"?"#fee2e2":"#e0f2fe",color:O==="danger"?"#ef4444":"var(--primary)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem"},children:e.jsx(ba,{size:32})}),e.jsx("h3",{style:{fontSize:"1.25rem",marginBottom:"0.75rem",fontWeight:600},children:I}),e.jsx("p",{style:{color:"var(--text-light)",marginBottom:"2rem",fontSize:"0.925rem"},children:v}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"stretch"},children:[e.jsx("button",{className:"btn btn-outline",style:{flex:1,justifyContent:"center"},onClick:H,children:"Batal"}),e.jsx("button",{className:"btn",style:{flex:1,justifyContent:"center",background:O==="danger"?"#ef4444":"var(--primary)",color:"white"},onClick:()=>{A(),H()},children:"Ya, Hapus"})]})]})}):null}const Mt="./api/branches.php",bt=[{id:"kode_cabang",label:"Kode Cabang"},{id:"cabang",label:"Nama Cabang"},{id:"alamat",label:"Alamat"},{id:"telepon",label:"Telepon"}],Zt=["kode_cabang","cabang","alamat","telepon"];function Ta(){const[S,H]=i.useState([]),[A,I]=i.useState(!0),[v,O]=i.useState(""),[w,G]=i.useState(!1),[T,Q]=i.useState(!1),[ae,ee]=i.useState(null),[L,W]=i.useState(null),[g,x]=i.useState(null),[u,Y]=i.useState({kode_cabang:"",cabang:"",alamat:"",telepon:""}),[xe,V]=i.useState(!1),[k,p]=i.useState(null),[z,ke]=i.useState([]),[pe,fe]=i.useState([]),[me,Ae]=i.useState(""),[Ce,Fe]=i.useState(!1),[se,Pe]=i.useState(!1),y=pa.useRef(null),[F,U]=i.useState(()=>{const o=localStorage.getItem("pdam_visible_columns_branches");return o?JSON.parse(o):Zt});i.useEffect(()=>{localStorage.setItem("pdam_visible_columns_branches",JSON.stringify(F))},[F]),i.useEffect(()=>{const o=_=>{y.current&&!y.current.contains(_.target)&&Pe(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const J=i.useCallback((o,_="success")=>{x({message:o,type:_}),setTimeout(()=>x(null),3e3)},[]),le=async()=>{try{I(!0);const _=await(await fetch(Mt)).json();H(_)}catch(o){console.error("Failed to fetch:",o),J("Gagal mengambil data cabang","error")}finally{I(!1)}};i.useEffect(()=>{le()},[]);const Me=(o=null)=>{o?(W(o),Y({kode_cabang:o.kode_cabang||"",cabang:o.cabang||"",alamat:o.alamat||"",telepon:o.telepon||""})):(W(null),Y({kode_cabang:"",cabang:"",alamat:"",telepon:""})),G(!0)},ue=()=>{G(!1),W(null)},We=async o=>{o.preventDefault();const _=L?"PUT":"POST",s=L?`${Mt}?id=${L.id}`:Mt;try{const K=await(await fetch(s,{method:_,headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json();K.message?(le(),ue(),J(L?"Cabang berhasil diperbarui":"Cabang berhasil ditambahkan")):K.error&&J(K.error,"error")}catch(R){console.error("Save failed:",R),J("Terjadi kesalahan saat menyimpan","error")}},je=o=>{ee(o),Q(!0)},Ee=async()=>{try{(await(await fetch(`${Mt}?id=${ae}`,{method:"DELETE"})).json()).message?(le(),J("Cabang berhasil dihapus")):J("Gagal menghapus cabang","error")}catch(o){console.error("Delete failed:",o),J("Terjadi kesalahan sistem","error")}},ve=async o=>{p(o),V(!0),Fe(!0);try{const s=await(await fetch(`./api/branch_routes.php?kode_cabang=${o.kode_cabang}`)).json();ke(s),fe(s.filter(R=>R.assigned).map(R=>R.kode_rute))}catch(_){console.error("Failed to fetch routes:",_),J("Gagal mengambil data rute","error")}finally{Fe(!1)}},E=o=>{fe(_=>_.includes(o)?_.filter(s=>s!==o):[..._,o])},be=()=>{const _=z.filter(s=>s.kode_rute.toLowerCase().includes(me.toLowerCase())||s.rute.toLowerCase().includes(me.toLowerCase())).map(s=>s.kode_rute);fe(s=>[...new Set([...s,..._])])},ye=()=>{const _=z.filter(s=>s.kode_rute.toLowerCase().includes(me.toLowerCase())||s.rute.toLowerCase().includes(me.toLowerCase())).map(s=>s.kode_rute);fe(s=>s.filter(R=>!_.includes(R)))},q=async()=>{try{const _=await(await fetch("./api/branch_routes.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kode_cabang:k.kode_cabang,routes:pe})})).json();_.message?(J(`Berhasil menyimpan ${_.total_routes} rute`),V(!1)):J(_.error||"Gagal menyimpan","error")}catch(o){console.error("Save routes failed:",o),J("Terjadi kesalahan saat menyimpan","error")}},Te=()=>{const o=bt.filter(h=>F.includes(h.id)),_=o.map(h=>h.label),s=_e.map(h=>o.map(c=>h[c.id]||"-")),R=[_,...s].map(h=>h.map(c=>`"${c}"`).join(",")).join(`
`),K=new Blob([R],{type:"text/csv;charset=utf-8;"}),Z=URL.createObjectURL(K),r=document.createElement("a");r.setAttribute("href",Z),r.setAttribute("download",`data_cabang_${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},$e=()=>{const o=bt.filter(K=>F.includes(K.id)),_=_e.map(K=>{const Z={};return o.forEach(r=>{Z[r.label]=K[r.id]||"-"}),Z}),s=Ie.json_to_sheet(_),R=Ie.book_new();Ie.book_append_sheet(R,s,"Cabang"),Tt(R,`data_cabang_${new Date().toISOString().split("T")[0]}.xlsx`)},we=()=>{try{const o=new Ct("p","mm","a4"),_=new Date().toLocaleString("id-ID");o.setFontSize(18),o.setTextColor(14,165,233),o.text("Laporan Data Cabang PDAM",14,15),o.setFontSize(10),o.setTextColor(100),o.text(`Jumlah Total: ${_e.length} Cabang`,14,22),o.text(`Waktu Cetak: ${_}`,196,22,{align:"right"});const s=bt.filter(Z=>F.includes(Z.id)),R=["No",...s.map(Z=>Z.label)],K=_e.map((Z,r)=>[r+1,...s.map(h=>Z[h.id]||"-")]);At(o,{head:[R],body:K,startY:28,theme:"grid",styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"}}),o.save(`data_cabang_${new Date().toISOString().split("T")[0]}.pdf`)}catch(o){console.error("PDF Export Error:",o),J("Gagal mengekspor PDF","error")}},ze=()=>{window.print()},_e=S.filter(o=>(o.cabang||"").toLowerCase().includes(v.toLowerCase())||(o.kode_cabang||"").toLowerCase().includes(v.toLowerCase())||(o.alamat||"").toLowerCase().includes(v.toLowerCase())||(o.telepon||"").toLowerCase().includes(v.toLowerCase()));return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[g&&e.jsxs("div",{style:{position:"fixed",top:"2rem",left:"50%",transform:"translateX(-50%)",zIndex:1e3,display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem 1.5rem",borderRadius:"10px",background:g.type==="success"?"#10b981":"#ef4444",color:"white",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",animation:"slideDown 0.3s ease-out"},children:[g.type==="success"?e.jsx(ya,{size:20}):e.jsx(ja,{size:20}),e.jsx("span",{style:{fontWeight:500},children:g.message})]}),e.jsxs("header",{className:"header",style:{marginBottom:"2.5rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"2rem",fontWeight:700,color:"var(--text)"},children:[e.jsx("div",{className:"hide-mobile",style:{background:"rgba(14, 165, 233, 0.1)",padding:"0.75rem",borderRadius:"12px",display:"flex"},children:e.jsx(Ut,{size:32,color:"var(--primary)"})}),"Data Cabang"]}),e.jsx("p",{style:{color:"var(--text-light)",marginTop:"0.5rem",fontSize:"1rem"},children:"Management Data kantor Cabang PDAM"})]}),e.jsxs("div",{className:"header-actions no-print",style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:Te,title:"Export CSV",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:$e,title:"Export Excel",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:we,title:"Export PDF",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:ze,title:"Print",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(_t,{size:18})})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>Me(),style:{padding:"0.75rem 1.5rem",borderRadius:"10px",fontSize:"0.95rem",whiteSpace:"nowrap"},children:[e.jsx(st,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Cabang"})]})]})]}),e.jsxs("div",{className:"card",style:{padding:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative"},ref:y,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>Pe(!se),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",borderRadius:"10px",background:se?"#f1f5f9":"#f8fafc",border:`1px solid ${se?"var(--primary)":"var(--border)"}`,color:se?"var(--primary)":"var(--text)"},children:[e.jsx(St,{size:18}),e.jsx("span",{style:{fontWeight:500},children:"Pilih Kolom"})]}),se&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"220px",animation:"fadeIn 0.2s ease-out"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",color:"var(--text)",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem"},children:bt.map(o=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px",transition:"background 0.2s"},onMouseEnter:_=>_.currentTarget.style.background="#f8fafc",onMouseLeave:_=>_.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:F.includes(o.id),onChange:()=>{U(_=>_.includes(o.id)?_.filter(s=>s!==o.id):[..._,o.id])}}),e.jsx("span",{style:{color:F.includes(o.id)?"var(--text)":"var(--text-light)",fontWeight:F.includes(o.id)?500:400},children:o.label})]},o.id))}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",gap:"1rem"},children:[e.jsx("button",{style:{background:"none",border:"none",color:"var(--primary)",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>U(bt.map(o=>o.id)),onMouseEnter:o=>o.currentTarget.style.background="rgba(14, 165, 233, 0.05)",onMouseLeave:o=>o.currentTarget.style.background="none",children:"Pilih Semua"}),e.jsx("button",{style:{background:"none",border:"none",color:"#64748b",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>U(Zt),onMouseEnter:o=>o.currentTarget.style.background="#f1f5f9",onMouseLeave:o=>o.currentTarget.style.background="none",children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(Je,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:v?"2.5rem":"0.625rem",height:"42px",borderRadius:"10px",border:"1px solid var(--border)",fontSize:"0.9rem",width:"100%",background:"#f8fafc"},placeholder:"Cari cabang, alamat atau telepon...",value:v,onChange:o=>O(o.target.value)})]})]}),A?e.jsxs("div",{style:{padding:"8rem 0",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[e.jsx(Jt,{className:"animate-spin",size:40,color:"var(--primary)"}),e.jsx("p",{style:{color:"var(--text-light)",fontWeight:500},children:"Memuat data cabang..."})]}):e.jsx("div",{className:"table-container",style:{margin:0},children:e.jsxs("table",{style:{width:"100%",minWidth:"600px"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"60px",padding:"0.625rem 0.75rem",textAlign:"center",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"NO"}),F.includes("kode_cabang")&&e.jsx("th",{style:{width:"130px",padding:"0.625rem 0.75rem",textAlign:"center",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Kode Cabang"}),F.includes("cabang")&&e.jsx("th",{style:{padding:"0.625rem 0.75rem",textAlign:"left",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Nama Cabang"}),F.includes("alamat")&&e.jsx("th",{style:{padding:"0.625rem 0.75rem",textAlign:"left",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Alamat"}),F.includes("telepon")&&e.jsx("th",{style:{width:"160px",padding:"0.625rem 0.75rem",textAlign:"left",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Telepon"}),e.jsx("th",{style:{width:"100px",padding:"0.625rem 0.75rem",textAlign:"center",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Aksi"})]})}),e.jsx("tbody",{children:_e.length>0?_e.map((o,_)=>e.jsxs("tr",{style:{transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"0.625rem 0.75rem",textAlign:"center",fontWeight:500,color:"#64748b",fontSize:"0.875rem"},children:_+1}),F.includes("kode_cabang")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",fontWeight:600,color:"var(--text)",textAlign:"center"},children:e.jsx("span",{style:{background:"#f1f5f9",color:"#1e293b",padding:"0.2rem 0.625rem",borderRadius:"4px",fontSize:"0.8125rem",border:"1px solid #e2e8f0"},children:o.kode_cabang})}),F.includes("cabang")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",color:"var(--text)",fontSize:"0.9rem",fontWeight:500},children:o.cabang}),F.includes("alamat")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",color:"#64748b",fontSize:"0.875rem"},children:e.jsx("div",{style:{maxWidth:"350px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:o.alamat,children:o.alamat||"-"})}),F.includes("telepon")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",color:"#64748b",fontSize:"0.875rem"},children:o.telepon||"-"}),e.jsx("td",{style:{padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",borderRadius:"6px",width:"28px",height:"28px"},onClick:()=>Me(o),title:"Edit Cabang",children:e.jsx(et,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",color:"#ef4444",borderRadius:"6px",width:"28px",height:"28px"},onClick:()=>je(o.id),title:"Hapus Cabang",children:e.jsx(Bt,{size:14})})]})})]},o.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:F.length+2,style:{textAlign:"center",padding:"5rem 0"},children:[e.jsx("div",{style:{opacity:.5,marginBottom:"1rem"},children:e.jsx(Ut,{size:64,style:{margin:"0 auto"}})}),e.jsx("p",{style:{color:"var(--text-light)",fontSize:"1rem"},children:v?`Tidak ditemukan hasil untuk "${v}"`:"Belum ada data cabang."})]})})})]})})]}),w&&e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",style:{maxWidth:"450px",borderRadius:"16px",padding:0,maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsxs("div",{style:{padding:"2rem",flex:1,overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",display:"flex",alignItems:"center",gap:"0.75rem",fontWeight:700},children:L?e.jsxs(e.Fragment,{children:[e.jsx(et,{size:24,color:"var(--primary)"})," Edit Cabang"]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{size:24,color:"var(--primary)"})," Tambah Cabang"]})}),e.jsx("button",{onClick:ue,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s",marginTop:"-0.5rem",marginRight:"-0.5rem"},onMouseEnter:o=>o.currentTarget.style.color="#64748b",onMouseLeave:o=>o.currentTarget.style.color="#94a3b8",children:e.jsx(ce,{size:24})})]}),e.jsxs("form",{onSubmit:We,children:[e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Kode Cabang"}),e.jsx("input",{required:!0,maxLength:"3",placeholder:"Contoh: 10",style:{height:"48px",borderRadius:"8px"},value:u.kode_cabang,onChange:o=>Y({...u,kode_cabang:o.target.value})}),e.jsx("small",{style:{color:"var(--text-light)",marginTop:"0.25rem",display:"block"},children:"Maksimal 3 karakter"})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Nama Cabang"}),e.jsx("input",{required:!0,placeholder:"Masukkan nama cabang",style:{height:"48px",borderRadius:"8px"},value:u.cabang,onChange:o=>Y({...u,cabang:o.target.value})})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Telepon"}),e.jsx("input",{placeholder:"Contoh: 0234-123456",style:{height:"48px",borderRadius:"8px"},value:u.telepon,onChange:o=>Y({...u,telepon:o.target.value})})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Alamat"}),e.jsx("textarea",{placeholder:"Masukkan alamat lengkap cabang",style:{padding:"0.75rem",borderRadius:"8px",border:"1px solid var(--border)",width:"100%",minHeight:"100px",fontSize:"0.95rem",fontFamily:"inherit"},value:u.alamat,onChange:o=>Y({...u,alamat:o.target.value})})]}),L&&e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsxs("button",{type:"button",className:"btn btn-outline",onClick:()=>{ue(),ve(L)},style:{width:"100%",padding:"0.75rem",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",borderColor:"var(--primary)",color:"var(--primary)",fontWeight:600},children:[e.jsx(Kt,{size:20}),"Kelola Rute"]}),e.jsx("small",{style:{color:"var(--text-light)",marginTop:"0.5rem",display:"block",textAlign:"center"},children:"Atur rute yang tersedia di cabang ini"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{flex:1,padding:"0.75rem",borderRadius:"8px"},onClick:ue,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{flex:2,padding:"0.75rem",borderRadius:"8px",fontWeight:600},children:L?"Simpan Perubahan":"Simpan Data"})]})]})]})})}),e.jsx(Aa,{isOpen:T,onClose:()=>Q(!1),onConfirm:Ee,title:"Hapus Cabang?",message:"Tindakan ini tidak dapat dibatalkan. Seluruh data terkait cabang ini mungkin terdampak.",type:"danger"}),xe&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"700px",borderRadius:"16px",padding:0,maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h2",{style:{fontSize:"1.25rem",fontWeight:700,display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Kt,{size:24,color:"var(--primary)"}),"Kelola Rute - ",k?.cabang]}),e.jsx("button",{onClick:()=>V(!1),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ce,{size:24})})]}),e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid var(--border)",background:"#f8fafc"},children:[e.jsxs("div",{style:{position:"relative",marginBottom:"1rem"},children:[e.jsx(Je,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{autoFocus:!0,placeholder:"Ketik untuk mencari rute...",value:me,onChange:o=>Ae(o.target.value),style:{paddingLeft:"2.5rem",paddingRight:me?"2.5rem":"1rem",height:"44px",borderRadius:"8px",border:"2px solid var(--primary)",width:"100%",fontSize:"0.95rem",boxShadow:"0 0 0 3px rgba(14, 165, 233, 0.1)"}}),me&&e.jsx("button",{onClick:()=>Ae(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"#e2e8f0",border:"none",borderRadius:"50%",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#64748b",transition:"all 0.2s"},onMouseEnter:o=>{o.currentTarget.style.background="#cbd5e1",o.currentTarget.style.color="#334155"},onMouseLeave:o=>{o.currentTarget.style.background="#e2e8f0",o.currentTarget.style.color="#64748b"},title:"Clear search",children:e.jsx(ce,{size:14})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:be,className:"btn btn-outline",style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"Pilih Semua"}),e.jsx("button",{onClick:ye,className:"btn btn-outline",style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"Hapus Semua"})]}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"var(--text-light)",fontWeight:500},children:[pe.length," rute dipilih"]})]})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem 2rem"},children:Ce?e.jsx("div",{style:{padding:"3rem",textAlign:"center"},children:e.jsx(Jt,{className:"animate-spin",size:32,color:"var(--primary)",style:{margin:"0 auto"}})}):e.jsx("div",{style:{display:"grid",gap:"0.5rem"},children:z.filter(o=>o.kode_rute.toLowerCase().includes(me.toLowerCase())||o.rute.toLowerCase().includes(me.toLowerCase())).map(o=>e.jsxs("label",{className:`route-checkbox-item ${pe.includes(o.kode_rute)?"selected":""}`,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",border:"1px solid var(--border)",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:pe.includes(o.kode_rute),onChange:()=>E(o.kode_rute),style:{width:"18px",height:"18px",accentColor:"var(--primary)",cursor:"pointer"}}),e.jsxs("div",{style:{flex:1,pointerEvents:"none"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem",color:"var(--text)"},children:o.kode_rute}),e.jsx("div",{style:{fontSize:"0.8125rem",color:"var(--text-light)"},children:o.rute})]})]},o.kode_rute))})}),e.jsxs("div",{style:{padding:"1.5rem 2rem",borderTop:"1px solid var(--border)",display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>V(!1),className:"btn btn-outline",style:{padding:"0.75rem 1.5rem"},children:"Batal"}),e.jsx("button",{onClick:q,className:"btn btn-primary",style:{padding:"0.75rem 2rem",fontWeight:600},children:"Simpan Perubahan"})]})]})}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideDown {
                    from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
                .animate-spin {
                    animation: spin 1s linear infinite;
                }
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                .route-checkbox-item {
                    background: white;
                    transition: background-color 0.15s ease;
                }
                .route-checkbox-item:hover {
                    background: #f8fafc;
                }
                .route-checkbox-item.selected {
                    background: #f0f9ff;
                }
                .route-checkbox-item.selected:hover {
                    background: #e0f2fe;
                }
                @media print {
                    .no-print {
                        display: none !important;
                    }
                    body {
                        background: white !important;
                        padding: 0 !important;
                    }
                    .card {
                        box-shadow: none !important;
                        border: 1px solid #e2e8f0 !important;
                        padding: 0 !important;
                    }
                    .table-container {
                        overflow: visible !important;
                    }
                    table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                    }
                    th, td {
                        border: 1px solid #e2e8f0 !important;
                        padding: 8px !important;
                        font-size: 10pt !important;
                    }
                    .header {
                        margin-bottom: 20px !important;
                    }
                    @page {
                        size: auto;
                        margin: 15mm;
                    }
                }
            `}})]})}const za=({value:S,onChange:H,minDate:A=Ue(new Date),maxDate:I=new Date})=>{const[v,O]=i.useState(!1),[w,G]=i.useState(S||new Date),T=i.useRef(null);i.useEffect(()=>{const x=u=>{T.current&&!T.current.contains(u.target)&&O(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const Q=x=>{x.stopPropagation();const u=Pt(w);qe(nt(u),A)||G(u)},ae=x=>{x.stopPropagation();const u=$t(w,1);Xe(Ue(u),I)||G(u)},ee=x=>{x.stopPropagation();const u=Dt(w);qe(nt(u),A)||G(u)},L=x=>{x.stopPropagation();const u=Ot(w,1);Xe(Ue(u),I)||G(u)},W=x=>{qe(x,A)&&!gt(x,A)||Xe(x,I)&&!gt(x,I)||(H(x),O(!1))},g=ma({start:ha(Ue(w)),end:ua(nt(w))});return e.jsxs("div",{className:"custom-datepicker",style:{position:"relative"},ref:T,children:[e.jsxs("div",{onClick:()=>O(!v),style:{height:"42px",padding:"0 0.75rem 0 2.5rem",borderRadius:"10px",border:"1px solid var(--border)",background:"#f8fafc",fontSize:"0.875rem",color:"#64748b",display:"flex",alignItems:"center",cursor:"pointer",minWidth:"180px",fontWeight:500,position:"relative"},children:[e.jsx(jt,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),S?He(S,"dd MMMM yyyy",{locale:ia}):"Pilih Tanggal"]}),v&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"16px",boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1)",width:"300px",padding:"1.25rem",animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1.5rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("button",{onClick:Q,disabled:qe(nt(Pt(w)),A),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:qe(nt(Pt(w)),A)?"#e2e8f0":"#64748b"},children:e.jsx(Ze,{size:18})}),e.jsx("span",{style:{minWidth:"45px",textAlign:"center",fontWeight:600,color:"#1e293b",fontSize:"0.9rem"},children:He(w,"MMM")}),e.jsx("button",{onClick:ae,disabled:Xe(Ue($t(w,1)),I),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:Xe(Ue($t(w,1)),I)?"#e2e8f0":"#64748b"},children:e.jsx(Qe,{size:18})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("button",{onClick:ee,disabled:qe(nt(Dt(w)),A),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:qe(nt(Dt(w)),A)?"#e2e8f0":"#64748b"},children:e.jsx(Ze,{size:18})}),e.jsx("span",{style:{fontWeight:600,color:"#1e293b",fontSize:"0.9rem"},children:He(w,"yyyy")}),e.jsx("button",{onClick:L,disabled:Xe(Ue(Ot(w,1)),I),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:Xe(Ue(Ot(w,1)),I)?"#e2e8f0":"#64748b"},children:e.jsx(Qe,{size:18})})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",textAlign:"center",marginBottom:"8px"},children:["S","M","T","W","T","F","S"].map((x,u)=>e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:500,color:"#94a3b8",padding:"4px"},children:x},u))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"2px"},children:g.map((x,u)=>{const Y=S&&gt(x,S),xe=ga(x),V=xa(x,w),k=qe(x,A)&&!gt(x,A),p=Xe(x,I)&&!gt(x,I),z=k||p;return e.jsxs("div",{onClick:()=>!z&&W(x),style:{aspectRatio:"1/1",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.8125rem",cursor:z?"not-allowed":"pointer",color:z?"#e2e8f0":V?"#1e293b":"#cbd5e1",position:"relative",fontWeight:Y||xe?700:400},children:[Y&&e.jsx("div",{style:{position:"absolute",width:"32px",height:"32px",borderRadius:"50%",border:"1px solid #000",zIndex:0}}),e.jsx("span",{style:{zIndex:1},children:He(x,"d")})]},u)})}),e.jsx("button",{onClick:()=>{H(new Date),G(new Date),O(!1)},style:{width:"100%",marginTop:"1rem",padding:"0.5rem",background:"#f8fafc",border:"none",borderRadius:"8px",fontSize:"0.75rem",fontWeight:600,color:"var(--primary)",cursor:"pointer"},children:"Pilih Hari Ini"})]}),e.jsx("style",{children:`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(5px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]})},da=({value:S,onChange:H,disableCurrent:A=!1,disablePastYears:I=!1})=>{const[v,O]=i.useState(!1),[w,G]=i.useState(S||new Date),T=i.useRef(null);i.useEffect(()=>{const g=x=>{T.current&&!T.current.contains(x.target)&&O(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const Q=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],ae=new Date,ee=ae.getMonth(),L=ae.getFullYear(),W=g=>{if(w.getFullYear()>L||w.getFullYear()===L&&(A?g>=ee:g>ee))return;const u=new Date(w.getFullYear(),g,1);H(u),O(!1)};return e.jsxs("div",{style:{position:"relative"},ref:T,children:[e.jsxs("div",{onClick:()=>O(!v),style:{height:"42px",padding:"0 0.75rem 0 2.5rem",borderRadius:"10px",border:"1px solid var(--border)",background:"#f8fafc",fontSize:"0.875rem",color:"#1e293b",display:"flex",alignItems:"center",cursor:"pointer",minWidth:"180px",fontWeight:600,position:"relative"},children:[e.jsx(jt,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),He(S,"MMMM yyyy",{locale:ia}),e.jsx(it,{size:16,style:{marginLeft:"auto",color:"#64748b"}})]}),v&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"16px",boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1)",width:"280px",padding:"1.25rem",animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.25rem"},children:[e.jsx("button",{onClick:()=>!I&&G(Dt(w)),disabled:I,style:{background:"none",border:"none",cursor:I?"not-allowed":"pointer",color:I?"#e2e8f0":"#64748b"},children:e.jsx(Ze,{size:20})}),e.jsx("span",{style:{fontWeight:700,fontSize:"1.1rem",color:"#1e293b"},children:w.getFullYear()}),e.jsx("button",{onClick:()=>{w.getFullYear()<L&&G(Ot(w,1))},style:{background:"none",border:"none",cursor:w.getFullYear()<L?"pointer":"not-allowed",color:w.getFullYear()<L?"#64748b":"#e2e8f0"},disabled:w.getFullYear()>=L,children:e.jsx(Qe,{size:20})})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px"},children:Q.map((g,x)=>{const u=S.getMonth()===x&&S.getFullYear()===w.getFullYear(),Y=w.getFullYear()>L||w.getFullYear()===L&&(A?x>=ee:x>ee),xe=I&&w.getFullYear()<L,V=Y||xe;return e.jsx("button",{onClick:()=>!V&&W(x),disabled:V,style:{padding:"10px 5px",borderRadius:"8px",border:"1px solid "+(u?"var(--primary)":"transparent"),background:u?"rgba(14, 165, 233, 0.1)":"transparent",color:u?"var(--primary)":V?"#cbd5e1":"#1e293b",fontSize:"0.8125rem",fontWeight:u?700:500,cursor:V?"not-allowed":"pointer",transition:"all 0.2s",opacity:V?.6:1},onMouseEnter:k=>{!u&&!V&&(k.target.style.background="#f1f5f9")},onMouseLeave:k=>{!u&&!V&&(k.target.style.background="transparent")},children:g.substring(0,3)},g)})})]}),e.jsx("style",{children:`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(5px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]})},Wt="./api/recordings.php",Ra="./api/customers.php",Et="http://localhost",yt=[{id:"id_sambungan",label:"NO. SAMBUNGAN"},{id:"nama",label:"NAMA PELANGGAN"},{id:"id_meter",label:"ID METER"},{id:"alamat",label:"ALAMAT"},{id:"stan_akhir",label:"STAN AKHIR"},{id:"petugas",label:"PETUGAS"},{id:"foto",label:"FOTO METER"},{id:"foto_rumah",label:"FOTO RUMAH"},{id:"status_laporan",label:"KONDISI METER"},{id:"koordinat",label:"KOORDINAT"},{id:"pemakaian",label:"PEMAKAIAN (m)"},{id:"update_date",label:"TGL PENCATATAN"}],Qt=["id_sambungan","nama","id_meter","alamat","stan_akhir","pemakaian","petugas","foto","foto_rumah","status_laporan","koordinat","update_date"];function ea({isHistory:S=!1}){const[H,A]=i.useState([]),[I,v]=i.useState([]),[O,w]=i.useState([]),[G,T]=i.useState(!0),[Q,ae]=i.useState(""),[ee,L]=i.useState(!1),[W,g]=i.useState(null),[x,u]=i.useState(!1),[Y,xe]=i.useState(!1),V=i.useRef(null),k=i.useRef(null),[p,z]=i.useState(()=>{const a=localStorage.getItem("pdam_visible_columns_rec_v7");return a?JSON.parse(a):Qt}),[ke,pe]=i.useState(1),[fe,me]=i.useState(10),[Ae,Ce]=i.useState("nama"),[Fe,se]=i.useState(null),[Pe,y]=i.useState(null),[F,U]=i.useState(null),[J,le]=i.useState(!1),[Me,ue]=i.useState(0),[We,je]=i.useState(null),[Ee,ve]=i.useState(null),[E,be]=i.useState(null),[ye,q]=i.useState(!1),[Te,$e]=i.useState(null),[we,ze]=i.useState(!1),[_e,o]=i.useState(""),_=i.useRef(null),[s,R]=i.useState({id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",bulan:new Date().getMonth()+1,tahun:new Date().getFullYear(),stan_akhir:0,foto:"",foto_rumah:"",kode_tarif:"",longitude:"",latitude:"",petugas:"Admin",status_laporan:""}),[K,Z]=i.useState([]),[r,h]=i.useState([]),[c,$]=i.useState([]);i.useEffect(()=>{te(),he(),X(),D()},[]),i.useEffect(()=>{const a=d=>{V.current&&!V.current.contains(d.target)&&u(!1),k.current&&!k.current.contains(d.target)&&xe(!1),_.current&&!_.current.contains(d.target)&&ze(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const X=async()=>{try{const d=await(await fetch("./api/officers.php")).json();h(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch officers:",a)}},D=async()=>{try{const d=await(await fetch("./api/options.php?type=status_kondisi")).json();$(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch status kondisi:",a)}},te=async()=>{try{T(!0);const d=await(await fetch(Wt)).json();A(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch recordings:",a)}finally{T(!1)}},he=async()=>{try{const d=await(await fetch(Ra)).json();v(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch customers:",a)}};i.useEffect(()=>{if(!s.id_pelanggan){Z([]);return}let a=s.bulan-1,d=s.tahun;a===0&&(a=12,d=s.tahun-1);const b=H.filter(t=>(t.id_pelanggan==s.id_pelanggan||t.id_sambungan==s.id_sambungan)&&t.bulan==a&&t.tahun==d);Z(b)},[s.id_pelanggan,s.bulan,s.tahun,H]);const Oe=async(a,d)=>{if(!(!a||!d)){q(!0);try{const b=new FormData;b.append("image",a),b.append("user_input",d);const l=await(await fetch("http://localhost:5000/validate",{method:"POST",body:b})).json();l.error?(console.error("AI Error:",l.error),be({status:"ERROR",message:l.error})):(be({similarity:l.similarity_percent,status:l.status,detected:l.detected,bestMatch:l.best_match}),l.debug_image&&$e(l.debug_image))}catch(b){console.error("AI fetch failed:",b),be({status:"ERROR",message:"Koneksi ke AI terputus"})}finally{q(!1)}}};i.useEffect(()=>{localStorage.setItem("pdam_visible_columns_rec_v2",JSON.stringify(p))},[p]),i.useEffect(()=>{function a(d){V.current&&!V.current.contains(d.target)&&u(!1),k.current&&!k.current.contains(d.target)&&xe(!1),_.current&&!_.current.contains(d.target)&&ze(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const Ge=async a=>{const d=I.find(b=>b.id==a);if(d){let b=s.bulan-1,t=s.tahun;if(b===0&&(b=12,t=s.tahun-1),H.find(l=>(l.id_pelanggan==d.id||l.id_sambungan==d.id_sambungan)&&l.bulan==b&&l.tahun==t),R(l=>({...l,id_pelanggan:d.id,id_sambungan:d.id_sambungan,id_meter:d.id_meter,nama:d.nama,alamat:d.alamat,kode_tarif:d.kode_tarif,stan_akhir:0,longitude:"",latitude:"",petugas:""})),d.kode_rute)try{const m=await(await fetch(`./api/officers.php?route_code=${d.kode_rute}`)).json();h(Array.isArray(m)?m:[]),Array.isArray(m)&&m.length===1&&R(f=>({...f,petugas:m[0].nama}))}catch(l){console.error("Failed to fetch officers for route:",l)}else X()}},Ye=async(a=null)=>{if(a){g(a),R({...a}),se(a.foto||null),y(a.foto_rumah||null),je(null),ve(null);const d=I.find(b=>b.id==a.id_pelanggan);if(d&&d.kode_rute)try{const t=await(await fetch(`./api/officers.php?route_code=${d.kode_rute}`)).json();let l=Array.isArray(t)?t:[];if(a.petugas&&!l.some(m=>m.nama===a.petugas)){const C=(await(await fetch("./api/officers.php")).json()||[]).find(P=>P.nama===a.petugas);C&&l.push(C)}h(l),!a.petugas&&l.length===1&&R(m=>({...m,petugas:l[0].nama}))}catch(b){console.error("Failed to fetch officers for edit:",b)}}else g(null),R({id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",bulan:new Date().getMonth()+1,tahun:new Date().getFullYear(),stan_akhir:0,foto:"",foto_rumah:"",kode_tarif:"",longitude:"",latitude:"",petugas:"",status_laporan:""}),Z([]),y(null),je(null),ve(null),w(I),X();ze(!1),o(""),L(!0)},tt=()=>{L(!1),g(null),se(null),y(null),je(null),ve(null),le(!1),ue(0),be(null),$e(null)},ot=(a,d="foto")=>{const b=a.target.files[0];if(b){le(!0),ue(0);const t=new FileReader;let l=0;const m=setInterval(()=>{l+=Math.random()*30,l>=100&&(l=100,clearInterval(m),t.onloadend=()=>{d==="foto_rumah"?(y(t.result),ve(b)):(se(t.result),je(b),s.stan_akhir&&Number(s.stan_akhir)!==0&&Oe(b,s.stan_akhir)),setTimeout(()=>{le(!1),ue(0)},500)},t.readAsDataURL(b)),ue(l)},100)}},ct=a=>{a==="foto"?(se(null),je(null),be(null),$e(null),R(d=>({...d,foto:null}))):(y(null),ve(null),R(d=>({...d,foto_rumah:null})))};i.useEffect(()=>{if(E&&E.detected&&ee){const a=s.stan_akhir||"",b=E.detected.split("");let t=0;for(const f of String(a)){const C=b.indexOf(f);C!==-1&&(t++,b.splice(C,1))}const l=String(a).length>0?t/String(a).length*100:0;let m="RED";l>=99.9?m="GREEN":l>=50&&(m="YELLOW"),l!==E.similarity&&be(f=>({...f,similarity:Math.round(l*100)/100,status:m}))}},[s.stan_akhir,ee]);const pt=async a=>{if(a.preventDefault(),J)return;const d=new FormData;Object.keys(s).forEach(t=>{t!=="foto"&&t!=="foto_rumah"&&d.append(t,s[t]===0||s[t]?s[t]:"")}),We?d.append("foto",We):s.foto&&d.append("foto",s.foto),Ee?d.append("foto_rumah",Ee):s.foto_rumah&&d.append("foto_rumah",s.foto_rumah),E&&E.status&&d.append("ai_ocr_status",E.status);const b=W?`${Wt}?id=${W.id}`:Wt;try{oe.fire({title:"Menyimpan Data...",text:"Mohon tunggu sebentar",allowOutsideClick:!1,didOpen:()=>{oe.showLoading()}});const l=await(await fetch(b,{method:"POST",body:d})).json();l.message?(oe.fire({title:"Berhasil!",text:"Data pencatatan berhasil disimpan.",icon:"success",timer:1500,showConfirmButton:!1}),te(),tt()):oe.fire("Gagal!",l.error||"Terjadi kesalahan saat menyimpan.","error")}catch(t){console.error("Save failed:",t),oe.fire("Error!","Gagal menghubungi server.","error")}},mt=async a=>{if((await oe.fire({title:"Hapus Pencatatan?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#64748b",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{(await(await fetch(`${Wt}?id=${a}`,{method:"DELETE"})).json()).message&&(oe.fire({title:"Berhasil!",text:"Data pencatatan telah dihapus.",icon:"success",timer:1500,showConfirmButton:!1}),te())}catch(b){console.error("Delete failed:",b),oe.fire("Error!","Gagal menghapus data.","error")}},n=()=>{const a=yt.filter(P=>p.includes(P.id)),d=a.map(P=>P.label),b=Be.map(P=>a.map(Se=>Se.id==="status_laporan"?c.find(ie=>ie.kode_kondisi===P.status_laporan)?.status_kondisi||P.status_laporan||"-":Se.id==="koordinat"?P.latitude&&P.longitude?`${P.latitude}, ${P.longitude}`:"-":Se.id==="pemakaian"?Re(P):Se.id==="update_date"?P.update_date?P.update_date.slice(0,10):"-":P[Se.id]||"-")),t=[d,...b].map(P=>P.map(Se=>`"${Se}"`).join(",")).join(`
`),l=new Blob([t],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(l),f=document.createElement("a");f.setAttribute("href",m);const C=S?"riwayat_pencatatan":"pencatatan_berjalan";f.setAttribute("download",`${C}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(f),f.click(),document.body.removeChild(f)},j=()=>{const a=yt.filter(m=>p.includes(m.id)),d=Be.map(m=>{const f={};return a.forEach(C=>{let P=m[C.id];C.id==="status_laporan"?P=c.find(Se=>Se.kode_kondisi===m.status_laporan)?.status_kondisi||m.status_laporan||"-":C.id==="koordinat"?P=m.latitude&&m.longitude?`${m.latitude}, ${m.longitude}`:"-":C.id==="pemakaian"?P=Re(m):C.id==="update_date"&&(P=m.update_date?m.update_date.slice(0,10):"-"),f[C.label]=P||"-"}),f}),b=Ie.json_to_sheet(d),t=Ie.book_new();Ie.book_append_sheet(t,b,"Pencatatan"),Tt(t,`${S?"riwayat_pencatatan":"pencatatan_berjalan"}_${new Date().toISOString().slice(0,10)}.xlsx`)},M=()=>{const a=new Ct("l","mm","a4"),d=new Date().toLocaleString("id-ID"),b=yt.filter(Ne=>p.includes(Ne.id));a.setFontSize(18),a.setTextColor(14,165,233);const t=S?"Laporan Riwayat Pencatatan Meter PDAM":"Laporan Pencatatan Meter PDAM Bulan Berjalan";a.text(t,14,15),a.setFontSize(10),a.setTextColor(100),a.text(`Jumlah Total: ${Be.length} Data`,14,22),a.text(`Waktu Cetak: ${d}`,280,22,{align:"right"});const l=b.map(Ne=>Ne.label),m=Be.map(Ne=>b.map(Ve=>Ve.id==="status_laporan"?c.find(Ft=>Ft.kode_kondisi===Ne.status_laporan)?.status_kondisi||Ne.status_laporan||"-":Ve.id==="koordinat"?Ne.latitude&&Ne.longitude?`${Ne.latitude}, ${Ne.longitude}`:"-":Ve.id==="pemakaian"?Re(Ne):Ve.id==="update_date"?Ne.update_date?Ne.update_date.slice(0,10):"-":Ne[Ve.id]||"-"));At(a,{head:[l],body:m,startY:28,theme:"grid",styles:{fontSize:8},headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"}});const C=(a.lastAutoTable.finalY||28)+20;C+40>a.internal.pageSize.height&&(a.addPage(),a.text(`Waktu Cetak: ${d}`,280,22,{align:"right"}));const P=localStorage.getItem("username")||"Admin";a.setFontSize(10),a.setTextColor(50);const de=a.internal.pageSize.width-20-40;a.text("Dicetak oleh,",de,C,{align:"center"}),a.text("_______________________",de,C+25,{align:"center"}),a.text(P,de,C+30,{align:"center"});const Le=S?"riwayat_pencatatan":"pencatatan_berjalan";a.save(`${Le}_${new Date().toISOString().split("T")[0]}.pdf`)},N=()=>window.print(),[B,ne]=i.useState(new Date),[re,ge]=i.useState(()=>Pt(Ue(new Date))),Re=a=>{let d=parseInt(a.bulan)-1,b=parseInt(a.tahun);d===0&&(d=12,b-=1);const t=H.find(m=>m.id_pelanggan===a.id_pelanggan&&parseInt(m.bulan)===d&&parseInt(m.tahun)===b);if(!t)return"Data Belum Tersedia";const l=parseInt(a.stan_akhir)-parseInt(t.stan_akhir);return parseInt(a.stan_akhir)===0?0:l},Be=H.filter(a=>{if(S){const b=a.update_date?new Date(a.update_date):null;if(!b)return!1;const t=re.getMonth(),l=re.getFullYear();if(b.getMonth()!==t||b.getFullYear()!==l)return!1}else{const b=a.update_date?.slice(0,10),t=B?new Date(B.getTime()-B.getTimezoneOffset()*6e4).toISOString().slice(0,10):null;if(t&&b!==t)return!1}const d=Q.toLowerCase().trim();return d?Ae==="nama"?(a.nama?.toLowerCase()||"").includes(d):Ae==="id_sambungan"?(a.id_sambungan?.toLowerCase()||"").includes(d):Ae==="petugas"?(a.petugas?.toLowerCase()||"").includes(d):(a.nama?.toLowerCase()||"").includes(d):!0});i.useEffect(()=>{pe(1)},[Q,fe]);const ut=()=>{let a=[],b=Math.max(1,ke-2),t=Math.min(at,b+5-1);t-b+1<5&&(b=Math.max(1,t-5+1));for(let l=b;l<=t;l++)a.push(l);return a},at=Math.ceil(Be.length/fe),ht=ke*fe,zt=ht-fe,Rt=Be.slice(zt,ht);return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .customer-table thead th {
                        position: sticky;
                        top: 0;
                        z-index: 30;
                        background: #f1f5f9 !important;
                        box-shadow: 0 2px 4px -1px rgba(0,0,0,0.06);
                        border-bottom: 2px solid var(--border) !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) td {
                        background-color: #f8fafc;
                    }
                    .customer-table tbody tr:hover td {
                        background-color: #f1f5f9 !important;
                    }
                    .customer-table td, .customer-table th {
                        padding: 0.625rem 0.75rem !important;
                        vertical-align: middle;
                        font-size: 0.875rem;
                    }
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left,
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #f8fafc !important;
                    }

                    @media print {
                        .no-print, .no-print * {
                            display: none !important;
                        }
                        
                        body {
                            background: white !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .card {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .table-container {
                            overflow: visible !important;
                            max-height: none !important;
                            width: 100% !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .customer-table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            table-Layout: auto !important;
                            font-size: 8pt !important;
                        }

                        .customer-table th, .customer-table td {
                            border: 1px solid #e2e8f0 !important;
                            padding: 4pt !important;
                            overflow: visible !important;
                            white-space: normal !important;
                            word-break: break-word !important;
                            min-width: 0 !important;
                            width: auto !important;
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .sticky-col-left, .sticky-col-right {
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .customer-table th, .customer-table td { 
                            border: 1px solid #000 !important; 
                            padding: 2px 4px !important;
                            white-space: normal !important;
                            word-break: break-word;
                            font-size: 7pt !important;
                        }
                        @page {
                            size: landscape;
                            margin: 0.5cm;
                        }
                        .print-footer { display: block !important; position: fixed; bottom: 0; right: 0; width: 300px; text-align: center; font-size: 10pt; color: #000; }
                    }
                    .print-footer { display: none; }

                        header.header {
                            margin-bottom: 1rem !important;
                        }

                        h1 {
                            font-size: 16pt !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.875rem"},children:[e.jsx(rt,{size:32,color:"var(--primary)"}),S?"History Pencatatan":"Pencatatan Bulan Berjalan"]}),e.jsx("p",{style:{color:"var(--text-light)",marginTop:"0.25rem"},children:S?"Riwayat Pencatatan Meter Pelanggan":"Manajemen Pencatatan Meter Pelanggan"})]}),e.jsxs("div",{className:"header-actions no-print",children:[e.jsx("button",{className:"btn btn-outline",onClick:n,title:"Export CSV",style:{padding:"0.5rem"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:j,title:"Export Excel",style:{padding:"0.5rem"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:M,title:"Export PDF",style:{padding:"0.5rem"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:N,title:"Print",style:{padding:"0.5rem"},children:e.jsx(_t,{size:18})}),!S&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>Ye(),style:{whiteSpace:"nowrap"},children:[e.jsx(st,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Catatan"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flex:1,minWidth:"300px"},children:[e.jsxs("div",{style:{position:"relative"},ref:V,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>u(!x),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",background:x?"#f1f5f9":"#f8fafc",border:`1px solid ${x?"var(--primary)":"var(--border)"}`,color:x?"var(--primary)":"var(--text)",borderRadius:"10px"},children:[e.jsx(St,{size:18}),e.jsx("span",{style:{fontWeight:500},children:"Pilih Kolom"})]}),x&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px",maxHeight:"450px",overflowY:"auto"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem"},children:yt.filter(a=>S||a.id!=="pemakaian").map(a=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px"},onMouseEnter:d=>d.currentTarget.style.background="#f8fafc",onMouseLeave:d=>d.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:p.includes(a.id),onChange:()=>z(d=>d.includes(a.id)?d.filter(b=>b!==a.id):[...d,a.id])}),e.jsx("span",{style:{color:p.includes(a.id)?"var(--text)":"var(--text-light)",fontWeight:p.includes(a.id)?500:400},children:a.label})]},a.id))}),e.jsxs("div",{style:{borderTop:"1px solid var(--border)",marginTop:"0.75rem",paddingTop:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{onClick:()=>z(yt.map(a=>a.id)),style:{fontSize:"0.8rem",color:"var(--primary)",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Pilih Semua"}),e.jsx("button",{onClick:()=>z(Qt),style:{fontSize:"0.8rem",color:"#64748b",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:k,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>xe(!Y),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",background:Y?"#f1f5f9":"#f8fafc",border:`1px solid ${Y?"var(--primary)":"var(--border)"}`,color:Y?"var(--primary)":"var(--text)",borderRadius:"10px",minWidth:"100px"},children:[e.jsx("span",{style:{fontWeight:600},children:"Filter"}),e.jsx(it,{size:16})]}),Y&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px"},children:[{id:"nama",label:"By Nama"},{id:"id_sambungan",label:"By No. Sambungan"},{id:"petugas",label:"By Petugas"}].map(a=>e.jsx("button",{onClick:()=>{Ce(a.id),xe(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:Ae===a.id?"#f1f5f9":"none",color:Ae===a.id?"var(--primary)":"var(--text)",borderRadius:"8px",cursor:"pointer"},children:a.label},a.id))})]}),S?e.jsx(da,{value:re,onChange:a=>ge(a),disableCurrent:!0,disablePastYears:!0}):e.jsx(za,{value:B,onChange:a=>ne(a)}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(Je,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:Q?"2.5rem":"0.625rem",height:"42px",borderRadius:"10px",border:"1px solid var(--border)",background:"#f8fafc",width:"100%"},placeholder:"Ketik kata kunci pencarian...",value:Q,onChange:a=>ae(a.target.value)}),Q&&e.jsx("button",{onClick:()=>ae(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ce,{size:16})})]})]})}),G?e.jsx("div",{style:{padding:"4rem",textAlign:"center",color:"var(--text-light)"},children:"Loading recordings..."}):e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:e.jsxs("table",{className:"customer-table",style:{tableLayout:"fixed",width:"max-content",minWidth:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"NO"}),p.includes("id_sambungan")&&e.jsx("th",{style:{width:"140px",minWidth:"140px",textAlign:"left"},children:"NO. SAMBUNGAN"}),p.includes("nama")&&e.jsx("th",{style:{width:"200px",minWidth:"200px",textAlign:"left"},children:"NAMA PELANGGAN"}),p.includes("id_meter")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID METER"}),p.includes("alamat")&&e.jsx("th",{style:{width:"250px",minWidth:"250px",textAlign:"left"},children:"ALAMAT"}),p.includes("stan_akhir")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"STAN AKHIR"}),S&&p.includes("pemakaian")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"center"},children:"PEMAKAIAN (m)"}),p.includes("petugas")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"PETUGAS"}),p.includes("foto")&&e.jsx("th",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:"FOTO METER"}),p.includes("foto_rumah")&&e.jsx("th",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:"FOTO RUMAH"}),p.includes("status_laporan")&&e.jsx("th",{style:{width:"140px",minWidth:"140px",textAlign:"center"},children:"KONDISI METER"}),p.includes("koordinat")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"KOORDINAT"}),p.includes("update_date")&&e.jsx("th",{style:{width:"140px",minWidth:"140px",textAlign:"left"},children:"TGL PENCATATAN"}),!S&&e.jsx("th",{className:"no-print sticky-col-right",style:{width:"100px",minWidth:"100px",textAlign:"center",background:"#f8fafc",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"AKSI"})]})}),e.jsx("tbody",{children:Rt.length>0?Rt.map((a,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{width:"60px",minWidth:"60px",textAlign:"center",fontWeight:500,color:"#64748b"},children:(ke-1)*fe+d+1}),p.includes("id_sambungan")&&e.jsx("td",{style:{width:"140px",minWidth:"140px",fontWeight:600,textAlign:"left"},children:a.id_sambungan}),p.includes("nama")&&e.jsx("td",{style:{width:"200px",minWidth:"200px",textAlign:"left"},children:a.nama}),p.includes("id_meter")&&e.jsx("td",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:a.id_meter}),p.includes("alamat")&&e.jsx("td",{title:a.alamat,style:{width:"250px",maxWidth:"250px",minWidth:"250px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:a.alamat}),p.includes("stan_akhir")&&e.jsx("td",{style:{width:"100px",minWidth:"100px",textAlign:"center",fontWeight:600,color:"var(--primary)"},children:a.stan_akhir}),S&&p.includes("pemakaian")&&e.jsx("td",{style:{width:"150px",minWidth:"150px",textAlign:"center"},children:(()=>{const b=Re(a);return b==="Data Belum Tersedia"?e.jsx("span",{style:{fontSize:"0.7rem",color:"#64748b",background:"#f1f5f9",padding:"0.2rem 0.5rem",borderRadius:"4px",fontWeight:500,whiteSpace:"nowrap"},children:"DATA BELUM TERSEDIA"}):e.jsx("span",{style:{fontWeight:600,color:"#0f172a",fontSize:"0.9rem"},children:b})})()}),p.includes("petugas")&&e.jsx("td",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:a.petugas}),p.includes("foto")&&e.jsx("td",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:a.foto?"pointer":"default"},onClick:()=>a.foto&&U(a.foto),title:a.foto?"Klik untuk memperbesar":"Tidak ada foto",children:a.foto?e.jsx("img",{src:a.foto.startsWith("/")?`${Et}${a.foto}`:a.foto,alt:"Foto",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(De,{size:16})})}),p.includes("foto_rumah")&&e.jsx("td",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:a.foto_rumah?"pointer":"default"},onClick:()=>a.foto_rumah&&U(a.foto_rumah),title:a.foto_rumah?"Klik untuk memperbesar":"Tidak ada foto",children:a.foto_rumah?e.jsx("img",{src:a.foto_rumah.startsWith("/")?`${Et}${a.foto_rumah}`:a.foto_rumah,alt:"Foto Rumah",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(De,{size:16})})}),p.includes("status_laporan")&&e.jsx("td",{style:{width:"140px",minWidth:"140px",textAlign:"center"},children:(()=>{const b=c.find(l=>l.kode_kondisi===a.status_laporan)?.status_kondisi||a.status_laporan,t=b==="Normal";return e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:600,backgroundColor:t?"#dcfce7":b?"#fee2e2":"#f1f5f9",color:t?"#166534":b?"#991b1b":"#64748b",display:"inline-block"},children:b||"-"})})()}),p.includes("koordinat")&&e.jsx("td",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:a.latitude&&a.longitude?e.jsx("a",{href:`https://www.google.com/maps?q=${a.latitude},${a.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",fontWeight:500,textDecoration:"underline",fontSize:"0.75rem"},title:"Buka di Google Maps",children:e.jsxs("span",{style:{letterSpacing:"-0.02em"},children:[a.latitude,", ",a.longitude]})}):"-"}),p.includes("update_date")&&e.jsx("td",{style:{width:"140px",minWidth:"140px",fontSize:"0.75rem",textAlign:"left"},children:a.update_date?.slice(0,10)}),!S&&e.jsx("td",{className:"no-print sticky-col-right",style:{width:"100px",minWidth:"100px",textAlign:"center",background:"inherit",padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px"},onClick:()=>Ye(a),title:"Edit",children:e.jsx(et,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px",color:"#ef4444"},onClick:()=>mt(a.id),title:"Hapus",children:e.jsx(Bt,{size:14})})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:p.length+2,style:{textAlign:"center",padding:"2rem",color:"var(--text-light)"},children:"Tidak ada data pencatatan ditemukan."})})})]})}),!G&&Be.length>0&&e.jsxs("div",{className:"no-print",style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:["Menampilkan ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:zt+1})," sampai ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Math.min(ht,Be.length)})," dari ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Be.length})," pencatatan"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",marginBottom:0},children:"Baris per halaman:"}),e.jsx("select",{value:fe,onChange:a=>me(Number(a.target.value)),style:{width:"auto",padding:"0.25rem 0.5rem",height:"auto"},children:[10,25,50,100].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ke===1,onClick:()=>pe(1),children:e.jsx(Ht,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ke===1,onClick:()=>pe(a=>Math.max(1,a-1)),children:e.jsx(Ze,{size:18})}),ut().map(a=>e.jsx("button",{className:`btn ${ke===a?"btn-primary":"btn-outline"}`,style:{minWidth:"36px",height:"36px",padding:0,justifyContent:"center"},onClick:()=>pe(a),children:a},a)),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ke===at,onClick:()=>pe(a=>Math.min(at,a+1)),children:e.jsx(Qe,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ke===at,onClick:()=>pe(at),children:e.jsx(Gt,{size:18})})]})]})]})]}),ee&&e.jsx("div",{className:"modal-overlay",style:{animation:"fadeIn 0.2s",backgroundColor:"rgba(15, 23, 42, 0.75)",backdropFilter:"blur(4px)"},children:e.jsxs("div",{className:"modal-content",style:{animation:"slideUp 0.3s",maxWidth:"950px",borderRadius:"20px",padding:0,overflow:"hidden",maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",background:"white"},children:[e.jsxs("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:[W?"Edit":"Tambah"," Catatan Meter"]}),e.jsx("button",{onClick:tt,style:{width:"36px",height:"36px",background:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer",color:"#64748b",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:e.jsx(ce,{size:20})})]}),e.jsxs("form",{onSubmit:pt,style:{padding:"2rem",overflowY:"auto",flex:1},children:[e.jsxs("div",{className:"modal-grid",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"form-group",style:{position:"relative"},ref:_,children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Pelanggan"}),e.jsxs("div",{onClick:()=>!W&&ze(!we),style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"0.95rem",background:W?"#f8fafc":"white",cursor:W?"not-allowed":"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"45px"},children:[e.jsx("span",{style:{color:s.id_pelanggan?"#1e293b":"#94a3b8"},children:s.id_pelanggan?`${s.id_sambungan} - ${s.nama}`:"Cari dan Pilih Pelanggan"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.id_pelanggan&&!W&&e.jsx("button",{onClick:a=>{a.stopPropagation(),R(d=>({...d,id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",kode_tarif:"",petugas:""})),Z([]),ze(!1)},style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:"#94a3b8",display:"flex",alignItems:"center",borderRadius:"50%"},onMouseEnter:a=>a.currentTarget.style.background="#f1f5f9",onMouseLeave:a=>a.currentTarget.style.background="none",title:"Hapus pilihan",children:e.jsx(ce,{size:16})}),!W&&e.jsx(it,{size:18,style:{color:"#94a3b8",transform:we?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),we&&e.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,zIndex:100,background:"white",border:"1px solid #e2e8f0",borderRadius:"10px",marginTop:"4px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",overflow:"hidden",animation:"fadeIn 0.1s ease-out"},children:[e.jsx("div",{style:{padding:"0.75rem",borderBottom:"1px solid #f1f5f9",background:"#f8fafc"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Je,{size:14,style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Cari pelanggan (Nama / No. Sambungan)...",value:_e,onChange:a=>o(a.target.value),onClick:a=>a.stopPropagation(),style:{width:"100%",padding:"0.5rem 0.75rem 0.5rem 2.25rem",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"0.875rem"}})]})}),e.jsxs("div",{style:{maxHeight:"250px",overflowY:"auto"},children:[O.filter(a=>(a.nama||"").toLowerCase().includes(_e.toLowerCase())||(a.id_sambungan||"").toLowerCase().includes(_e.toLowerCase())).map(a=>e.jsxs("div",{onClick:d=>{d.stopPropagation(),Ge(a.id),ze(!1),o("")},style:{padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",borderBottom:"1px solid #f8fafc",background:s.id_pelanggan==a.id?"#f0f9ff":"white",color:s.id_pelanggan==a.id?"#0ea5e9":"#1e293b"},onMouseEnter:d=>d.currentTarget.style.background="#f8fafc",onMouseLeave:d=>d.currentTarget.style.background=s.id_pelanggan==a.id?"#f0f9ff":"white",children:[e.jsx("div",{style:{fontWeight:600},children:a.id_sambungan}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[a.nama," - ",a.alamat]})]},a.id)),O.filter(a=>(a.nama||"").toLowerCase().includes(_e.toLowerCase())||(a.id_sambungan||"").toLowerCase().includes(_e.toLowerCase())).length===0&&e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#94a3b8",fontSize:"0.875rem"},children:"Pelanggan tidak ditemukan"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Tanggal Pencatatan"}),e.jsxs("div",{style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f8fafc",display:"flex",alignItems:"center",gap:"0.5rem",color:"#64748b",fontSize:"0.875rem"},children:[e.jsx(jt,{size:16}),e.jsx("span",{style:{fontWeight:600},children:W?new Date(s.tahun,s.bulan-1).toLocaleString("id-ID",{month:"long",year:"numeric"}):new Date().toLocaleString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Awal (Bulan Lalu)"}),e.jsxs("div",{style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",background:K.length>0?"#f0f9ff":"#fff1f2",display:"flex",alignItems:"center",gap:"0.5rem",color:K.length>0?"#0369a1":"#be123c",fontSize:"0.95rem",fontWeight:700},children:[e.jsx(sa,{size:16}),e.jsx("span",{children:K.length>0?K[0].stan_akhir:"Stan Awal Belum Tersedia"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Akhir"}),e.jsx("input",{type:"number",style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #e2e8f0"},value:s.stan_akhir,onChange:a=>R({...s,stan_akhir:a.target.value}),onBlur:()=>{s.stan_akhir&&Number(s.stan_akhir)!==0&&We&&!E&&Oe(We,s.stan_akhir)},placeholder:"0",autoComplete:"off"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Pemakaian (m)"}),e.jsxs("div",{style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f8fafc",display:"flex",alignItems:"center",gap:"0.5rem",color:s.stan_akhir&&Number(s.stan_akhir)!==0&&K.length>0&&Number(s.stan_akhir)-Number(K[0].stan_akhir)<0?"#ef4444":"#1e293b",fontSize:"0.95rem",fontWeight:800},children:[e.jsx(rt,{size:16,color:s.stan_akhir&&Number(s.stan_akhir)!==0&&K.length>0&&Number(s.stan_akhir)-Number(K[0].stan_akhir)<0?"#ef4444":"#0ea5e9"}),e.jsx("span",{children:(()=>{const a=Number(s.stan_akhir);if(!s.stan_akhir||a===0)return"0 m";const d=K.length>0?Number(K[0].stan_akhir):0,b=a-d;return b+" m"+(b<0?" (Meter Mundur)":"")})()})]}),e.jsx("div",{style:{marginTop:"0.5rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:ye?e.jsxs("div",{style:{color:"#64748b",fontSize:"0.7rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("div",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}),e.jsx("span",{children:"Menganalisa..."})]}):E?e.jsx(e.Fragment,{children:E.status==="ERROR"?e.jsxs("span",{className:"badge",style:{backgroundColor:"#fee2e2",color:"#991b1b",border:"1px solid #fecaca",fontSize:"0.7rem"},children:[" ",E.message]}):e.jsx(e.Fragment,{children:e.jsx("span",{className:"badge",style:{backgroundColor:E.status==="GREEN"?"#dcfce7":E.status==="YELLOW"?"#fef9c3":"#fee2e2",color:E.status==="GREEN"?"#166534":E.status==="YELLOW"?"#854d0e":"#991b1b",fontSize:"0.75rem",padding:"0.25rem 0.75rem",border:"1px solid",borderColor:E.status==="GREEN"?"#bbf7d0":E.status==="YELLOW"?"#fef08a":"#fecaca"},children:E.status==="GREEN"?" Match 100%":E.status==="YELLOW"?` Match ${E.similarity}%`:` Mismatch (${E.similarity}%)`})})}):null})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-group",children:e.jsx(Ke,{label:"Petugas",value:s.petugas,onChange:a=>R({...s,petugas:a.target.value}),options:r.filter(a=>a.status_aktif==="Aktif").map(a=>({value:a.nama,label:a.cabang?`Cabang ${a.cabang}`:""})),placeholder:"Pilih Petugas",searchPlaceholder:"Cari petugas...",disabled:!!W})}),e.jsx("div",{className:"form-group",children:e.jsx(Ke,{label:"Status Laporan",value:s.status_laporan,onChange:a=>R({...s,status_laporan:a.target.value}),options:c.map(a=>({value:a.kode_kondisi,label:a.status_kondisi})),placeholder:"Pilih Status Laporan",searchPlaceholder:"Cari status laporan...",hideValue:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Latitude"}),e.jsx("input",{type:"text",style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0"},value:s.latitude,onChange:a=>R({...s,latitude:a.target.value}),placeholder:"Contoh: -6.123456"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Longitude"}),e.jsx("input",{type:"text",style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0"},value:s.longitude,onChange:a=>R({...s,longitude:a.target.value}),placeholder:"Contoh: 106.123456"})]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{background:"#f8fafc",borderRadius:"12px",padding:"1rem",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",color:"#64748b",fontSize:"0.875rem",fontWeight:600},children:[e.jsx(jt,{size:16})," Riwayat Pencatatan"]}),K.length>0?e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.75rem",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",padding:"0.5rem",borderBottom:"1px solid #e2e8f0",color:"#64748b"},children:"Bulan"}),e.jsx("th",{style:{textAlign:"right",padding:"0.5rem",borderBottom:"1px solid #e2e8f0",color:"#64748b"},children:"Stan Akhir"})]})}),e.jsx("tbody",{children:K.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{style:{padding:"0.5rem",borderBottom:"1px solid #e2e8f0"},children:[new Date(0,a.bulan-1).toLocaleString("id-ID",{month:"short"})," ",a.tahun]}),e.jsx("td",{style:{padding:"0.5rem",borderBottom:"1px solid #e2e8f0",textAlign:"right",fontWeight:600},children:a.stan_akhir})]},a.id))})]})}):e.jsx("div",{style:{textAlign:"center",padding:"1rem",color:"#ef4444",fontSize:"0.75rem",fontStyle:"italic",fontWeight:600},children:"Stan Awal Belum Tersedia"})]}),e.jsx("div",{style:{borderTop:"1px solid #e2e8f0",margin:"0.5rem 0"}}),e.jsx("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[{id:"foto",label:"FOTO METER",preview:Fe},{id:"foto_rumah",label:"FOTO RUMAH",preview:Pe}].map(a=>e.jsx("div",{style:{textAlign:"center",flex:1},children:e.jsxs("div",{style:{width:"100%",aspectRatio:"4/3",border:W?"2px solid #e2e8f0":"2px dashed #e2e8f0",borderRadius:"12px",position:"relative",overflow:"hidden",background:W?"#f1f5f9":"#f8fafc",cursor:W?"default":"pointer",opacity:W?.8:1},children:[a.preview?e.jsx("img",{src:a.preview&&a.preview.startsWith("/")?`${Et}${a.preview}`:a.preview,style:{width:"100%",height:"100%",objectFit:"cover",filter:W?"grayscale(20%)":"none"},alt:"Preview"}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(De,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]}),!W&&e.jsx("input",{type:"file",onChange:d=>ot(d,a.id),style:{position:"absolute",inset:0,opacity:0,cursor:"pointer"}}),e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,background:"rgba(0,0,0,0.6)",color:"white",fontSize:"0.65rem",padding:"6px",fontWeight:600,textAlign:"center"},children:[a.label," ",W&&"(View Only)"]}),a.preview&&!W&&e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),ct(a.id)},style:{position:"absolute",top:"4px",right:"4px",zIndex:20,background:"#ef4444",border:"none",borderRadius:"6px",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:"pointer",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Hapus Foto",children:e.jsx(ce,{size:12,strokeWidth:3})})]})},a.id))}),J&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--primary)",textAlign:"center"},children:["Mengupload foto... (",Math.round(Me),"%)"]})]})]}),e.jsxs("div",{style:{marginTop:"2.5rem",paddingTop:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{padding:"0.75rem 1.5rem",borderRadius:"10px"},onClick:tt,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{padding:"0.75rem 2rem",borderRadius:"10px",fontWeight:600},disabled:J,children:J?"Memproses...":W?"Simpan Perubahan":"Simpan Data"})]})]})]})}),F&&e.jsx("div",{className:"lightbox-overlay",onClick:()=>U(null),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem",animation:"fadeIn 0.2s"},children:e.jsxs("div",{style:{position:"relative",maxWidth:"90%",maxHeight:"90%"},onClick:a=>a.stopPropagation(),children:[e.jsx("button",{style:{position:"absolute",top:"-40px",right:0,background:"none",border:"none",color:"white",cursor:"pointer"},onClick:()=>U(null),children:e.jsx(ce,{size:32})}),e.jsx("img",{src:F&&F.startsWith("/")?`${Et}${F}`:F,alt:"Preview",style:{maxWidth:"100%",maxHeight:"85vh",borderRadius:"8px",boxShadow:"0 20px 40px rgba(0,0,0,0.3)"}})]})}),e.jsxs("div",{className:"print-footer",children:[e.jsx("p",{style:{margin:"0 0 40px 0"},children:"Dicetak oleh,"}),e.jsx("div",{style:{borderBottom:"1px solid black",width:"200px",margin:"0 auto 10px auto"}}),e.jsx("p",{children:localStorage.getItem("username")||"Admin"})]})]})}const Lt="./api/officers.php",ta="http://localhost",lt=[{id:"id",label:"ID"},{id:"nik",label:"NIK"},{id:"ktp",label:"NO. KTP"},{id:"kode_cabang",label:"CABANG"},{id:"kode_rute",label:"RUTE"},{id:"nama",label:"NAMA PETUGAS"},{id:"foto_petugas",label:"FOTO"},{id:"alamat",label:"ALAMAT"},{id:"telepon",label:"NO. TELEPON"},{id:"tgl_masuk",label:"TGL MASUK"},{id:"tgl_keluar",label:"TGL KELUAR"},{id:"status_aktif",label:"STATUS"},{id:"update_date",label:"LAST UPDATE"}],aa=["id","nik","ktp","foto_petugas","kode_cabang","nama","telepon","status_aktif"];function Na(){const[S,H]=i.useState([]),[A,I]=i.useState([]),[v,O]=i.useState(""),[w,G]=i.useState(!1),[T,Q]=i.useState(!1),[ae,ee]=i.useState(null),[L,W]=i.useState(null),[g,x]=i.useState({nik:"",nama:"",alamat:"",telepon:"",ktp:"",tgl_masuk:"",tgl_keluar:"",kode_cabang:"",kode_rute:[],foto_petugas:"",status_aktif:"Aktif"}),[u,Y]=i.useState([]),[xe,V]=i.useState([]),[k,p]=i.useState(!1),[z,ke]=i.useState(""),[pe,fe]=i.useState(!1),[me,Ae]=i.useState(!1),[Ce,Fe]=i.useState("nama"),[se,Pe]=i.useState(()=>{const r=localStorage.getItem("pdam_visible_columns_officers_v2");return r?JSON.parse(r):aa}),[y,F]=i.useState(1),[U,J]=i.useState(10),le=i.useRef(null),Me=i.useRef(null);i.useEffect(()=>{ye();const r=h=>{le.current&&!le.current.contains(h.target)&&fe(!1),Me.current&&!Me.current.contains(h.target)&&Ae(!1)};return document.addEventListener("mousedown",r),ue(),()=>document.removeEventListener("mousedown",r)},[]),i.useEffect(()=>{g.kode_cabang?We(g.kode_cabang):V([])},[g.kode_cabang]);const ue=async()=>{try{const h=await(await fetch("./api/options.php?type=cabang")).json();Y(Array.isArray(h)?h:[])}catch(r){console.error("Failed to fetch branches:",r)}},We=async r=>{try{const $=(await(await fetch(`./api/branch_routes.php?kode_cabang=${r}`)).json()).filter(X=>X.assigned).map(X=>({kode_rute:X.kode_rute,rute:X.rute}));V(Array.isArray($)?$:[])}catch(h){console.error("Failed to fetch routes:",h)}};i.useEffect(()=>{const r=v.toLowerCase(),h=S.filter(c=>v?Ce==="nama"?c.nama&&c.nama.toLowerCase().includes(r):Ce==="nik"?c.nik&&String(c.nik).includes(r):Ce==="alamat"?c.alamat&&c.alamat.toLowerCase().includes(r):!1:!0);I(h),F(1)},[v,S,Ce]);const[je,Ee]=i.useState(!1),[ve,E]=i.useState(0),be=r=>{const h=r.target.files[0];if(h){if(h.size>2*1024*1024){oe.fire("Error","Ukuran foto maksimal 2MB","error");return}Ee(!0),E(0);const c=new FileReader;let $=0;const X=setInterval(()=>{$+=Math.random()*30,$>=100&&($=100,clearInterval(X),c.onloadend=()=>{x(D=>({...D,foto_petugas:c.result})),ee(D=>({...D,selectedFile:h})),setTimeout(()=>{Ee(!1),E(0)},500)},c.readAsDataURL(h)),E($)},100)}},ye=async()=>{try{G(!0);const h=await(await fetch(Lt)).json();H(Array.isArray(h)?h:[])}catch(r){console.error("Failed to fetch officers:",r),oe.fire("Error","Gagal memuat data petugas","error")}finally{G(!1)}},q=(r=null)=>{r?(ee(r),x({nik:r.nik||"",nama:r.nama||"",alamat:r.alamat||"",telepon:r.telepon||"",ktp:r.ktp||"",tgl_masuk:r.tgl_masuk||"",tgl_keluar:r.tgl_keluar||"",kode_cabang:r.kode_cabang||"",kode_rute:Array.isArray(r.kode_rute)?r.kode_rute:r.kode_rute?[r.kode_rute]:[],foto_petugas:r.foto_petugas||"",status_aktif:r.status_aktif||"Aktif"})):(ee(null),x({nik:"",nama:"",alamat:"",telepon:"",ktp:"",tgl_masuk:new Date().toISOString().split("T")[0],tgl_keluar:"",kode_cabang:"",kode_rute:[],foto_petugas:"",status_aktif:"Aktif"})),Q(!0)},Te=()=>{Q(!1),ee(null)},$e=async r=>{r.preventDefault();const h=new FormData;h.append("nik",g.nik),h.append("nama",g.nama),h.append("alamat",g.alamat),h.append("telepon",g.telepon),h.append("ktp",g.ktp),h.append("tgl_masuk",g.tgl_masuk),h.append("tgl_keluar",g.tgl_keluar),h.append("kode_cabang",g.kode_cabang),h.append("kode_rute",g.kode_rute),h.append("status_aktif",g.status_aktif),ae?.selectedFile?h.append("foto_petugas",ae.selectedFile):h.append("foto_petugas",g.foto_petugas||"");const c=ae&&ae.id?`${Lt}?id=${ae.id}`:Lt;try{G(!0);const X=await(await fetch(c,{method:"POST",body:h})).json();if(X.message)oe.fire("Sukses",ae?"Data petugas diperbarui":"Data petugas ditambahkan","success"),Q(!1),ye();else throw new Error(X.error||"Gagal menyimpan")}catch($){console.error($),oe.fire("Error","Gagal menyimpan data petugas","error")}finally{G(!1)}},we=async r=>{if((await oe.fire({title:"Hapus Petugas?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal",confirmButtonColor:"#ef4444"})).isConfirmed)try{const $=await(await fetch(`${Lt}?id=${r}`,{method:"DELETE"})).json();if($.message)oe.fire("Terhapus!","Data petugas telah dihapus.","success"),ye();else throw new Error($.error)}catch(c){oe.fire("Gagal!",c.message,"error")}},ze=()=>{const r=lt.filter(he=>se.includes(he.id)&&he.id!=="foto_petugas"),h=r.map(he=>he.label),c=A.map(he=>r.map(Oe=>he[Oe.id]||"-")),$=[h,...c].map(he=>he.map(Oe=>`"${Oe}"`).join(",")).join(`
`),X=new Blob([$],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(X),te=document.createElement("a");te.setAttribute("href",D),te.setAttribute("download",`data_petugas_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(te),te.click(),document.body.removeChild(te)},_e=()=>{const r=lt.filter(X=>se.includes(X.id)&&X.id!=="foto_petugas"),h=A.map(X=>{const D={};return r.forEach(te=>{D[te.label]=X[te.id]||"-"}),D}),c=Ie.json_to_sheet(h),$=Ie.book_new();Ie.book_append_sheet($,c,"Petugas"),Tt($,`data_petugas_${new Date().toISOString().split("T")[0]}.xlsx`)},o=()=>{const r=new Ct("l","mm","a4"),h=new Date().toLocaleString("id-ID"),c=lt.filter(D=>se.includes(D.id)&&D.id!=="foto_petugas");r.setFontSize(18),r.setTextColor(14,165,233),r.text("Laporan Data Petugas PDAM",14,15),r.setFontSize(10),r.setTextColor(100),r.text(`Jumlah Total: ${A.length} Petugas`,14,22),r.text(`Waktu Cetak: ${h}`,280,22,{align:"right"});const $=["No",...c.map(D=>D.label)],X=A.map((D,te)=>[te+1,...c.map(he=>D[he.id]||"-")]);At(r,{startY:28,head:[$],body:X,theme:"grid",headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"},styles:{fontSize:8}}),r.save(`data_petugas_${new Date().toISOString().split("T")[0]}.pdf`)},_=()=>{window.print()},s=y*U,R=s-U,K=A.slice(R,s),Z=Math.ceil(A.length/U);return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .customer-table {
                        width: 100%;
                        border-collapse: separate; /* Recommended for sticky headers */
                        border-spacing: 0;
                    }
                    .customer-table thead th {
                        position: sticky;
                        top: 0;
                        z-index: 30;
                        background: #f1f5f9 !important;
                        box-shadow: 0 2px 4px -1px rgba(0,0,0,0.06);
                        border-bottom: 2px solid var(--border) !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) td {
                        background-color: #f8fafc;
                    }
                    .customer-table tbody tr:hover td {
                        background-color: #f1f5f9 !important;
                    }
                    .customer-table td, .customer-table th {
                        padding: 0.625rem 0.75rem !important;
                        vertical-align: middle;
                        font-size: 0.875rem;
                    }
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left {
                        background-color: #f8fafc !important;
                    }
                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #f8fafc !important;
                    }
                    .badge {
                        padding: 0.25rem 0.75rem;
                        border-radius: 9999px;
                        font-size: 0.75rem;
                        font-weight: 600;
                    }
                    .badge-active {
                        background-color: #dcfce7;
                        color: #166534;
                    }
                    .badge-inactive {
                        background-color: #fee2e2;
                        color: #991b1b;
                    }

                    @media print {
                        .no-print, .no-print * {
                            display: none !important;
                        }
                        
                        body {
                            background: white !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .card {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .table-container {
                            overflow: visible !important;
                            max-height: none !important;
                            width: 100% !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .customer-table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            table-Layout: auto !important;
                            font-size: 8pt !important;
                        }

                        .customer-table th, .customer-table td {
                            border: 1px solid #e2e8f0 !important;
                            padding: 4pt !important;
                            overflow: visible !important;
                            white-space: normal !important;
                            word-break: break-word !important;
                            min-width: 0 !important;
                            width: auto !important;
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .sticky-col-left {
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        @page {
                            size: landscape;
                            margin: 1cm;
                        }

                        header.header {
                            margin-bottom: 1rem !important;
                        }

                        h1 {
                            font-size: 16pt !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx(oa,{size:32,color:"var(--primary)"}),"Manajemen Petugas"]}),e.jsx("p",{style:{color:"#64748b"},children:"Kelola daftar petugas pencatat meter"})]}),e.jsxs("div",{className:"header-actions no-print",style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:ze,title:"Export CSV",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:_e,title:"Export Excel",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:o,title:"Export PDF",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:_,title:"Print",style:{padding:"0.6rem",borderRadius:"10px"},children:e.jsx(_t,{size:18})})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>q(),style:{padding:"0.75rem 1.5rem",borderRadius:"10px",fontSize:"0.95rem",whiteSpace:"nowrap"},children:[e.jsx(st,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Petugas"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flex:1,minWidth:"300px"},children:[e.jsxs("div",{style:{position:"relative"},ref:le,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>fe(!pe),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",background:pe?"#f1f5f9":"#f8fafc",border:`1px solid ${pe?"var(--primary)":"var(--border)"}`,color:pe?"var(--primary)":"var(--text)",borderRadius:"10px"},children:[e.jsx(St,{size:18}),e.jsx("span",{style:{fontWeight:500},children:"Pilih Kolom"})]}),pe&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px",maxHeight:"400px",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",flexShrink:0},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem",overflowY:"auto"},children:lt.map(r=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px"},onMouseEnter:h=>h.currentTarget.style.background="#f8fafc",onMouseLeave:h=>h.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:se.includes(r.id),onChange:()=>Pe(h=>h.includes(r.id)?h.filter(c=>c!==r.id):[...h,r.id])}),e.jsx("span",{style:{color:se.includes(r.id)?"var(--text)":"var(--text-light)",fontWeight:se.includes(r.id)?500:400},children:r.label})]},r.id))}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",gap:"1rem",flexShrink:0},children:[e.jsx("button",{style:{background:"none",border:"none",color:"var(--primary)",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>Pe(lt.map(r=>r.id)),onMouseEnter:r=>r.currentTarget.style.background="rgba(14, 165, 233, 0.05)",onMouseLeave:r=>r.currentTarget.style.background="none",children:"Pilih Semua"}),e.jsx("button",{style:{background:"none",border:"none",color:"#64748b",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>Pe(aa),onMouseEnter:r=>r.currentTarget.style.background="#f1f5f9",onMouseLeave:r=>r.currentTarget.style.background="none",children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:Me,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>Ae(!me),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",background:me?"#f1f5f9":"#f8fafc",border:`1px solid ${me?"var(--primary)":"var(--border)"}`,color:me?"var(--primary)":"var(--text)",borderRadius:"10px",minWidth:"100px"},children:[e.jsx("span",{style:{fontWeight:600},children:"Filter"}),e.jsx(it,{size:16})]}),me&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px"},children:[{id:"nama",label:"By Nama"},{id:"nik",label:"By NIK"},{id:"alamat",label:"By Alamat"},{id:"kode_cabang",label:"By Cabang"},{id:"kode_rute",label:"By Rute"},{id:"telepon",label:"By No. Telepon"},{id:"tgl_masuk",label:"By Tanggal Masuk"},{id:"tgl_keluar",label:"By Tanggal Keluar"},{id:"status_aktif",label:"By Status"}].map(r=>e.jsx("button",{onClick:()=>{Fe(r.id),Ae(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:Ce===r.id?"#f1f5f9":"none",color:Ce===r.id?"var(--primary)":"var(--text)",borderRadius:"8px",cursor:"pointer"},children:r.label},r.id))})]}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(Je,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:v?"2.5rem":"0.625rem",height:"42px",borderRadius:"10px",border:"1px solid var(--border)",background:"#f8fafc",width:"100%"},placeholder:`Cari ${Ce==="nama"?"Nama":Ce==="nik"?"NIK":"Alamat"}...`,value:v,onChange:r=>O(r.target.value)}),v&&e.jsx("button",{onClick:()=>O(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ce,{size:16})})]})]}),!w&&A.length>0&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:y===1,onClick:()=>F(r=>Math.max(1,r-1)),children:e.jsx(Ze,{size:16})}),e.jsxs("span",{style:{fontSize:"0.875rem"},children:["Halaman ",e.jsx("strong",{children:y})," dari ",Z]}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:y===Z,onClick:()=>F(r=>Math.min(Z,r+1)),children:e.jsx(Qe,{size:16})})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto",margin:"1rem -1rem 0",width:"calc(100% + 2rem)"},children:e.jsxs("table",{className:"customer-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"60px",textAlign:"center"},children:"NO"}),se.map(r=>{const h=lt.find($=>$.id===r);if(!h)return null;let c={padding:"0.625rem 0.75rem",whiteSpace:"nowrap",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em",background:"#f8fafc"};switch(r){case"id":c={...c,minWidth:"60px",textAlign:"center"};break;case"nik":c={...c,minWidth:"110px",textAlign:"left"};break;case"ktp":c={...c,minWidth:"130px",textAlign:"left"};break;case"kode_cabang":c={...c,minWidth:"80px",textAlign:"center"};break;case"kode_rute":c={...c,minWidth:"80px",textAlign:"center"};break;case"nama":c={...c,minWidth:"220px",textAlign:"left"};break;case"foto_petugas":c={...c,minWidth:"80px",textAlign:"center"};break;case"alamat":c={...c,minWidth:"280px",textAlign:"left"};break;case"telepon":c={...c,minWidth:"120px",textAlign:"left"};break;case"tgl_masuk":case"tgl_keluar":c={...c,minWidth:"110px",textAlign:"center"};break;case"status_aktif":c={...c,minWidth:"100px",textAlign:"center"};break;case"update_date":c={...c,minWidth:"150px",textAlign:"left"};break;default:c={...c,minWidth:"150px",textAlign:"left"}}return e.jsx("th",{style:c,children:h.label},r)}),e.jsx("th",{className:"no-print sticky-col-right",style:{width:"100px",textAlign:"center",background:"#f8fafc",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"AKSI"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:se.length+2,style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Memuat data..."})}):K.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:se.length+2,style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Tidak ada data ditemukan"})}):K.map((r,h)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{textAlign:"center",fontWeight:500,color:"#64748b",padding:"12px 16px"},children:h+1+(y-1)*U}),se.map(c=>{const $="12px 16px";if(c==="status_aktif")return e.jsx("td",{style:{textAlign:"center",padding:$},children:e.jsx("span",{className:`badge ${r.status_aktif==="Aktif"?"badge-active":"badge-inactive"}`,children:r[c]||"-"})},c);if(c==="foto_petugas")return e.jsx("td",{style:{width:"80px",textAlign:"center",padding:$},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:r.foto_petugas?"pointer":"default"},onClick:()=>r.foto_petugas&&W(r.foto_petugas),title:r.foto_petugas?"Klik untuk memperbesar":"Tidak ada foto",children:r.foto_petugas?e.jsx("img",{src:r.foto_petugas&&r.foto_petugas.startsWith("/")?`${ta}${r.foto_petugas}`:r.foto_petugas,alt:"Foto",style:{width:"100%",height:"100%",objectFit:"cover"},onError:D=>{D.target.onerror=null,D.target.style.display="none",D.target.parentElement.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;width:100%"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-camera"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg></div>'}}):e.jsx(De,{size:16})})},c);const X=["id","kode_cabang","kode_rute","tgl_masuk","tgl_keluar"].includes(c);return e.jsx("td",{style:{textAlign:X?"center":"left",padding:$,fontWeight:c==="nama"?600:400,color:c==="nama"?"#334155":"inherit"},children:c==="kode_rute"?Array.isArray(r[c])&&r[c].length>0?r[c].length>1?`${r[c][0]},`:r[c][0]:e.jsx("span",{style:{color:"#94a3b8",fontStyle:"italic",fontSize:"0.8rem"},children:"Belum ada Rute"}):r[c]||"-"},c)}),e.jsx("td",{className:"no-print sticky-col-right",style:{textAlign:"center",background:"inherit",padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px"},onClick:()=>q(r),title:"Edit",children:e.jsx(et,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px",color:"#ef4444"},onClick:()=>we(r.id),title:"Hapus",children:e.jsx(Bt,{size:14})})]})})]},r.id))})]})})]}),L&&e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:2e3,background:"rgba(0,0,0,0.9)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"zoom-out"},onClick:()=>W(null),children:[e.jsx("img",{src:L&&L.startsWith("/")?`${ta}${L}`:L,alt:"Full Preview",style:{maxWidth:"90%",maxHeight:"90vh",objectFit:"contain",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}}),e.jsx("button",{style:{position:"absolute",top:"2rem",right:"2rem",background:"white",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onClick:()=>W(null),children:e.jsx(ce,{size:24,color:"#000"})})]}),T&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"white",borderRadius:"20px",width:"100%",maxWidth:"800px",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,background:"white",zIndex:10},children:[e.jsxs("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#0f172a",display:"flex",alignItems:"center",gap:"0.75rem"},children:[ae?e.jsx(et,{size:24,color:"var(--primary)"}):e.jsx(st,{size:24,color:"var(--primary)"}),ae?"Edit Petugas":"Tambah Petugas"]}),e.jsx("button",{onClick:Te,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s"},onMouseEnter:r=>r.currentTarget.style.color="#64748b",onMouseLeave:r=>r.currentTarget.style.color="#94a3b8",children:e.jsx(ce,{size:24})})]}),e.jsxs("form",{onSubmit:$e,style:{padding:"2rem"},children:[e.jsxs("div",{className:"grid-6-col-responsive",children:[e.jsx("div",{className:"form-group",style:{gridColumn:"span 6"},children:e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"0.5rem"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{width:"180px",height:"140px",border:"2px dashed #cbd5e1",borderRadius:"16px",padding:"0",background:"#f8fafc",transition:"all 0.3s",cursor:"pointer",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},onClick:()=>document.getElementById("foto-upload").click(),onMouseEnter:r=>{r.currentTarget.style.borderColor="var(--primary)",r.currentTarget.style.background="#f1f5f9"},onMouseLeave:r=>{r.currentTarget.style.borderColor="#cbd5e1",r.currentTarget.style.background="#f8fafc"},children:[e.jsx("input",{id:"foto-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:r=>be(r)}),g.foto_petugas?e.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[e.jsx("img",{src:g.foto_petugas,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.5), transparent)",display:"flex",alignItems:"flex-end",justifyContent:"center",padding:"1rem"},children:e.jsxs("span",{style:{color:"white",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(De,{size:16})," Ganti Foto"]})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(De,{size:32}),e.jsx("span",{style:{fontSize:"0.75rem",marginTop:"0.5rem",fontWeight:500},children:"Ambil Foto"})]}),je&&e.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(255,255,255,0.8)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:10},children:[e.jsx("div",{style:{width:"48px",height:"48px",border:"4px solid #e2e8f0",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"}}),e.jsxs("span",{style:{fontWeight:600,color:"var(--primary)"},children:["Mengupload... ",Math.round(ve),"%"]})]})]}),e.jsx("div",{style:{background:"rgba(30, 41, 59, 0.7)",color:"white",fontSize:"0.65rem",padding:"6px",fontWeight:600,letterSpacing:"0.025em",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px",marginTop:"-24px",position:"relative",zIndex:5,width:"180px",marginInline:"auto"},children:"FOTO PETUGAS"})]})})}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"NIK"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"NIK Petugas",value:g.nik,onChange:r=>x({...g,nik:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 4"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Nama Lengkap"}),e.jsx("input",{type:"text",required:!0,className:"input-field",placeholder:"Nama Petugas",value:g.nama,onChange:r=>x({...g,nama:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 6"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Alamat"}),e.jsx("textarea",{rows:"2",className:"input-field",placeholder:"Alamat Lengkap",value:g.alamat,onChange:r=>x({...g,alamat:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"No. Telepon"}),e.jsx("input",{type:"text",className:"input-field",placeholder:"08xxx",value:g.telepon,onChange:r=>x({...g,telepon:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"No. KTP"}),e.jsx("input",{type:"text",className:"input-field",placeholder:"Nomor KTP",value:g.ktp,onChange:r=>x({...g,ktp:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Status Aktif"}),e.jsxs("select",{className:"input-field",value:g.status_aktif,onChange:r=>x({...g,status_aktif:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[e.jsx("option",{value:"Aktif",children:"Aktif"}),e.jsx("option",{value:"Tidak Aktif",children:"Tidak Aktif"})]})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 3"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Tanggal Masuk"}),e.jsx("input",{type:"date",className:"input-field",value:g.tgl_masuk,onChange:r=>x({...g,tgl_masuk:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 3"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Tanggal Keluar"}),e.jsx("input",{type:"date",className:"input-field",value:g.tgl_keluar,onChange:r=>x({...g,tgl_keluar:r.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{style:{display:"contents"},children:[e.jsx(Ke,{label:"Cabang",containerStyle:{gridColumn:"span 3",marginBottom:0},options:u.map(r=>({value:r.kode_cabang,label:r.cabang})),value:g.kode_cabang,onChange:r=>x({...g,kode_cabang:r.target.value,kode_rute:[]}),placeholder:"Pilih Cabang",searchPlaceholder:"Cari cabang...",required:!0}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 3",marginBottom:0},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Rute yang Ditangani"}),e.jsxs("button",{type:"button",disabled:!g.kode_cabang,onClick:()=>p(!0),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0",background:g.kode_cabang?"white":"#f8fafc",textAlign:"left",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:g.kode_cabang?"pointer":"not-allowed",color:g.kode_cabang?"#334155":"#94a3b8"},children:[e.jsx("span",{children:g.kode_rute.length>0?`${g.kode_rute.length} Rute Dipilih`:g.kode_cabang?"Pilih Rute":"Pilih Cabang Dahulu"}),e.jsx(Kt,{size:18})]})]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem",marginTop:"2rem"},children:[e.jsx("button",{type:"button",onClick:Te,className:"btn btn-outline",style:{padding:"0.75rem 1.5rem",borderRadius:"10px"},children:"Batal"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",style:{padding:"0.75rem 2rem",borderRadius:"10px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ka,{size:18})," Simpan"]})]})]})]})}),k&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[e.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:700,color:"#0f172a"},children:"Pilih Rute"}),e.jsx("button",{onClick:()=>p(!1),style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer"},children:e.jsx(ce,{size:24})})]}),e.jsxs("div",{style:{padding:"1rem 1.5rem",borderBottom:"1px solid #f1f5f9",background:"#f8fafc"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Je,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{autoFocus:!0,placeholder:"Ketik untuk mencari rute...",value:z,onChange:r=>ke(r.target.value),style:{paddingLeft:"2.5rem",paddingRight:z?"2.5rem":"1rem",height:"44px",borderRadius:"8px",border:"2px solid var(--primary)",width:"100%",fontSize:"0.95rem",boxShadow:"0 0 0 3px rgba(14, 165, 233, 0.1)"}}),z&&e.jsx("button",{onClick:()=>ke(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"#e2e8f0",border:"none",borderRadius:"50%",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#64748b",transition:"all 0.2s"},onMouseEnter:r=>{r.currentTarget.style.background="#cbd5e1",r.currentTarget.style.color="#334155"},onMouseLeave:r=>{r.currentTarget.style.background="#e2e8f0",r.currentTarget.style.color="#64748b"},title:"Clear search",children:e.jsx(ce,{size:14})})]}),e.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.875rem",color:"#64748b",fontWeight:500},children:[g.kode_rute.length," dari ",xe.length," rute dipilih"]})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem 1.5rem"},children:xe.length===0?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#94a3b8"},children:"Tidak ada rute tersedia untuk cabang ini"}):e.jsx("div",{style:{display:"grid",gap:"0.5rem"},children:xe.filter(r=>r.kode_rute.toLowerCase().includes(z.toLowerCase())||r.rute.toLowerCase().includes(z.toLowerCase())).map(r=>e.jsxs("label",{className:`route-checkbox-item ${g.kode_rute.includes(r.kode_rute)?"selected":""}`,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:g.kode_rute.includes(r.kode_rute),onChange:()=>{x(h=>({...h,kode_rute:h.kode_rute.includes(r.kode_rute)?h.kode_rute.filter(c=>c!==r.kode_rute):[...h.kode_rute,r.kode_rute]}))},style:{width:"18px",height:"18px",accentColor:"var(--primary)",cursor:"pointer"}}),e.jsxs("div",{style:{flex:1,pointerEvents:"none"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem",color:"#0f172a"},children:r.kode_rute}),e.jsx("div",{style:{fontSize:"0.8125rem",color:"#64748b"},children:r.rute})]})]},r.kode_rute))})}),e.jsx("div",{style:{padding:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",gap:"1rem",justifyContent:"flex-end"},children:e.jsx("button",{onClick:()=>p(!1),className:"btn btn-primary",style:{padding:"0.75rem 2rem",borderRadius:"10px",fontWeight:600},children:"Selesai"})})]})}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .route-checkbox-item {
                    background: white;
                    transition: background-color 0.15s ease;
                }
                .route-checkbox-item:hover {
                    background: #f8fafc;
                }
                .route-checkbox-item.selected {
                    background: #f0f9ff;
                }
                .route-checkbox-item.selected:hover {
                    background: #e0f2fe;
                }
            `}})]})}const na="./api/recordings.php",Ia="./api/customers.php",dt="http://localhost",Yt=[{id:"id_sambungan",label:"NO. SAMBUNGAN"},{id:"id_meter",label:"ID METER"},{id:"id_tag",label:"ID TAG"},{id:"nama",label:"NAMA"},{id:"alamat",label:"ALAMAT"},{id:"kode_tarif",label:"TARIF"},{id:"stan_akhir",label:"STAND AKHIR"},{id:"stan_awal",label:"STAN AWAL"},{id:"koordinat",label:"KOORDINAT"},{id:"PEMAKAIAN (m)",label:"PEMAKAIAN (m)"},{id:"hasil_analisa",label:"HASIL ANALISA"},{id:"ai_ocr_status",label:"STATUS OCR"},{id:"status_laporan",label:"KONDISI METER"}],ra=["id_sambungan","id_meter","id_tag","nama","alamat","kode_tarif","stan_akhir","stan_awal","PEMAKAIAN (m)","ai_ocr_status","hasil_analisa","status_laporan"];function Ma(){const[S,H]=i.useState([]),[A,I]=i.useState([]),[v,O]=i.useState([]),[w,G]=i.useState(!0),[T,Q]=i.useState(""),[ae,ee]=i.useState(!1),[L,W]=i.useState(!1),g=i.useRef(null),x=i.useRef(null),[u,Y]=i.useState(()=>{const t=localStorage.getItem("pdam_visible_columns_analysis");return t?JSON.parse(t):ra}),[xe,V]=i.useState(!1),[k,p]=i.useState(null),[z,ke]=i.useState(null),[pe,fe]=i.useState([]),[me,Ae]=i.useState(null),[Ce,Fe]=i.useState(!1),[se,Pe]=i.useState(null),[y,F]=i.useState(null),[U,J]=i.useState(1),[le,Me]=i.useState({x:0,y:0}),[ue,We]=i.useState(!1),[je,Ee]=i.useState({x:0,y:0}),ve=i.useRef(null),[E,be]=i.useState(1),[ye,q]=i.useState(10),[Te,$e]=i.useState("nama"),[we,ze]=i.useState(()=>Ue(new Date)),[_e,o]=i.useState(!1),[_,s]=i.useState(null),[R,K]=i.useState([]),[Z,r]=i.useState(null),[h,c]=i.useState(null),[$,X]=i.useState(null),[D,te]=i.useState({id:"",id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",kode_tarif:"",stan_awal:"",stan_akhir:0,pemakaian:"",petugas:"",status_laporan:"",latitude:"",longitude:"",foto:null,foto_rumah:null,bulan:"",tahun:"",ai_ocr_status:""}),he=async()=>{try{G(!0);const[t,l]=await Promise.all([fetch(na),fetch(Ia)]),[m,f]=await Promise.all([t.json(),l.json()]);H(Array.isArray(m)?m:[]),I(Array.isArray(f)?f:[])}catch(t){console.error("Failed to fetch data:",t),oe.fire("Error","Gagal memuat data analis.","error")}finally{G(!1)}},Oe=async()=>{try{const l=await(await fetch("./api/options.php?type=status_kondisi")).json();O(Array.isArray(l)?l:[])}catch(t){console.error("Failed to fetch status kondisi:",t)}},Ge=t=>A.find(l=>String(l.id)===String(t))||{},Ye=t=>{let l=parseInt(t.bulan)-1,m=parseInt(t.tahun);l===0&&(l=12,m-=1);const f=S.find(C=>(String(C.id_pelanggan)===String(t.id_pelanggan)||C.id_sambungan&&t.id_sambungan&&String(C.id_sambungan)===String(t.id_sambungan))&&parseInt(C.bulan)===l&&parseInt(C.tahun)===m);return f?parseInt(f.stan_akhir):0},tt=(t,l)=>!t||!l?null:`https://www.google.com/maps?q=${t},${l}`,[ot,ct]=i.useState([]);i.useEffect(()=>{he(),Oe(),M(),pt()},[]);const pt=async()=>{try{K([{id:1,nama:"Warsono",status_aktif:"Aktif",cabang:"Utama"},{id:2,nama:"Budi Santoso",status_aktif:"Aktif",cabang:"Utama"},{id:3,nama:"Ahmad Yani",status_aktif:"Aktif",cabang:"Barat"}])}catch(t){console.error("Error fetching officers:",t)}},mt=async t=>{s(t);const l=Ye(t),m=parseInt(t.stan_akhir)-l;te({id:t.id,id_pelanggan:t.id_pelanggan,id_sambungan:t.id_sambungan,id_meter:t.id_meter,nama:t.nama,alamat:t.alamat,kode_tarif:t.kode_tarif,stan_awal:l,stan_akhir:t.stan_akhir,pemakaian:m,petugas:t.petugas,status_laporan:t.status_laporan,latitude:t.latitude,longitude:t.longitude,foto:t.foto,foto_rumah:t.foto_rumah,bulan:t.bulan,tahun:t.tahun,ai_ocr_status:t.ai_ocr_status}),r(t.foto),c(t.foto_rumah),o(!0)},n=()=>{o(!1),s(null),r(null),c(null)},j=async t=>{t.preventDefault();try{G(!0);const l=new FormData;let m=D.ai_ocr_status;if(D.ai_ocr_status!=="GREEN"&&(m="VERIFIED"),Object.keys(D).forEach(C=>{C==="ai_ocr_status"?l.append(C,m):l.append(C,D[C]===0||D[C]?D[C]:"")}),!(await fetch(`${na}${_?"?id="+_.id:""}`,{method:"POST",body:l})).ok)throw new Error("Failed to update recording");await he(),n(),oe.fire({icon:"success",title:"Berhasil",text:"Data pencatatan berhasil diperbarui",timer:1500,showConfirmButton:!1})}catch(l){console.error("Error saving edit:",l),oe.fire({icon:"error",title:"Gagal",text:"Terjadi kesalahan saat menyimpan data"})}finally{G(!1)}};i.useEffect(()=>{const t=l=>{g.current&&!g.current.contains(l.target)&&ee(!1),x.current&&!x.current.contains(l.target)&&W(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const M=async()=>{try{const l=await(await fetch("./api/options.php?type=status_analisa")).json();ct(Array.isArray(l)?l:[])}catch(t){console.error("Failed to fetch status analisa:",t)}},N=t=>{const l=Ye(t),m=parseInt(t.stan_akhir)-l;return parseInt(t.stan_akhir)===0?0:m},B=t=>{if(t<0)return"Meter Mundur";if(!ot.length)return"-";const l=ot.find(m=>{const f=parseInt(m.min),C=parseInt(m.max);return t>=f&&t<=C});return l?l.status_analisa:"-"},ne=t=>{if(!t)return"#64748b";const l=t.toLowerCase();return l.includes("mundur")?"#ef4444":l.includes("lonjakan")||l.includes("tinggi")||l.includes("diatas")?"#f97316":l.includes("periksa")?"#eab308":l.includes("nol")||l.includes("tidak ada")?"#8b5cf6":l.includes("normal")?"#22c55e":"#64748b"},re=S.filter(t=>{const l=we.getMonth()+1,m=we.getFullYear();if(parseInt(t.bulan)!==l||parseInt(t.tahun)!==m)return!1;const f=T.toLowerCase().trim();if(!f)return!0;const C=Ge(t.id_pelanggan);return Te==="nama"?(t.nama?.toLowerCase()||"").includes(f):Te==="id_sambungan"?(t.id_sambungan?.toLowerCase()||"").includes(f):Te==="id_meter"?(t.id_meter?.toLowerCase()||"").includes(f):Te==="id_tag"?(C.id_tag?.toLowerCase()||"").includes(f):(t.nama?.toLowerCase()||"").includes(f)||(t.id_sambungan?.toLowerCase()||"").includes(f)||(t.id_meter?.toLowerCase()||"").includes(f)||(C.id_tag?.toLowerCase()||"").includes(f)}),ge=()=>{let t=[],m=Math.max(1,E-2),f=Math.min(Re,m+5-1);f-m+1<5&&(m=Math.max(1,f-5+1));for(let C=m;C<=f;C++)t.push(C);return t};i.useEffect(()=>{be(1)},[T,ye,we]);const Re=Math.ceil(re.length/ye),Be=re.slice((E-1)*ye,E*ye),ut=()=>{const t=Yt.filter(f=>u.includes(f.id)),l=t.map(f=>f.label),m=re.map((f,C)=>{const P=Ge(f.id_pelanggan),Se=Ye(f),ie=N(f);return t.map(de=>{if(de.id==="id_sambungan")return f.id_sambungan;if(de.id==="id_meter")return f.id_meter;if(de.id==="id_tag")return P.id_tag||"-";if(de.id==="nama")return f.nama;if(de.id==="alamat")return f.alamat;if(de.id==="kode_tarif")return f.kode_tarif;if(de.id==="stan_akhir")return f.stan_akhir;if(de.id==="stan_awal")return Se;if(de.id==="koordinat")return f.latitude&&f.longitude?`${f.latitude}, ${f.longitude}`:"-";if(de.id==="ai_ocr_status"){const Le=f.ai_ocr_status||(f.stan_akhir&&f.foto?"GREEN":"");return Le==="GREEN"?"Sesuai":Le==="YELLOW"?"Butuh Review":Le==="RED"?"Mismatch":"-"}return de.id==="PEMAKAIAN (m)"?ie:de.id==="hasil_analisa"?B(ie):de.id==="status_laporan"?v.find(Le=>Le.kode_kondisi===f.status_laporan)?.status_kondisi||f.status_laporan||"-":""})});return{headers:l,rows:m,columns:t}},at=()=>{const{headers:t,rows:l}=ut(),m=["No",...t],f=l.map((de,Le)=>[Le+1,...de]),C=[m,...f].map(de=>de.map(Le=>`"${Le}"`).join(",")).join(`
`),P=new Blob([C],{type:"text/csv;charset=utf-8;"}),Se=URL.createObjectURL(P),ie=document.createElement("a");ie.setAttribute("href",Se),ie.setAttribute("download",`Analisa_Meter_${He(we,"MMM_yyyy")}.csv`),document.body.appendChild(ie),ie.click(),document.body.removeChild(ie)},ht=()=>{const{headers:t,rows:l}=ut(),m=l.map((P,Se)=>{const ie={NO:Se+1};return t.forEach((de,Le)=>{ie[de]=P[Le]}),ie}),f=Ie.json_to_sheet(m),C=Ie.book_new();Ie.book_append_sheet(C,f,"Analisa Baca Meter"),Tt(C,`Analisa_Meter_${He(we,"MMM_yyyy")}.xlsx`)},zt=()=>{const t=new Ct("l","mm","a4"),l=new Date().toLocaleString("id-ID"),{headers:m,rows:f}=ut();t.setFontSize(18),t.setTextColor(14,165,233),t.text("Laporan Analisa Baca Meter",14,15),t.setFontSize(10),t.setTextColor(100),t.text(`Periode: ${He(we,"MMMM yyyy")}`,14,22),t.text(`Jumlah Data: ${re.length}`,14,27),t.text(`Dicetak pada: ${l}`,280,22,{align:"right"});const C=["No",...m],P=f.map((Ft,ca)=>[ca+1,...Ft]);At(t,{head:[C],body:P,startY:32,theme:"grid",headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"},styles:{fontSize:8},columnStyles:{0:{cellWidth:10}}});const ie=(t.lastAutoTable.finalY||32)+20;ie+40>t.internal.pageSize.height&&(t.addPage(),t.text(`Dicetak pada: ${l}`,280,22,{align:"right"}));const de=localStorage.getItem("username")||"Admin";t.setFontSize(10),t.setTextColor(50);const Ve=t.internal.pageSize.width-20-40;t.text("Dicetak oleh,",Ve,ie,{align:"center"}),t.text("_______________________",Ve,ie+25,{align:"center"}),t.text(de,Ve,ie+30,{align:"center"}),t.save(`Analisa_Meter_${He(we,"MMM_yyyy")}.pdf`)},Rt=()=>window.print(),a=async t=>{console.log("Fetching history for:",t),fe([]);try{const m=await(await fetch(`./api/customer_history.php?id_sambungan=${t}`)).json();fe(Array.isArray(m)?m:[])}catch(l){console.error("Error fetching customer history:",l),fe([])}},d=async t=>{if(!t)return;p(t);const l=S.find(m=>m.id_sambungan===t.id_sambungan&&Number(m.bulan)===(Number(t.bulan)===1?12:Number(t.bulan)-1)&&Number(m.tahun)===(Number(t.bulan)===1?Number(t.tahun)-1:Number(t.tahun)));ke(l||null),V(!0),a(t.id_sambungan)},b=()=>{V(!1),p(null),ke(null),fe([])};return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                    
                    .customer-table {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0;
                    }
                    .customer-table thead th { 
                        position: sticky; top: 0; z-index: 30; background: #f1f5f9 !important; 
                        box-shadow: 0 2px 4px -1px rgba(0,0,0,0.06);
                        border-bottom: 2px solid var(--border) !important; text-transform: uppercase;
                        font-size: 0.75rem; letter-spacing: 0.05em; color: var(--text-light); 
                        padding: 12px 16px !important;
                        border-left: none !important; border-right: none !important;
                    }
                    .customer-table tbody tr { transition: all 0.2s ease; }
                    .customer-table tbody tr:nth-of-type(even) td { background-color: #f8fafc; }
                    .customer-table tbody tr:hover td { background-color: #f1f5f9 !important; }
                    .customer-table td { 
                        padding: 0.625rem 0.75rem !important; vertical-align: middle; 
                        border-bottom: 1px solid var(--border); border-left: none !important; border-right: none !important;
                        font-size: 0.875rem; 
                    }
                    
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left {
                        background-color: #f8fafc !important;
                    }

                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f1f5f9 !important;
                        z-index: 40 !important;
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #f8fafc !important;
                    }

                    .badge { 
                        padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; 
                        display: inline-flex; align-items: center; gap: 0.35rem; white-space: nowrap;
                    }
                    
                    .card {
                        background: var(--surface); border-radius: var(--radius);
                        box-shadow: var(--shadow);
                        padding: 1.5rem; border: 1px solid var(--border);
                    }

                    @media print {
                        .no-print { display: none !important; }
                        body { background: white !important; margin: 0 !important; }
                        .card { box-shadow: none !important; border: none !important; padding: 0 !important; margin: 0 !important; width: 100% !important; }
                        .customer-table { font-size: 7pt !important; width: 100% !important; border-collapse: collapse !important; }
                        .customer-table th, .customer-table td { 
                            border: 1px solid #000 !important; 
                            padding: 2px 4px !important; 
                            white-space: normal !important;
                            word-break: break-word;
                        }
                        @page { size: landscape; margin: 0.5cm; }
                        .print-footer { display: block !important; position: fixed; bottom: 0; right: 0; width: 300px; text-align: center; font-size: 10pt; color: #000; }
                    }
                    .print-footer { display: none; }
                    @media (max-width: 768px) {
                        .header {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 1rem;
                        }
                        .header-actions {
                            width: 100%;
                            justify-content: flex-start;
                            overflow-x: auto;
                            padding-bottom: 0.5rem;
                        }
                        .hide-mobile {
                            display: none;
                        }
                        .table-container {
                            margin: 1rem 0 !important;
                            width: 100% !important;
                            overflow-x: auto !important;
                        }
                        .card {
                            padding: 1rem !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"0.75rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx(la,{size:32,color:"var(--primary)"}),"Analisa Baca Meter"]}),e.jsx("p",{style:{color:"#64748b"},children:"Dashboard Analisis Penggunaan Meter Pelanggan"})]}),e.jsxs("div",{className:"header-actions no-print",style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:at,title:"Export CSV",style:{padding:"0.5rem"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:ht,title:"Export Excel",style:{padding:"0.5rem"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:zt,title:"Export PDF",style:{padding:"0.5rem"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:Rt,title:"Print",style:{padding:"0.5rem"},children:e.jsx(_t,{size:18})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative"},ref:g,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>ee(!ae),style:{height:"42px",padding:"0 1rem",borderRadius:"10px",fontWeight:500,display:"flex",alignItems:"center",gap:"0.625rem"},children:[e.jsx(St,{size:18}),e.jsx("span",{children:"Pilih Kolom"})]}),ae&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:Yt.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.5rem",cursor:"pointer",borderRadius:"6px"},onMouseEnter:l=>l.currentTarget.style.background="#f8fafc",onMouseLeave:l=>l.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",checked:u.includes(t.id),style:{width:"16px",height:"16px",accentColor:"var(--primary)"},onChange:()=>Y(l=>l.includes(t.id)?l.filter(m=>m!==t.id):[...l,t.id])}),e.jsx("span",{style:{fontSize:"0.875rem",color:u.includes(t.id)?"var(--text)":"var(--text-light)"},children:t.label})]},t.id))}),e.jsxs("div",{style:{borderTop:"1px solid var(--border)",marginTop:"0.75rem",paddingTop:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{onClick:()=>Y(Yt.map(t=>t.id)),style:{fontSize:"0.8rem",color:"var(--primary)",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Pilih Semua"}),e.jsx("button",{onClick:()=>Y(ra),style:{fontSize:"0.8rem",color:"#64748b",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:x,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>W(!L),style:{height:"42px",padding:"0 1rem",display:"flex",alignItems:"center",gap:"0.625rem",background:L?"#f1f5f9":"#f8fafc",border:`1px solid ${L?"var(--primary)":"var(--border)"}`,color:L?"var(--primary)":"var(--text)",borderRadius:"10px",minWidth:"100px"},children:[e.jsx("span",{style:{fontWeight:600},children:"Filter"}),e.jsx(it,{size:16})]}),L&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px"},children:[{id:"nama",label:"By Nama"},{id:"id_sambungan",label:"By No. Sambungan"},{id:"id_meter",label:"By ID Meter"},{id:"id_tag",label:"By ID Tag"}].map(t=>e.jsx("button",{onClick:()=>{$e(t.id),W(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:Te===t.id?"#f1f5f9":"none",color:Te===t.id?"var(--primary)":"var(--text)",borderRadius:"8px",cursor:"pointer"},children:t.label},t.id))})]}),e.jsx("div",{style:{height:"42px",display:"flex",alignItems:"center"},children:e.jsx(da,{value:we,onChange:ze})}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(Je,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:T?"2.5rem":"0.625rem",height:"42px",borderRadius:"10px",border:"1px solid var(--border)",background:"#f8fafc",width:"100%",fontSize:"0.875rem"},placeholder:"Ketik kata kunci pencarian...",value:T,onChange:t=>Q(t.target.value)}),T&&e.jsx("button",{onClick:()=>Q(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ce,{size:16})})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto",margin:"1rem -1rem 0",width:"calc(100% + 2rem)"},children:e.jsxs("table",{className:"customer-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"60px",textAlign:"center"},children:"NO"}),u.includes("id_sambungan")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"NO. SAMBUNGAN"}),u.includes("id_meter")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID METER"}),u.includes("id_tag")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID TAG"}),u.includes("nama")&&e.jsx("th",{style:{width:"220px",minWidth:"220px",textAlign:"left"},children:"NAMA"}),u.includes("alamat")&&e.jsx("th",{style:{width:"300px",minWidth:"300px",textAlign:"left"},children:"ALAMAT"}),u.includes("kode_tarif")&&e.jsx("th",{style:{width:"80px",minWidth:"80px",textAlign:"center"},children:"TARIF"}),u.includes("stan_akhir")&&e.jsx("th",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:"STAND AKHIR"}),u.includes("stan_awal")&&e.jsx("th",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:"STAN AWAL"}),u.includes("koordinat")&&e.jsx("th",{style:{width:"180px",minWidth:"180px",textAlign:"left"},children:"KOORDINAT"}),u.includes("PEMAKAIAN (m)")&&e.jsx("th",{style:{width:"140px",minWidth:"140px",textAlign:"center"},children:"PEMAKAIAN (m)"}),u.includes("ai_ocr_status")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"center"},children:"STATUS OCR"}),u.includes("hasil_analisa")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"center"},children:"HASIL ANALISA"}),u.includes("status_laporan")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"center"},children:"KONDISI METER"}),e.jsx("th",{className:"no-print sticky-col-right",style:{width:"100px",minWidth:"100px",textAlign:"center",background:"#f8fafc",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"AKSI"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:u.length+2,style:{textAlign:"center",padding:"3rem"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[e.jsx(va,{size:32,className:"animate-spin",color:"var(--primary)"}),e.jsx("span",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:"Memuat data..."})]})})}):Be.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:u.length+2,style:{textAlign:"center",padding:"3rem"},children:e.jsx("div",{style:{color:"#94a3b8",fontSize:"0.875rem"},children:"Tidak ada data ditemukan"})})}):Be.map((t,l)=>{const m=Ge(t.id_pelanggan),f=Ye(t),C=N(t);return e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{textAlign:"center",fontWeight:500,color:"#64748b",padding:"0.625rem 0.75rem"},children:(E-1)*ye+l+1}),u.includes("id_sambungan")&&e.jsx("td",{style:{textAlign:"left"},children:t.id_sambungan}),u.includes("id_meter")&&e.jsx("td",{style:{textAlign:"left"},children:t.id_meter}),u.includes("id_tag")&&e.jsx("td",{style:{textAlign:"left"},children:m.id_tag||"-"}),u.includes("nama")&&e.jsx("td",{style:{fontWeight:600,color:"#334155",textAlign:"left"},children:t.nama}),u.includes("alamat")&&e.jsx("td",{style:{fontSize:"0.8rem",maxWidth:"300px",whiteSpace:"normal",textAlign:"left"},children:t.alamat}),u.includes("kode_tarif")&&e.jsx("td",{style:{textAlign:"center"},children:t.kode_tarif}),u.includes("stan_akhir")&&e.jsx("td",{style:{textAlign:"center"},children:t.stan_akhir}),u.includes("stan_awal")&&e.jsx("td",{style:{textAlign:"center"},children:f}),u.includes("koordinat")&&e.jsx("td",{style:{width:"180px",textAlign:"left"},children:t.latitude&&t.longitude?e.jsx("a",{href:tt(t.latitude,t.longitude),target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",fontWeight:500,textDecoration:"underline",fontSize:"0.75rem"},title:"Buka di Google Maps",children:e.jsxs("span",{style:{letterSpacing:"-0.02em"},children:[t.latitude,", ",t.longitude]})}):"-"}),u.includes("PEMAKAIAN (m)")&&e.jsx("td",{style:{fontWeight:600,textAlign:"center",color:"#0f172a",fontSize:"0.9rem"},children:C}),u.includes("ai_ocr_status")&&e.jsx("td",{style:{textAlign:"center"},children:(()=>{const P=t.ai_ocr_status||(t.stan_akhir&&t.foto?"GREEN":"");if(!P)return"-";const ie={GREEN:{label:"Sesuai",color:"#166534",bg:"#dcfce7",border:"#bbf7d0",icon:" "},YELLOW:{label:"Butuh Review",color:"#854d0e",bg:"#fef9c3",border:"#fef08a",icon:" "},RED:{label:"Mismatch",color:"#991b1b",bg:"#fee2e2",border:"#fecaca",icon:" "},VERIFIED:{label:"Sesuai (Manual)",color:"#1d4ed8",bg:"#dbeafe",border:"#bfdbfe",icon:" "}}[P]||{label:P,color:"#64748b",bg:"#f1f5f9",border:"#e2e8f0",icon:""};return e.jsxs("span",{className:"badge",style:{backgroundColor:ie.bg,color:ie.color,border:"1px solid",borderColor:ie.border,fontSize:"0.75rem"},children:[ie.icon,ie.label]})})()}),u.includes("hasil_analisa")&&e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{className:"badge",style:{backgroundColor:ne(B(C))+"15",color:ne(B(C))},children:B(C)})}),u.includes("status_laporan")&&e.jsx("td",{style:{textAlign:"center"},children:(()=>{const P=v.find(ie=>ie.kode_kondisi===t.status_laporan)?.status_kondisi||t.status_laporan,Se=P==="Normal";return e.jsx("span",{className:"badge",style:{backgroundColor:Se?"#dcfce7":P?"#fee2e2":"#f1f5f9",color:Se?"#166534":P?"#991b1b":"#64748b"},children:P||"-"})})()}),e.jsx("td",{className:"no-print sticky-col-right",style:{textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"0.4rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.3rem",borderRadius:"6px"},onClick:()=>d(t),title:"Lihat",children:e.jsx(wa,{size:14,color:"#0ea5e9"})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.3rem",borderRadius:"6px"},onClick:()=>mt(t),title:"Edit",children:e.jsx(et,{size:14,color:"#202328ff"})})]})})]},t.id)})})]})}),!w&&re.length>0&&e.jsxs("div",{className:"no-print",style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:["Menampilkan ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:(E-1)*ye+1})," sampai ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Math.min(E*ye,re.length)})," dari ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:re.length})," data analisa"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",marginBottom:0},children:"Baris per halaman:"}),e.jsx("select",{value:ye,onChange:t=>q(Number(t.target.value)),style:{width:"auto",padding:"0.25rem 0.5rem",height:"auto"},children:[10,25,50,100].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:E===1,onClick:()=>be(1),children:e.jsx(Ht,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:E===1,onClick:()=>be(t=>Math.max(1,t-1)),children:e.jsx(Ze,{size:18})}),ge().map(t=>e.jsx("button",{className:`btn ${E===t?"btn-primary":"btn-outline"}`,style:{minWidth:"36px",height:"36px",padding:0,justifyContent:"center"},onClick:()=>be(t),children:t},t)),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:E===Re,onClick:()=>be(t=>Math.min(Re,t+1)),children:e.jsx(Qe,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:E===Re,onClick:()=>be(Re),children:e.jsx(Gt,{size:18})})]})]})]})]}),xe&&k&&e.jsx("div",{className:"modal-overlay",style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.75)",backdropFilter:"blur(4px)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.2s"},children:e.jsxs("div",{className:"modal-content",style:{background:"white",width:"90%",maxWidth:"650px",maxHeight:"85vh",borderRadius:"20px",overflow:"hidden",display:"flex",flexDirection:"column",animation:"slideUp 0.3s"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:"Detail Analisa Meter"}),e.jsx("button",{onClick:b,style:{width:"36px",height:"36px",background:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer",color:"#64748b",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{style:{padding:"1.25rem 2rem",overflowY:"auto",flex:1},children:[e.jsxs("div",{style:{maxWidth:"580px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"0.625rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingBottom:"0.5rem",borderBottom:"2px solid #f1f5f9",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{width:"4px",height:"1.25rem",background:"var(--primary)",borderRadius:"2px"}}),e.jsx("h3",{style:{fontSize:"0.9375rem",fontWeight:700,color:"#1e293b",margin:0,textTransform:"uppercase",letterSpacing:"0.025em"},children:"Detail Pelanggan"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",padding:"1rem",background:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[{id:"nama",label:"Nama Pelanggan",value:k.nama,bold:!0},{id:"id_sambungan",label:"No. Sambungan",value:k.id_sambungan},{id:"id_meter",label:"ID Meter",value:k.id_meter},{id:"id_tag",label:"ID Tag",value:Ge(k.id_pelanggan).id_tag||"-"},{id:"ai_ocr_status",label:"Hasil OCR",value:e.jsx("span",{style:{color:k.ai_ocr_status==="GREEN"?"#166534":k.ai_ocr_status==="YELLOW"?"#854d0e":k.ai_ocr_status==="RED"?"#991b1b":k.ai_ocr_status==="VERIFIED"?"#1d4ed8":"#64748b",fontWeight:700},children:k.ai_ocr_status==="GREEN"?" SESUAI":k.ai_ocr_status==="YELLOW"?" REVIEW":k.ai_ocr_status==="RED"?" MISMATCH":k.ai_ocr_status==="VERIFIED"?" TERVERIFIKASI":"-"}),alwaysShow:!0}].filter(t=>t.alwaysShow||u.includes(t.id)).map((t,l)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.15rem",textAlign:"center"},children:[e.jsx("span",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em"},children:t.label}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#1e293b",fontWeight:t.bold?700:500},children:t.value})]},l))}),e.jsx("div",{style:{borderTop:"1px solid #e2e8f0",margin:"0.5rem 0"}}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginTop:"0.25rem"},children:[e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Rumah Awal"}),e.jsx("div",{onClick:()=>z?.foto_rumah&&F(z.foto_rumah),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:z?.foto_rumah?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>z?.foto_rumah&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:z?.foto_rumah?"Klik untuk memperbesar":"",children:z?.foto_rumah?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z.foto_rumah.startsWith("/")?`${dt}${z.foto_rumah}`:z.foto_rumah,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Rumah Awal"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Nt,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(De,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Rumah Akhir"}),e.jsx("div",{onClick:()=>k.foto_rumah&&F(k.foto_rumah),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:k.foto_rumah?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>k.foto_rumah&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:k.foto_rumah?"Klik untuk memperbesar":"",children:k.foto_rumah?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:k.foto_rumah&&k.foto_rumah.startsWith("/")?`${dt}${k.foto_rumah}`:k.foto_rumah,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Rumah Akhir"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Nt,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(De,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Meter Awal"}),e.jsx("div",{onClick:()=>z?.foto&&F(z.foto),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:z?.foto?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>z?.foto&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:z?.foto?"Klik untuk memperbesar":"",children:z?.foto?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z?.foto&&z.foto.startsWith("/")?`${dt}${z.foto}`:z.foto,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Meter Awal"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Nt,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(De,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Meter Akhir"}),e.jsx("div",{onClick:()=>k.foto&&F(k.foto),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:k.foto?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>k.foto&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:k.foto?"Klik untuk memperbesar":"",children:k.foto?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:k.foto&&k.foto.startsWith("/")?`${dt}${k.foto}`:k.foto,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Meter Akhir"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Nt,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(De,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginTop:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1",maxWidth:"280px"},children:[e.jsx("label",{style:{fontSize:"0.6875rem",fontWeight:700,color:"#64748b",marginBottom:"0.375rem",display:"block",textTransform:"uppercase",textAlign:"center",letterSpacing:"0.05em"},children:"Stan Awal"}),e.jsx("div",{style:{width:"100%",padding:"0.625rem",borderRadius:"8px",border:"1px solid #bfdbfe",background:"#f0f9ff",color:"#0284c7",textAlign:"center",fontSize:"1rem",fontWeight:700,boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.05)"},children:z?z.stan_akhir:0})]}),e.jsxs("div",{className:"form-group",style:{flex:"1",maxWidth:"280px"},children:[e.jsx("label",{style:{fontSize:"0.6875rem",fontWeight:700,color:"#64748b",marginBottom:"0.375rem",display:"block",textTransform:"uppercase",textAlign:"center",letterSpacing:"0.05em"},children:"Stan Akhir"}),e.jsx("div",{style:{width:"100%",padding:"0.625rem",borderRadius:"8px",border:"1px solid #bfdbfe",background:"#f0f9ff",color:"#0284c7",textAlign:"center",fontSize:"1rem",fontWeight:700,boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.05)"},children:k.stan_akhir})]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsxs("div",{className:"form-group",style:{width:"calc(33.33% - 0.5rem)"},children:[e.jsx("label",{style:{fontSize:"0.6875rem",fontWeight:700,color:"#475569",marginBottom:"0.375rem",display:"block",textTransform:"uppercase",textAlign:"center",letterSpacing:"0.05em"},children:"Pemakaian"}),e.jsx("div",{style:{width:"100%",padding:"0.625rem",borderRadius:"8px",border:"2px solid #3b82f6",background:"#e0f2fe",color:"#1d4ed8",textAlign:"center",fontSize:"1.0625rem",fontWeight:800,boxShadow:"0 4px 6px -1px rgba(59, 130, 246, 0.15)"},children:(()=>{const t=parseInt(k.stan_akhir);if(t===0)return"0 m";const l=z?parseInt(z.stan_akhir):0;return t-l+" m"})()})]})})]})]}),e.jsx("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-outline",style:{padding:"0.75rem 4rem",borderRadius:"10px",fontWeight:600},onClick:b,children:"Tutup"})})]})]})}),y&&e.jsx("div",{ref:ve,className:"modal-overlay",style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",cursor:ue?"grabbing":U>1?"grab":"zoom-out",animation:"fadeIn 0.2s",overflow:"hidden"},onClick:t=>{t.target===t.currentTarget&&(F(null),J(1),Me({x:0,y:0}))},onWheel:t=>{t.stopPropagation();const l=t.deltaY*-.001;J(m=>Math.min(Math.max(1,m+l),5))},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[e.jsx("img",{src:y,style:{maxWidth:U===1?"95%":"none",maxHeight:U===1?"95vh":"none",width:U>1?`${U*100}%`:"auto",objectFit:"contain",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",transform:`translate(${le.x}px, ${le.y}px)`,transition:ue?"none":"transform 0.1s ease-out",userSelect:"none",pointerEvents:"none"},alt:"Preview",draggable:!1}),U>1&&e.jsx("div",{style:{position:"absolute",inset:0,cursor:ue?"grabbing":"grab"},onMouseDown:t=>{We(!0),Ee({x:t.clientX-le.x,y:t.clientY-le.y})},onMouseMove:t=>{ue&&Me({x:t.clientX-je.x,y:t.clientY-je.y})},onMouseUp:()=>We(!1),onMouseLeave:()=>We(!1)}),e.jsx("button",{onClick:()=>{F(null),J(1),Me({x:0,y:0})},style:{position:"absolute",top:"20px",right:"20px",background:"white",border:"none",padding:"12px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",transition:"transform 0.2s",zIndex:10},onMouseEnter:t=>t.currentTarget.style.transform="scale(1.1)",onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",children:e.jsx(ce,{size:24,color:"#1e293b"})}),U>1&&e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(255, 255, 255, 0.9)",padding:"8px 16px",borderRadius:"20px",fontSize:"0.875rem",fontWeight:600,color:"#1e293b",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",userSelect:"none"},children:[Math.round(U*100),"%"]})]})}),$&&e.jsx("div",{className:"modal-overlay",style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.2s"},onClick:()=>X(null),children:e.jsxs("div",{style:{position:"relative",maxWidth:"90%",maxHeight:"90vh"},children:[e.jsx("img",{src:$&&$.startsWith("/")?`${dt}${$}`:$,style:{maxWidth:"100%",maxHeight:"90vh",objectFit:"contain",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},alt:"Preview"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),X(null)},style:{position:"absolute",top:"20px",right:"20px",background:"white",border:"none",padding:"12px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",transition:"transform 0.2s",zIndex:10},onMouseEnter:t=>t.currentTarget.style.transform="scale(1.1)",onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",children:e.jsx(ce,{size:24,color:"#1e293b"})})]})}),_e&&e.jsx("div",{className:"modal-overlay",style:{animation:"fadeIn 0.2s",backgroundColor:"rgba(15, 23, 42, 0.75)",backdropFilter:"blur(4px)",position:"fixed",inset:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-content",style:{animation:"slideUp 0.3s",width:"90%",maxWidth:"950px",borderRadius:"20px",padding:0,overflow:"hidden",maxHeight:"90vh",display:"flex",flexDirection:"column",background:"white"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",background:"white"},children:[e.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:"Edit Analisa Meter"}),e.jsx("button",{onClick:n,style:{width:"36px",height:"36px",background:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer",color:"#64748b",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:e.jsx(ce,{size:20})})]}),e.jsxs("form",{onSubmit:j,style:{padding:"2rem",overflowY:"auto",flex:1},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",paddingLeft:"0.5rem",borderLeft:"4px solid var(--primary)"},children:e.jsx("h3",{style:{fontSize:"0.875rem",fontWeight:700,color:"#1e293b",textTransform:"uppercase",letterSpacing:"0.05em",margin:0},children:"Detail Pelanggan"})}),e.jsxs("div",{className:"grid-2-col",style:{background:"#f8fafc",padding:"1.5rem",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#94a3b8",marginBottom:"0.25rem",textTransform:"uppercase"},children:"Nama Pelanggan"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:700,color:"#0f172a"},children:D.nama})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#94a3b8",marginBottom:"0.25rem",textTransform:"uppercase"},children:"No. Sambungan"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:"#334155"},children:D.id_sambungan})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#94a3b8",marginBottom:"0.25rem",textTransform:"uppercase"},children:"ID Meter"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:"#334155"},children:D.id_meter})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#94a3b8",marginBottom:"0.25rem",textTransform:"uppercase"},children:"Tarif"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:"#334155"},children:D.kode_tarif})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#94a3b8",marginBottom:"0.25rem",textTransform:"uppercase"},children:"Alamat"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:500,color:"#334155"},children:D.alamat})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"1rem",borderTop:"1px dashed #cbd5e1"},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#94a3b8",marginBottom:"0.25rem",textTransform:"uppercase"},children:"Tanggal Pencatatan"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"1rem",fontWeight:600,color:"#0f172a"},children:[e.jsx(jt,{size:18,color:"var(--primary)"}),He(new Date(Number(D.tahun),Number(D.bulan)-1),"MMMM yyyy",{locale:void 0})]})]})]})]}),e.jsxs("div",{className:"grid-2-col",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Awal (Bulan Lalu)"}),e.jsxs("div",{style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f0f9ff",display:"flex",alignItems:"center",gap:"0.5rem",color:"#0369a1",fontSize:"0.95rem",fontWeight:700},children:[e.jsx(sa,{size:16}),e.jsx("span",{children:D.stan_awal})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Akhir"}),e.jsx("input",{type:"number",style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #ef4444",fontSize:"1rem",background:"#fef2f2"},value:D.stan_akhir,onChange:t=>te({...D,stan_akhir:t.target.value}),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Pemakaian (m)"}),e.jsxs("div",{style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f8fafc",display:"flex",alignItems:"center",gap:"0.5rem",color:"#1e293b",fontSize:"0.95rem",fontWeight:800},children:[e.jsx(rt,{size:16,color:"#0ea5e9"}),e.jsx("span",{children:(()=>{const t=Number(D.stan_akhir||0);return t===0?"0 m":t-Number(D.stan_awal||0)+" m"})()})]})]})]})]}),e.jsx("div",{children:e.jsx("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[{id:"foto",label:"FOTO METER",preview:Z},{id:"foto_rumah",label:"FOTO RUMAH",preview:h}].map(t=>e.jsx("div",{style:{textAlign:"center",flex:1},children:e.jsxs("div",{onClick:()=>t.preview&&X(t.preview),style:{width:"100%",aspectRatio:"4/3",border:"2px solid #e2e8f0",borderRadius:"12px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:t.preview?"pointer":"default"},children:[t.preview?e.jsx("img",{src:t.preview&&t.preview.startsWith("/")?`${dt}${t.preview}`:t.preview,style:{width:"100%",height:"100%",objectFit:"cover"},alt:t.label}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#cbd5e1"},children:[e.jsx(De,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0,0,0,0.5)",color:"white",fontSize:"0.6rem",padding:"4px",textTransform:"uppercase",fontWeight:700},children:t.label})]})},t.id))})})]}),e.jsxs("div",{style:{marginTop:"2.5rem",paddingTop:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{padding:"0.75rem 1.5rem",borderRadius:"10px",fontWeight:600},onClick:n,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{padding:"0.75rem 2rem",borderRadius:"10px",fontWeight:600},children:"Simpan Perubahan"})]})]})]})}),e.jsxs("div",{className:"print-footer",children:[e.jsx("p",{style:{margin:"0 0 40px 0"},children:"Dicetak oleh,"}),e.jsx("div",{style:{borderBottom:"1px solid black",width:"200px",margin:"0 auto 10px auto"}}),e.jsx("p",{children:localStorage.getItem("username")||"Admin"})]})]})}function Wa(){const[S,H]=i.useState(localStorage.getItem("pdam_active_tab")||"pelanggan"),[A,I]=i.useState(window.innerWidth>768),[v,O]=i.useState(window.innerWidth<=768);i.useEffect(()=>{localStorage.setItem("pdam_active_tab",S)},[S]),i.useEffect(()=>{const T=()=>{const Q=window.innerWidth<=768;O(Q),I(!Q)};return window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const w=[{id:"cabang",label:"Data Cabang",icon:e.jsx(Ut,{size:20})},{id:"pelanggan",label:"Data Pelanggan",icon:e.jsx(oa,{size:20})},{id:"catat",label:"Pencatatan Bulan Berjalan",icon:e.jsx(rt,{size:20})},{id:"analisa",label:"Analisa Baca Meter",icon:e.jsx(la,{size:20})},{id:"petugas",label:"Data Petugas",icon:e.jsx(_a,{size:20})},{id:"history_catat",label:"History Pencatatan",icon:e.jsx(Sa,{size:20})}],G=T=>{H(T),v&&I(!1)};return e.jsxs("div",{className:"app-layout",children:[e.jsx("div",{className:`sidebar-overlay ${v&&A?"visible":""}`,onClick:()=>I(!1)}),e.jsxs("header",{className:"mobile-header",children:[e.jsx("button",{className:"btn-menu",onClick:()=>I(!0),children:e.jsx(qt,{size:24})}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("img",{src:"logo.svg",alt:"PDAM Smart",style:{height:"50px",width:"auto"}})})]}),e.jsxs("aside",{className:`sidebar ${v?A?"visible-mobile":"hidden-mobile":A?"open":"closed"}`,children:[e.jsxs("div",{className:"sidebar-header",style:{justifyContent:"center",padding:A||v?"2rem 1rem":"1rem 0.5rem",transition:"padding 0.3s ease"},children:[e.jsx("img",{src:"logo.png",alt:"PDAM App",style:{height:"130px",maxHeight:"15vh",width:"auto",maxWidth:"100%",borderRadius:"8px",display:A||v?"block":"none",animation:"fadeIn 0.7s cubic-bezier(0.2, 0.8, 0.2, 1)"}}),e.jsx("img",{src:"logo-icon.svg",alt:"PDAM",style:{height:"40px",width:"40px",objectFit:"contain",display:A||v?"none":"block"}}),v&&e.jsx("button",{onClick:()=>I(!1),style:{position:"absolute",right:"10px",top:"15px",background:"none",border:"none",color:"white",cursor:"pointer"},children:e.jsx(ce,{size:24})})]}),e.jsx("nav",{className:"sidebar-nav",children:w.map(T=>e.jsxs("button",{className:`nav-item ${S===T.id?"active":""}`,onClick:()=>G(T.id),children:[T.icon,(A||v)&&e.jsx("span",{children:T.label})]},T.id))}),!v&&e.jsx("button",{className:"sidebar-toggle",onClick:()=>I(!A),children:A?e.jsx(ce,{size:18}):e.jsx(qt,{size:18})})]}),e.jsx("main",{className:"main-content",children:e.jsx("div",{className:"content-container",children:S==="pelanggan"?e.jsx(Ca,{}):S==="catat"?e.jsx(ea,{}):S==="history_catat"?e.jsx(ea,{isHistory:!0}):S==="petugas"?e.jsx(Na,{}):S==="analisa"?e.jsx(Ma,{}):e.jsx(Ta,{})})})]})}fa.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Wa,{})}));
