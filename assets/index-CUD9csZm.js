import{r,j as e,S as me,R as ba,e as ya,b as ja,c as it,s as ka,f as Ge,g as Ve,i as Xe,h as Lt,k as Ze,l as Ht,m as Pt,n as Ot,o as xt,p as va,q as wa,t as ma,u as _a}from"./vendor-C_eiAwLH.js";import{X as ge,C as Qe,S as qe,D as st,a as kt,F as vt,b as wt,P as _t,c as ot,d as St,e as et,f as tt,g as Oe,h as at,T as Ut,i as Jt,j as Xt,U as ea,k as Sa,l as Ca,m as Bt,B as Ft,L as ta,n as qt,o as $t,H as ua,p as Zt,q as Aa,r as za,R as Yt,M as Ra,s as ha,E as Ta,t as ct,u as Gt,Z as It,v as aa,w as Ia}from"./vendor-icons-DzpyZQ0q.js";import{E as Ct,a as At}from"./vendor-jspdf-CwNpbytw.js";import{u as Ee,w as zt}from"./vendor-xlsx-C2K9OxTh.js";(function(){const G=document.createElement("link").relList;if(G&&G.supports&&G.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))D(k);new MutationObserver(k=>{for(const P of k)if(P.type==="childList")for(const _ of P.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&D(_)}).observe(document,{childList:!0,subtree:!0});function S(k){const P={};return k.integrity&&(P.integrity=k.integrity),k.referrerPolicy&&(P.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?P.credentials="include":k.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function D(k){if(k.ep)return;k.ep=!0;const P=S(k);fetch(k.href,P)}})();const Fe=({label:v,options:G,value:S,onChange:D,placeholder:k="Pilih...",searchPlaceholder:P="Cari...",disabled:_=!1,displayTop:V=!1,required:O=!1,containerStyle:q={},hideValue:J=!1,icon:E=null})=>{const[A,M]=r.useState(!1),[u,l]=r.useState(""),[x,b]=r.useState("bottom"),de=r.useRef(null);r.useEffect(()=>{const I=L=>{de.current&&!de.current.contains(L.target)&&M(!1)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]),r.useLayoutEffect(()=>{if(A&&de.current){const I=de.current.getBoundingClientRect(),ie=window.innerHeight-I.bottom,be=I.top;ie<300&&be>ie?b("top"):b("bottom")}},[A]);const ne=V?"top":x,xe=G.filter(I=>{const L=String(I.label||"").toLowerCase(),ie=String(I.value||"").toLowerCase(),be=u.toLowerCase();return L.includes(be)||ie.includes(be)}),c=G.find(I=>String(I.value)===String(S));return e.jsxs("div",{className:"searchable-select-container",style:{position:"relative",width:"100%",marginBottom:v?"1rem":"0",...q},ref:de,children:[v&&e.jsxs("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:600,color:"var(--text-light)",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em"},children:[v," ",O&&e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("div",{onClick:()=>!_&&M(!A),style:{width:"100%",padding:"0.625rem 0.75rem",borderRadius:"8px",border:"1px solid var(--border)",fontSize:"0.875rem",background:_?"#f8fafc":"white",cursor:_?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.625rem",minHeight:"42px",transition:"all 0.2s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",overflow:"hidden"},children:[E&&e.jsx(E,{size:16,style:{color:"#94a3b8",flexShrink:0}}),e.jsx("span",{style:{flex:1,minWidth:0,color:S?"var(--text)":"#94a3b8",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontWeight:S?500:400},children:c?J?c.label||c.value:c.label&&String(c.label)!==String(c.value)?`${c.value} - ${c.label}`:c.value:k}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S&&!_&&e.jsx("button",{type:"button",onClick:I=>{I.stopPropagation(),D({target:{value:""}}),M(!1)},style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:"#94a3b8",display:"flex",alignItems:"center",borderRadius:"50%",transition:"background 0.2s"},onMouseEnter:I=>I.currentTarget.style.background="#f1f5f9",onMouseLeave:I=>I.currentTarget.style.background="none",children:e.jsx(ge,{size:14})}),e.jsx(Qe,{size:16,style:{color:"#94a3b8",transform:A?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),A&&e.jsxs("div",{style:{position:"absolute",[ne==="top"?"bottom":"top"]:"100%",left:0,right:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"8px",[ne==="top"?"marginBottom":"marginTop"]:"4px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)",overflow:"hidden",animation:"fadeIn 0.2s ease-out"},children:[e.jsx("div",{style:{padding:"0.5rem",borderBottom:"1px solid #f1f5f9",background:"#f8fafc"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(qe,{size:14,style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:P,value:u,onChange:I=>l(I.target.value),onClick:I=>I.stopPropagation(),style:{width:"100%",padding:"0.5rem 0.5rem 0.5rem 2.25rem",borderRadius:"6px",border:"1px solid var(--border)",fontSize:"0.875rem",outline:"none",height:"38px"}})]})}),e.jsxs("div",{style:{maxHeight:"250px",overflowY:"auto",padding:"0.25rem"},children:[xe.map(I=>e.jsx("div",{onClick:L=>{L.stopPropagation(),D({target:{value:I.value}}),M(!1),l("")},style:{padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",borderRadius:"6px",marginBottom:"2px",background:String(S)===String(I.value)?"var(--background)":"white",color:String(S)===String(I.value)?"var(--primary)":"var(--text)",transition:"all 0.15s"},onMouseEnter:L=>L.currentTarget.style.background="var(--background)",onMouseLeave:L=>L.currentTarget.style.background=String(S)===String(I.value)?"var(--background)":"white",children:J?e.jsx("div",{style:{fontWeight:600},children:I.label||I.value}):e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem"},children:I.value}),I.label&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-light)"},children:I.label})]})},I.value)),xe.length===0&&e.jsx("div",{style:{padding:"2rem 1rem",textAlign:"center",color:"var(--text-light)",fontSize:"0.875rem"},children:"Data tidak ditemukan"})]})]})]})},Nt="./api/customers.php",ft="http://localhost",bt=[{id:"id_sambungan",label:"NO. SAMBUNGAN"},{id:"nomor_urut",label:"NO. URUT"},{id:"id_meter",label:"ID METER"},{id:"id_tag",label:"ID TAG"},{id:"foto_rumah",label:"FOTO RUMAH"},{id:"foto_meter",label:"FOTO METER"},{id:"nama",label:"NAMA PELANGGAN"},{id:"alamat",label:"ALAMAT"},{id:"koordinat",label:"KOORDINAT"},{id:"telepon",label:"TELEPON"},{id:"kode_tarif",label:"TARIF"},{id:"kode_rute",label:"RUTE"},{id:"kode_cabang",label:"CABANG"},{id:"kode_kecamatan",label:"KEC"},{id:"kode_desa",label:"DESA"},{id:"kode_rw",label:"RW"},{id:"kode_rt",label:"RT"},{id:"active_date",label:"TANGGAL AKTIF"}],na=["id_sambungan","nomor_urut","id_meter","id_tag","foto_rumah","foto_meter","nama","alamat","telepon","kode_tarif","kode_rute","kode_cabang","kode_kecamatan","kode_desa","kode_rw","kode_rt","active_date"];function Na(){const[v,G]=r.useState([]),[S,D]=r.useState(!0),[k,P]=r.useState(""),[_,V]=r.useState(!1),[O,q]=r.useState(null),[J,E]=r.useState([]),[A,M]=r.useState([]),[u,l]=r.useState([]),[x,b]=r.useState([]),[de,ne]=r.useState([]),[xe,c]=r.useState([]),[I,L]=r.useState([]),[ie,be]=r.useState({kec:null,desa:null,rw:null}),[se,Ie]=r.useState(!1),[ze,$e]=r.useState(!1),ue=r.useRef(null),Pe=r.useRef(null),[w,X]=r.useState(()=>{const n=localStorage.getItem("pdam_visible_columns_v4");return n?JSON.parse(n):na}),[Z,H]=r.useState(Number(localStorage.getItem("pdam_current_page"))||1),[fe,Ne]=r.useState(Number(localStorage.getItem("pdam_items_per_page"))||10),[ye,We]=r.useState("nama"),[je,Me]=r.useState(null),[_e,Q]=r.useState(null),[ce,Se]=r.useState(null),[U,Ye]=r.useState({meter:!1,rumah:!1}),[Be,De]=r.useState(0),[ke,Ce]=r.useState(null),[o,z]=r.useState(null),[s,N]=r.useState({id_sambungan:"",id_meter:"",id_tag:"",nama:"",alamat:"",telepon:"",kode_tarif:"",kode_rute:"",kode_cabang:"",kode_kecamatan:"",kode_desa:"",kode_rw:"",kode_rt:"",nomor_urut:"",longitude:"",latitude:"",active_date:"",foto_meter:"",foto_rumah:""}),te=async()=>{try{D(!0);const j=await(await fetch(Nt)).json();G(j)}catch(n){console.error("Failed to fetch customers:",n)}finally{D(!1)}},oe=async(n,j={})=>{let F=`./api/zones.php?${new URLSearchParams({type:n,...j}).toString()}`;try{return await(await fetch(F)).json()}catch(K){return console.error(`Failed to fetch ${n}:`,K),[]}},i=async(n,j={})=>{const B=new URLSearchParams({type:n,...j});try{return await(await fetch(`./api/options.php?${B.toString()}`)).json()}catch(F){return console.error(`Failed to fetch ${n}:`,F),[]}};r.useEffect(()=>{localStorage.setItem("pdam_current_page",Z)},[Z]),r.useEffect(()=>{localStorage.setItem("pdam_items_per_page",fe)},[fe]),r.useEffect(()=>{localStorage.setItem("pdam_visible_columns_v2",JSON.stringify(w))},[w]),r.useEffect(()=>{function n(j){ue.current&&!ue.current.contains(j.target)&&Ie(!1),Pe.current&&!Pe.current.contains(j.target)&&$e(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),r.useEffect(()=>{te(),oe("kecamatan").then(E),i("tarif").then(ne),i("rute").then(c),i("cabang").then(L)},[]),r.useEffect(()=>{_&&O?(O.kode_kecamatan&&oe("desa",{kec_kode:O.kode_kecamatan}).then(M),O.kode_desa&&oe("rw",{kec_kode:O.kode_kecamatan,desa_kode:O.kode_desa}).then(l),O.kode_rw&&oe("rt",{kec_kode:O.kode_kecamatan,desa_kode:O.kode_desa,rw_kode:O.kode_rw}).then(b),O.kode_cabang&&i("rute",{kode_cabang:O.kode_cabang}).then(c)):_||(M([]),l([]),b([]),i("rute").then(c))},[_,O]);const h=(n=null)=>{n?(q(n),N({...n}),Me(n.foto_meter||null),Q(n.foto_rumah||null),Ce(null),z(null)):(q(null),N({id_sambungan:"",id_meter:"",id_tag:"",nama:"",alamat:"",telepon:"",kode_tarif:"",kode_rute:"",kode_cabang:"",kode_kecamatan:"",kode_desa:"",kode_rw:"",kode_rt:"",nomor_urut:"",longitude:"",latitude:"",active_date:"",foto_meter:"",foto_rumah:""}),Me(null),Q(null),Ce(null),z(null)),V(!0)},m=()=>{V(!1),q(null),Me(null),Q(null),Ce(null),z(null),Ye({meter:!1,rumah:!1}),De(0)},ee=(n,j="foto_meter")=>{const B=n.target.files[0];if(B){const F=j==="foto_rumah"?"rumah":"meter";Ye(T=>({...T,[F]:!0})),De(0);const K=new FileReader;let le=0;const we=setInterval(()=>{le+=Math.random()*30,le>=100&&(le=100,clearInterval(we),K.onloadend=()=>{j==="foto_rumah"?(Q(K.result),z(B)):(Me(K.result),Ce(B)),setTimeout(()=>{Ye(T=>({...T,[F]:!1})),De(0)},500)},K.readAsDataURL(B)),De(le)},100)}},ae=async n=>{if(n.preventDefault(),U.meter||U.rumah)return;const j=new FormData;Object.keys(s).forEach(F=>{F!=="foto_meter"&&F!=="foto_rumah"&&j.append(F,s[F]||"")}),ke?j.append("foto_meter",ke):s.foto_meter&&j.append("foto_meter",s.foto_meter),o?j.append("foto_rumah",o):s.foto_rumah&&j.append("foto_rumah",s.foto_rumah);const B=O?`${Nt}?id=${O.id}`:Nt;try{me.fire({title:"Menyimpan Data...",text:"Mohon tunggu sebentar",allowOutsideClick:!1,didOpen:()=>{me.showLoading()}});const K=await(await fetch(B,{method:"POST",body:j})).json();K.message?(me.fire({title:"Berhasil!",text:"Data pelanggan berhasil disimpan.",icon:"success",timer:1500,showConfirmButton:!1}),te(),m()):me.fire("Gagal!",K.error||"Terjadi kesalahan saat menyimpan.","error")}catch(F){console.error("Save failed:",F),me.fire("Error!","Gagal menghubungi server.","error")}},pe=async n=>{if((await me.fire({title:"Hapus Pelanggan?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#64748b",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{(await(await fetch(`${Nt}?id=${n}`,{method:"DELETE"})).json()).message&&(me.fire({title:"Berhasil!",text:"Data pelanggan telah dihapus.",icon:"success",timer:1500,showConfirmButton:!1}),te())}catch(B){console.error("Delete failed:",B),me.fire("Error!","Gagal menghapus data.","error")}},R=v.filter(n=>{const j=k.toLowerCase().trim();return j?ye==="kode"?(n.kode_kecamatan?.toLowerCase()||"").includes(j)||(n.kode_desa?.toLowerCase()||"").includes(j)||(n.kode_rw?.toLowerCase()||"").includes(j)||(n.kode_rt?.toLowerCase()||"").includes(j)||(n.nomor_urut?.toLowerCase()||"").includes(j):({nama:n.nama,rute:n.kode_rute,id_pelanggan:n.id_sambungan,tag:n.id_tag,meter:n.id_meter}[ye]?.toLowerCase()||"").includes(j):!0});r.useEffect(()=>{H(1)},[k,fe]);const he=Math.ceil(R.length/fe),Le=Z*fe,lt=Le-fe,Ue=R.slice(lt,Le),He=()=>{let n=[],B=Math.max(1,Z-2),F=Math.min(he,B+5-1);F-B+1<5&&(B=Math.max(1,F-5+1));for(let K=B;K<=F;K++)n.push(K);return n},ut=()=>{const n=bt.filter(T=>w.includes(T.id)&&T.id!=="foto_rumah"&&T.id!=="foto_meter"),j=n.map(T=>T.label),B=R.map(T=>n.map(Te=>Te.id==="koordinat"?T.latitude&&T.longitude?`${T.latitude}, ${T.longitude}`:"-":T[Te.id]||"-")),F=[j,...B].map(T=>T.map(Te=>`"${Te}"`).join(",")).join(`
`),K=new Blob([F],{type:"text/csv;charset=utf-8;"}),le=URL.createObjectURL(K),we=document.createElement("a");we.setAttribute("href",le),we.setAttribute("download",`data_pelanggan_${new Date().toISOString().split("T")[0]}.csv`),we.style.visibility="hidden",document.body.appendChild(we),we.click(),document.body.removeChild(we)},dt=()=>{const n=bt.filter(K=>w.includes(K.id)&&K.id!=="foto_rumah"&&K.id!=="foto_meter"),j=R.map(K=>{const le={};return n.forEach(we=>{we.id==="koordinat"?le[we.label]=K.latitude&&K.longitude?`${K.latitude}, ${K.longitude}`:"-":le[we.label]=K[we.id]||"-"}),le}),B=Ee.json_to_sheet(j),F=Ee.book_new();Ee.book_append_sheet(F,B,"Pelanggan"),zt(F,`data_pelanggan_${new Date().toISOString().split("T")[0]}.xlsx`)},ht=()=>{try{const n=new Ct("l","mm","a4"),j=new Date().toLocaleString("id-ID");n.setFontSize(18),n.setTextColor(14,165,233),n.text("Laporan Data Pelanggan PDAM",14,15),n.setFontSize(10),n.setTextColor(100),n.text(`Jumlah Total: ${R.length} Pelanggan`,14,22),n.text(`Waktu Cetak: ${j}`,280,22,{align:"right"});const B=bt.filter(le=>w.includes(le.id)&&le.id!=="foto_rumah"&&le.id!=="foto_meter"),F=["No",...B.map(le=>le.label)],K=R.map((le,we)=>[we+1,...B.map(T=>T.id==="koordinat"?le.latitude&&le.longitude?`${le.latitude}, ${le.longitude}`:"-":le[T.id]||"-")]);At(n,{head:[F],body:K,startY:28,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"},margin:{left:10,right:10}}),n.save(`data_pelanggan_${new Date().toISOString().split("T")[0]}.pdf`)}catch(n){console.error("PDF Export Error:",n),alert("Gagal mengekspor PDF. Pastikan library tersedia.")}},gt=()=>{window.print()};return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .customer-table thead th {
                        position: sticky; top: 0; z-index: 30; background: #f8fafc !important; 
                        box-shadow: inset 0 -2px 0 var(--border);
                        text-transform: uppercase;
                        font-size: 0.7rem; font-weight: 700; letter-spacing: 0.05em; color: #64748b; 
                        padding: 1rem 1.25rem !important;
                        white-space: nowrap;
                    }
                    .customer-table tbody tr:nth-of-type(even) td {
                        background-color: #fafbfc;
                    }
                    .customer-table tbody tr:hover td {
                        background-color: #eff6ff !important;
                    }
                    .customer-table td, .customer-table th {
                        padding: 0.875rem 1.25rem !important;
                        vertical-align: middle;
                        font-size: 0.875rem;
                        color: #334155;
                    }
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left,
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #fafbfc !important;
                    }

                    @media print {
                        .no-print, .no-print * {
                            display: none !important;
                        }
                        
                        body {
                            background: white !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .card {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .table-container {
                            overflow: visible !important;
                            max-height: none !important;
                            width: 100% !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .customer-table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            table-Layout: auto !important;
                            font-size: 8pt !important;
                        }

                        .customer-table th, .customer-table td {
                            border: 1px solid #e2e8f0 !important;
                            padding: 4pt !important;
                            overflow: visible !important;
                            white-space: normal !important;
                            word-break: break-word !important;
                            min-width: 0 !important;
                            width: auto !important;
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .sticky-col-left, .sticky-col-right {
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        @page {
                            size: landscape;
                            margin: 1cm;
                        }

                        header.header {
                            margin-bottom: 1rem !important;
                        }

                        h1 {
                            font-size: 16pt !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{background:"rgba(14, 165, 233, 0.1)",padding:"0.625rem",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(st,{size:32,color:"var(--primary)"})}),"Data Pelanggan"]}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.95rem",marginTop:"0.25rem"},children:"Manajemen data pelanggan dan informasi meteran"})]}),e.jsxs("div",{className:"header-actions no-print",children:[e.jsx("button",{className:"btn btn-outline",onClick:ut,title:"Export CSV",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:dt,title:"Export Excel",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:ht,title:"Export PDF",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:gt,title:"Print",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(_t,{size:18})}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>h(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:600,whiteSpace:"nowrap",boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:[e.jsx(ot,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Pelanggan"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flex:1,minWidth:"min-content",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative"},ref:ue,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>Ie(!se),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",background:se?"#f1f5f9":"#f8fafc",border:`1px solid ${se?"var(--primary)":"var(--border)"}`,color:se?"var(--primary)":"var(--text)",borderRadius:"8px",fontWeight:600},children:[e.jsx(St,{size:18}),e.jsx("span",{children:"Pilih Kolom"})]}),se&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px",maxHeight:"450px",overflowY:"auto",animation:"fadeIn 0.2s ease-out"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",color:"var(--text)",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem"},children:bt.map(n=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px",transition:"background 0.2s"},onMouseEnter:j=>j.currentTarget.style.background="#f8fafc",onMouseLeave:j=>j.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:w.includes(n.id),onChange:()=>{X(j=>j.includes(n.id)?j.filter(B=>B!==n.id):[...j,n.id])}}),e.jsx("span",{style:{color:w.includes(n.id)?"var(--text)":"var(--text-light)",fontWeight:w.includes(n.id)?500:400},children:n.label})]},n.id))}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",gap:"1rem"},children:[e.jsx("button",{style:{background:"none",border:"none",color:"var(--primary)",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>X(bt.map(n=>n.id)),onMouseEnter:n=>n.currentTarget.style.background="rgba(14, 165, 233, 0.05)",onMouseLeave:n=>n.currentTarget.style.background="none",children:"Pilih Semua"}),e.jsx("button",{style:{background:"none",border:"none",color:"#64748b",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>X(na),onMouseEnter:n=>n.currentTarget.style.background="#f1f5f9",onMouseLeave:n=>n.currentTarget.style.background="none",children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:Pe,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>$e(!ze),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",background:ze?"#f1f5f9":"#f8fafc",border:`1px solid ${ze?"var(--primary)":"var(--border)"}`,color:ze?"var(--primary)":"var(--text)",borderRadius:"8px",minWidth:"100px"},children:[e.jsx("span",{style:{fontWeight:600},children:"Filter"}),e.jsx(Qe,{size:16,style:{transform:ze?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),ze&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px",animation:"fadeIn 0.2s ease-out"},children:[{id:"nama",label:"By Nama"},{id:"kode",label:"By Kode Area"},{id:"rute",label:"By Rute"},{id:"id_pelanggan",label:"By ID. Pelanggan"},{id:"tag",label:"By ID. Tag"},{id:"meter",label:"By No. Meter"}].map(n=>e.jsx("button",{onClick:()=>{We(n.id),$e(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:ye===n.id?"#f1f5f9":"none",color:ye===n.id?"var(--primary)":"var(--text)",borderRadius:"8px",fontSize:"0.875rem",fontWeight:ye===n.id?600:400,cursor:"pointer",transition:"background 0.2s"},onMouseEnter:j=>{ye!==n.id&&(j.currentTarget.style.background="#f8fafc")},onMouseLeave:j=>{ye!==n.id&&(j.currentTarget.style.background="none")},children:n.label},n.id))})]}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(qe,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:k?"2.5rem":"0.625rem",height:"42px",borderRadius:"8px",border:"1px solid var(--border)",background:"#f8fafc",width:"100%"},placeholder:"Ketik kata kunci pencarian...",value:k,onChange:n=>P(n.target.value)}),k&&e.jsx("button",{onClick:()=>P(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",padding:"4px",cursor:"pointer",color:"var(--text-light)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%"},onMouseEnter:n=>n.currentTarget.style.background="#f1f5f9",onMouseLeave:n=>n.currentTarget.style.background="none",title:"Bersihkan pencarian",children:e.jsx(ge,{size:16})})]})]}),!S&&R.length>0&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:Z===1,onClick:()=>H(n=>Math.max(1,n-1)),children:e.jsx(et,{size:16})}),e.jsxs("span",{style:{fontSize:"0.875rem"},children:["Halaman ",e.jsx("strong",{children:Z})," dari ",he]}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:Z===he,onClick:()=>H(n=>Math.min(he,n+1)),children:e.jsx(tt,{size:16})})]})]}),S?e.jsx("div",{style:{padding:"4rem",textAlign:"center",color:"var(--text-light)"},children:"Loading customers..."}):e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:e.jsxs("table",{className:"customer-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"60px",textAlign:"center"},children:"NO"}),w.includes("id_sambungan")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"No. Sambungan"}),w.includes("nomor_urut")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"No. Urut"}),w.includes("id_meter")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID Meter"}),w.includes("id_tag")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID Tag"}),w.includes("foto_rumah")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"FOTO RUMAH"}),w.includes("foto_meter")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"FOTO METER"}),w.includes("nama")&&e.jsx("th",{style:{width:"200px",minWidth:"200px",textAlign:"left"},children:"Nama Pelanggan"}),w.includes("alamat")&&e.jsx("th",{style:{width:"250px",minWidth:"250px",textAlign:"left"},children:"Alamat"}),w.includes("koordinat")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"Koordinat"}),w.includes("telepon")&&e.jsx("th",{style:{width:"130px",minWidth:"130px",textAlign:"left"},children:"Telepon"}),w.includes("kode_tarif")&&e.jsx("th",{style:{width:"70px",minWidth:"70px",textAlign:"center"},children:"Tarif"}),w.includes("kode_rute")&&e.jsx("th",{style:{width:"90px",minWidth:"90px",textAlign:"center"},children:"Rute"}),w.includes("kode_cabang")&&e.jsx("th",{style:{width:"70px",minWidth:"70px",textAlign:"center"},children:"Cabang"}),w.includes("kode_kecamatan")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"Kec"}),w.includes("kode_desa")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"Desa"}),w.includes("kode_rw")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"RW"}),w.includes("kode_rt")&&e.jsx("th",{style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"RT"}),w.includes("active_date")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"Tanggal Aktif"}),e.jsx("th",{className:"no-print sticky-col-right",style:{width:"100px",minWidth:"100px",textAlign:"center",background:"#f8fafc",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Aksi"})]})}),e.jsx("tbody",{children:Ue.length>0?Ue.map((n,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{textAlign:"center",fontWeight:500,color:"#64748b",padding:"0.625rem 0.75rem"},children:(Z-1)*fe+j+1}),w.includes("id_sambungan")&&e.jsx("td",{style:{fontWeight:600,width:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.id_sambungan}),w.includes("nomor_urut")&&e.jsx("td",{style:{width:"100px",textAlign:"center"},children:n.nomor_urut}),w.includes("id_meter")&&e.jsx("td",{style:{width:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.id_meter}),w.includes("id_tag")&&e.jsx("td",{style:{width:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.id_tag}),w.includes("foto_rumah")&&e.jsx("td",{style:{width:"100px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:n.foto_rumah?"pointer":"default"},onClick:()=>n.foto_rumah&&Se(n.foto_rumah),title:n.foto_rumah?"Klik untuk memperbesar":"Tidak ada foto rumah",children:n.foto_rumah?e.jsx("img",{src:n.foto_rumah&&n.foto_rumah.startsWith("/")?`${ft}${n.foto_rumah}`:n.foto_rumah,alt:"Foto Rumah",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(Oe,{size:18})})}),w.includes("foto_meter")&&e.jsx("td",{style:{width:"100px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:n.foto_meter?"pointer":"default"},onClick:()=>n.foto_meter&&Se(n.foto_meter),title:n.foto_meter?"Klik untuk memperbesar":"Tidak ada foto meter",children:n.foto_meter?e.jsx("img",{src:n.foto_meter&&n.foto_meter.startsWith("/")?`${ft}${n.foto_meter}`:n.foto_meter,alt:"Foto Meter",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(st,{size:18})})}),w.includes("nama")&&e.jsx("td",{style:{width:"200px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n.nama,children:n.nama}),w.includes("alamat")&&e.jsx("td",{style:{width:"250px",maxWidth:"250px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n.alamat,children:n.alamat}),w.includes("koordinat")&&e.jsx("td",{style:{width:"150px"},children:n.latitude&&n.longitude?e.jsx("a",{href:`https://www.google.com/maps?q=${n.latitude},${n.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",fontWeight:500,textDecoration:"underline",fontSize:"0.75rem"},title:"Buka di Google Maps",children:e.jsxs("span",{style:{letterSpacing:"-0.02em"},children:[n.latitude,", ",n.longitude]})}):"-"}),w.includes("telepon")&&e.jsx("td",{style:{width:"130px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:n.telepon}),w.includes("kode_tarif")&&e.jsx("td",{style:{width:"70px",textAlign:"center"},children:n.kode_tarif}),w.includes("kode_rute")&&e.jsx("td",{style:{width:"90px",textAlign:"center"},children:n.kode_rute}),w.includes("kode_cabang")&&e.jsx("td",{style:{width:"70px",textAlign:"center"},children:n.kode_cabang}),w.includes("kode_kecamatan")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_kecamatan}),w.includes("kode_desa")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_desa}),w.includes("kode_rw")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_rw}),w.includes("kode_rt")&&e.jsx("td",{style:{width:"60px",textAlign:"center"},children:n.kode_rt}),w.includes("active_date")&&e.jsx("td",{style:{width:"120px",whiteSpace:"nowrap",textAlign:"left"},children:n.active_date}),e.jsx("td",{className:"no-print sticky-col-right",style:{textAlign:"center",background:"inherit",padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px"},onClick:()=>h(n),children:e.jsx(at,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px",color:"#ef4444"},onClick:()=>pe(n.id),children:e.jsx(Ut,{size:14})})]})})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:w.length+2,style:{textAlign:"center",padding:"3rem",color:"var(--text-light)"},children:w.length===0?"Pilih setidaknya satu kolom untuk menampilkan data.":"Tidak ada data ditemukan."})})})]})}),!S&&R.length>0&&e.jsxs("div",{className:"no-print",style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:["Menampilkan ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:lt+1})," sampai ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Math.min(Le,R.length)})," dari ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:R.length})," pelanggan"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",marginBottom:0},children:"Baris per halaman:"}),e.jsx("select",{value:fe,onChange:n=>Ne(Number(n.target.value)),style:{width:"auto",padding:"0.25rem 0.5rem",height:"auto"},children:[10,25,50,100].map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:Z===1,onClick:()=>H(1),children:e.jsx(Jt,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:Z===1,onClick:()=>H(n=>Math.max(1,n-1)),children:e.jsx(et,{size:18})}),He().map(n=>e.jsx("button",{className:`btn ${Z===n?"btn-primary":"btn-outline"}`,style:{minWidth:"36px",height:"36px",padding:0,justifyContent:"center"},onClick:()=>H(n),children:n},n)),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:Z===he,onClick:()=>H(n=>Math.min(he,n+1)),children:e.jsx(tt,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:Z===he,onClick:()=>H(he),children:e.jsx(Xt,{size:18})})]})]})]})]}),_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{paddingBottom:"3rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:0},children:[O?e.jsx(at,{size:24}):e.jsx(ot,{size:24}),O?"Edit Pelanggan":"Tambah Pelanggan Baru"]}),e.jsx("button",{onClick:m,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s",marginTop:"-0.5rem",marginRight:"-0.5rem"},onMouseEnter:n=>n.currentTarget.style.color="#64748b",onMouseLeave:n=>n.currentTarget.style.color="#94a3b8",children:e.jsx(ge,{size:24})})]}),e.jsxs("form",{onSubmit:ae,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"2rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"12px",border:"3px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",background:"#f8fafc",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",cursor:je?"pointer":"default"},onClick:()=>je&&Se(je),title:je?"Klik untuk memperbesar":"Belum ada foto meter",children:je?e.jsx("img",{src:je&&je.startsWith("/")?`${ft}${je}`:je,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{textAlign:"center",color:"#94a3b8"},children:[e.jsx(st,{size:40}),e.jsx("p",{style:{fontSize:"0.65rem",marginTop:"0.25rem",fontWeight:600},children:"FOTO METER"})]})}),e.jsxs("label",{style:{position:"absolute",bottom:"4px",right:"4px",background:U.meter?"#94a3b8":"var(--primary)",color:"white",padding:"0.625rem",borderRadius:"8px",cursor:U.meter?"not-allowed":"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",transition:"all 0.2s"},children:[U.meter?e.jsx("div",{className:"animate-spin",style:{width:"16px",height:"16px",border:"2px solid white",borderTopColor:"transparent",borderRadius:"50%"}}):e.jsx(ea,{size:16}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:n=>ee(n,"foto_meter"),disabled:U.meter})]})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"12px",border:"3px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",background:"#f8fafc",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",cursor:_e?"pointer":"default"},onClick:()=>_e&&Se(_e),title:_e?"Klik untuk memperbesar":"Belum ada foto rumah",children:_e?e.jsx("img",{src:_e&&_e.startsWith("/")?`${ft}${_e}`:_e,alt:"Preview Rumah",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{textAlign:"center",color:"#94a3b8"},children:[e.jsx(Oe,{size:40}),e.jsx("p",{style:{fontSize:"0.65rem",marginTop:"0.25rem",fontWeight:600},children:"FOTO RUMAH"})]})}),e.jsxs("label",{style:{position:"absolute",bottom:"4px",right:"4px",background:U.rumah?"#94a3b8":"var(--primary)",color:"white",padding:"0.625rem",borderRadius:"8px",cursor:U.rumah?"not-allowed":"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid white",transition:"all 0.2s"},children:[U.rumah?e.jsx("div",{className:"animate-spin",style:{width:"16px",height:"16px",border:"2px solid white",borderTopColor:"transparent",borderRadius:"50%"}}):e.jsx(ea,{size:16}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:n=>ee(n,"foto_rumah"),disabled:U.rumah})]})]}),(U.meter||U.rumah)&&e.jsx("div",{style:{position:"absolute",bottom:"-15px",left:"50%",transform:"translateX(-50%)",width:"200px",height:"6px",background:"#f1f5f9",borderRadius:"3px",overflow:"hidden",border:"1px solid #e2e8f0"},children:e.jsx("div",{style:{height:"100%",width:`${Be}%`,background:"var(--primary)",transition:"width 0.1s linear"}})})]}),e.jsxs("div",{className:"grid-6-col-responsive",children:[e.jsx("div",{style:{gridColumn:"span 6",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",marginBottom:"0.5rem"},children:e.jsx("h3",{style:{fontSize:"1rem",color:"var(--primary)"},children:"Informasi Identitas"})}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 4"},children:[e.jsx("label",{children:"Nama Lengkap"}),e.jsx("input",{required:!0,value:s.nama,onChange:n=>N({...s,nama:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"ID Sambungan"}),e.jsx("input",{required:!0,value:s.id_sambungan,onChange:n=>N({...s,id_sambungan:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Telepon"}),e.jsx("input",{value:s.telepon,onChange:n=>N({...s,telepon:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"ID Meter"}),e.jsx("input",{value:s.id_meter,onChange:n=>N({...s,id_meter:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"ID Tag"}),e.jsx("input",{value:s.id_tag,onChange:n=>N({...s,id_tag:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Active Date"}),e.jsx("input",{type:"date",value:s.active_date,onChange:n=>N({...s,active_date:n.target.value})})]}),e.jsx("div",{style:{gridColumn:"span 6",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",marginTop:"1rem",marginBottom:"0.5rem"},children:e.jsx("h3",{style:{fontSize:"1rem",color:"var(--primary)"},children:"Informasi Alamat & Lokasi"})}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 6"},children:[e.jsx("label",{children:"Alamat Lengkap"}),e.jsx("textarea",{rows:"2",value:s.alamat,onChange:n=>N({...s,alamat:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Longitude"}),e.jsx("input",{value:s.longitude,onChange:n=>N({...s,longitude:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Latitude"}),e.jsx("input",{value:s.latitude,onChange:n=>N({...s,latitude:n.target.value})})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Nomor Urut"}),e.jsx("input",{value:s.nomor_urut,onChange:n=>N({...s,nomor_urut:n.target.value})})]}),e.jsx("div",{style:{gridColumn:"span 6",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",marginTop:"1rem",marginBottom:"0.5rem"},children:e.jsx("h3",{style:{fontSize:"1rem",color:"var(--primary)"},children:"Kode Area & Klasifikasi"})}),e.jsx(Fe,{label:"Tarif",containerStyle:{gridColumn:"span 2",marginBottom:0},options:de.map(n=>({value:n.kode_tarif,label:n.tarif})),value:s.kode_tarif,onChange:n=>N({...s,kode_tarif:n.target.value}),placeholder:"Pilih Tarif",searchPlaceholder:"Cari tarif..."}),e.jsx(Fe,{label:"Cabang",containerStyle:{gridColumn:"span 2",marginBottom:0},options:I.map(n=>({value:n.kode_cabang,label:n.cabang})),value:s.kode_cabang,onChange:async n=>{const j=n.target.value;if(N({...s,kode_cabang:j,kode_rute:""}),c([]),j){const B=await i("rute",{kode_cabang:j});c(B)}else{const B=await i("rute");c(B)}},placeholder:"Pilih Cabang",searchPlaceholder:"Cari cabang...",displayTop:!0}),e.jsx(Fe,{label:"Rute",containerStyle:{gridColumn:"span 2",marginBottom:0},disabled:!s.kode_cabang,options:xe.map(n=>({value:n.kode_rute,label:n.rute})),value:s.kode_rute,onChange:n=>N({...s,kode_rute:n.target.value}),placeholder:s.kode_cabang?"Pilih Rute":"Pilih Cabang Dahulu",searchPlaceholder:"Cari rute...",displayTop:!0}),e.jsx(Fe,{label:"Kecamatan",containerStyle:{gridColumn:"span 2",marginBottom:0},required:!0,options:J.map(n=>({value:n.kode_kecamatan,label:n.kecamatan})),value:s.kode_kecamatan,onChange:async n=>{const j=n.target.value,B=J.find(F=>F.kode_kecamatan===j);if(N({...s,kode_kecamatan:j,kode_desa:"",kode_rw:"",kode_rt:""}),be({kec:B?.id||null,desa:null,rw:null}),M([]),l([]),b([]),B){const F=await oe("desa",{kec_id:B.id});M(F)}},placeholder:"Pilih Kecamatan",searchPlaceholder:"Cari kecamatan...",displayTop:!0}),e.jsx(Fe,{label:"Desa",containerStyle:{gridColumn:"span 2",marginBottom:0},required:!0,disabled:!s.kode_kecamatan,options:A.map(n=>({value:n.kode_desa,label:n.desa})),value:s.kode_desa,onChange:async n=>{const j=n.target.value,B=A.find(F=>F.kode_desa===j);if(N({...s,kode_desa:j,kode_rw:"",kode_rt:""}),be(F=>({...F,desa:B?.id||null,rw:null})),l([]),b([]),B){const F=await oe("rw",{kec_id:ie.kec,desa_id:B.id});l(F)}},placeholder:"Pilih Desa",searchPlaceholder:"Cari desa...",displayTop:!0}),e.jsxs("div",{className:"form-row",style:{gridColumn:"span 2"},children:[e.jsx(Fe,{label:"RW",options:u.map(n=>({value:n.kode_rw,label:n.rw})),value:s.kode_rw,disabled:!s.kode_desa,onChange:async n=>{const j=n.target.value,B=u.find(F=>F.kode_rw===j);if(N({...s,kode_rw:j,kode_rt:""}),b([]),B){const F=await oe("rt",{kec_id:ie.kec,desa_id:ie.desa,rw_id:B.id});b(F)}},placeholder:"RW",searchPlaceholder:"Cari RW...",displayTop:!0}),e.jsx(Fe,{label:"RT",options:x.map(n=>({value:n.kode_rt,label:n.rt})),value:s.kode_rt,disabled:!s.kode_rw,onChange:n=>N({...s,kode_rt:n.target.value}),placeholder:"RT",searchPlaceholder:"Cari RT...",displayTop:!0})]})]}),e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9",marginTop:"2rem",paddingTop:"1.5rem",paddingBottom:"1rem",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{padding:"0.625rem 1.5rem",borderRadius:"8px",fontWeight:600,minWidth:"100px"},onClick:m,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{padding:"0.625rem 2rem",borderRadius:"8px",fontWeight:600,minWidth:"160px",boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)",opacity:U.meter||U.rumah?.7:1,cursor:U.meter||U.rumah?"not-allowed":"pointer"},disabled:U.meter||U.rumah,children:U.meter||U.rumah?"Memproses Foto...":O?"Simpan Perubahan":"Tambah Pelanggan"})]})]})]})}),ce&&e.jsx("div",{className:"modal-overlay",style:{zIndex:2e3,background:"rgba(0,0,0,0.85)"},onClick:()=>Se(null),children:e.jsxs("div",{style:{position:"relative",maxWidth:"90vw",maxHeight:"90vh",display:"flex",flexDirection:"column",alignItems:"center"},onClick:n=>n.stopPropagation(),children:[e.jsxs("button",{onClick:()=>Se(null),style:{position:"absolute",top:"-40px",right:"0",background:"none",border:"none",color:"white",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"1rem",padding:"0.5rem"},children:[e.jsx(ge,{size:24})," Tutup"]}),e.jsx("img",{src:ce&&ce.startsWith("/")?`${ft}${ce}`:ce,alt:"Preview Meteran",style:{width:"100%",height:"auto",maxHeight:"80vh",borderRadius:"8px",border:"4px solid white",boxShadow:"0 0 20px rgba(0,0,0,0.5)"}}),e.jsx("p",{style:{color:"white",marginTop:"1rem",fontSize:"1.1rem",fontWeight:600},children:"Foto Meteran Pelanggan"})]})})]})}function Wa({isOpen:v,onClose:G,onConfirm:S,title:D,message:k,type:P="danger"}){return v?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"400px",textAlign:"center"},children:[e.jsx("button",{onClick:G,style:{position:"absolute",right:"1.5rem",top:"1.5rem",background:"none",border:"none",color:"var(--text-light)",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ge,{size:20})}),e.jsx("div",{style:{width:"64px",height:"64px",background:P==="danger"?"#fee2e2":"#e0f2fe",color:P==="danger"?"#ef4444":"var(--primary)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem"},children:e.jsx(Sa,{size:32})}),e.jsx("h3",{style:{fontSize:"1.25rem",marginBottom:"0.75rem",fontWeight:600},children:D}),e.jsx("p",{style:{color:"var(--text-light)",marginBottom:"2rem",fontSize:"0.925rem"},children:k}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"stretch"},children:[e.jsx("button",{className:"btn btn-outline",style:{flex:1,justifyContent:"center",height:"42px",borderRadius:"8px",fontWeight:600},onClick:G,children:"Batal"}),e.jsx("button",{className:"btn",style:{flex:1,justifyContent:"center",height:"42px",borderRadius:"8px",fontWeight:600,background:P==="danger"?"#ef4444":"var(--primary)",color:"white",boxShadow:P==="danger"?"0 4px 6px -1px rgba(239, 68, 68, 0.2)":"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},onClick:()=>{S(),G()},children:P==="danger"?"Ya, Hapus":"Ya, Konfirmasi"})]})]})}):null}const Wt="./api/branches.php",yt=[{id:"kode_cabang",label:"Kode Cabang"},{id:"cabang",label:"Nama Cabang"},{id:"alamat",label:"Alamat"},{id:"telepon",label:"Telepon"}],ra=["kode_cabang","cabang","alamat","telepon"];function Ma(){const[v,G]=r.useState([]),[S,D]=r.useState(!0),[k,P]=r.useState(""),[_,V]=r.useState(!1),[O,q]=r.useState(!1),[J,E]=r.useState(null),[A,M]=r.useState(null),[u,l]=r.useState(null),[x,b]=r.useState({kode_cabang:"",cabang:"",alamat:"",telepon:""}),[de,ne]=r.useState(!1),[xe,c]=r.useState(null),[I,L]=r.useState([]),[ie,be]=r.useState([]),[se,Ie]=r.useState(""),[ze,$e]=r.useState(!1),[ue,Pe]=r.useState(!1),w=ba.useRef(null),[X,Z]=r.useState(()=>{const o=localStorage.getItem("pdam_visible_columns_branches");return o?JSON.parse(o):ra});r.useEffect(()=>{localStorage.setItem("pdam_visible_columns_branches",JSON.stringify(X))},[X]),r.useEffect(()=>{const o=z=>{w.current&&!w.current.contains(z.target)&&Pe(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const H=r.useCallback((o,z="success")=>{l({message:o,type:z}),setTimeout(()=>l(null),3e3)},[]),fe=async()=>{try{D(!0);const z=await(await fetch(Wt)).json();G(z)}catch(o){console.error("Failed to fetch:",o),H("Gagal mengambil data cabang","error")}finally{D(!1)}};r.useEffect(()=>{fe()},[]);const Ne=(o=null)=>{o?(M(o),b({kode_cabang:o.kode_cabang||"",cabang:o.cabang||"",alamat:o.alamat||"",telepon:o.telepon||""})):(M(null),b({kode_cabang:"",cabang:"",alamat:"",telepon:""})),V(!0)},ye=()=>{V(!1),M(null)},We=async o=>{o.preventDefault();const z=A?"PUT":"POST",s=A?`${Wt}?id=${A.id}`:Wt;try{const te=await(await fetch(s,{method:z,headers:{"Content-Type":"application/json"},body:JSON.stringify(x)})).json();te.message?(fe(),ye(),H(A?"Cabang berhasil diperbarui":"Cabang berhasil ditambahkan")):te.error&&H(te.error,"error")}catch(N){console.error("Save failed:",N),H("Terjadi kesalahan saat menyimpan","error")}},je=o=>{E(o),q(!0)},Me=async()=>{try{(await(await fetch(`${Wt}?id=${J}`,{method:"DELETE"})).json()).message?(fe(),H("Cabang berhasil dihapus")):H("Gagal menghapus cabang","error")}catch(o){console.error("Delete failed:",o),H("Terjadi kesalahan sistem","error")}},_e=async o=>{c(o),ne(!0),$e(!0);try{const s=await(await fetch(`./api/branch_routes.php?kode_cabang=${o.kode_cabang}`)).json();L(s),be(s.filter(N=>N.assigned).map(N=>N.kode_rute))}catch(z){console.error("Failed to fetch routes:",z),H("Gagal mengambil data rute","error")}finally{$e(!1)}},Q=o=>{be(z=>z.includes(o)?z.filter(s=>s!==o):[...z,o])},ce=()=>{const z=I.filter(s=>s.kode_rute.toLowerCase().includes(se.toLowerCase())||s.rute.toLowerCase().includes(se.toLowerCase())).map(s=>s.kode_rute);be(s=>[...new Set([...s,...z])])},Se=()=>{const z=I.filter(s=>s.kode_rute.toLowerCase().includes(se.toLowerCase())||s.rute.toLowerCase().includes(se.toLowerCase())).map(s=>s.kode_rute);be(s=>s.filter(N=>!z.includes(N)))},U=async()=>{try{const z=await(await fetch("./api/branch_routes.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kode_cabang:xe.kode_cabang,routes:ie})})).json();z.message?(H(`Berhasil menyimpan ${z.total_routes} rute`),ne(!1)):H(z.error||"Gagal menyimpan","error")}catch(o){console.error("Save routes failed:",o),H("Terjadi kesalahan saat menyimpan","error")}},Ye=()=>{const o=yt.filter(h=>X.includes(h.id)),z=o.map(h=>h.label),s=Ce.map(h=>o.map(m=>h[m.id]||"-")),N=[z,...s].map(h=>h.map(m=>`"${m}"`).join(",")).join(`
`),te=new Blob([N],{type:"text/csv;charset=utf-8;"}),oe=URL.createObjectURL(te),i=document.createElement("a");i.setAttribute("href",oe),i.setAttribute("download",`data_cabang_${new Date().toISOString().split("T")[0]}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)},Be=()=>{const o=yt.filter(te=>X.includes(te.id)),z=Ce.map(te=>{const oe={};return o.forEach(i=>{oe[i.label]=te[i.id]||"-"}),oe}),s=Ee.json_to_sheet(z),N=Ee.book_new();Ee.book_append_sheet(N,s,"Cabang"),zt(N,`data_cabang_${new Date().toISOString().split("T")[0]}.xlsx`)},De=()=>{try{const o=new Ct("p","mm","a4"),z=new Date().toLocaleString("id-ID");o.setFontSize(18),o.setTextColor(14,165,233),o.text("Laporan Data Cabang PDAM",14,15),o.setFontSize(10),o.setTextColor(100),o.text(`Jumlah Total: ${Ce.length} Cabang`,14,22),o.text(`Waktu Cetak: ${z}`,196,22,{align:"right"});const s=yt.filter(oe=>X.includes(oe.id)),N=["No",...s.map(oe=>oe.label)],te=Ce.map((oe,i)=>[i+1,...s.map(h=>oe[h.id]||"-")]);At(o,{head:[N],body:te,startY:28,theme:"grid",styles:{fontSize:9,cellPadding:2},headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"}}),o.save(`data_cabang_${new Date().toISOString().split("T")[0]}.pdf`)}catch(o){console.error("PDF Export Error:",o),H("Gagal mengekspor PDF","error")}},ke=()=>{window.print()},Ce=v.filter(o=>(o.cabang||"").toLowerCase().includes(k.toLowerCase())||(o.kode_cabang||"").toLowerCase().includes(k.toLowerCase())||(o.alamat||"").toLowerCase().includes(k.toLowerCase())||(o.telepon||"").toLowerCase().includes(k.toLowerCase()));return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[u&&e.jsxs("div",{style:{position:"fixed",top:"2rem",left:"50%",transform:"translateX(-50%)",zIndex:1e3,display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem 1.5rem",borderRadius:"10px",background:u.type==="success"?"#10b981":"#ef4444",color:"white",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",animation:"slideDown 0.3s ease-out"},children:[u.type==="success"?e.jsx(Ca,{size:20}):e.jsx(Bt,{size:20}),e.jsx("span",{style:{fontWeight:500},children:u.message})]}),e.jsxs("header",{className:"header",style:{marginBottom:"2.5rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{background:"rgba(14, 165, 233, 0.1)",padding:"0.625rem",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ft,{size:32,color:"var(--primary)"})}),"Data Cabang"]}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.95rem",marginTop:"0.25rem"},children:"Manajemen data kantor cabang dan jangkauan wilayah"})]}),e.jsxs("div",{className:"header-actions no-print",style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:Ye,title:"Export CSV",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:Be,title:"Export Excel",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:De,title:"Export PDF",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:ke,title:"Print",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(_t,{size:18})})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>Ne(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:600,whiteSpace:"nowrap",boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:[e.jsx(ot,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Cabang"})]})]})]}),e.jsxs("div",{className:"card",style:{padding:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative"},ref:w,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>Pe(!ue),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",borderRadius:"8px",fontWeight:600,background:ue?"#f1f5f9":"#f8fafc",border:`1px solid ${ue?"var(--primary)":"var(--border)"}`,color:ue?"var(--primary)":"var(--text)"},children:[e.jsx(St,{size:18}),e.jsx("span",{children:"Pilih Kolom"})]}),ue&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"220px",animation:"fadeIn 0.2s ease-out"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",color:"var(--text)",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem"},children:yt.map(o=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px",transition:"background 0.2s"},onMouseEnter:z=>z.currentTarget.style.background="#f8fafc",onMouseLeave:z=>z.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:X.includes(o.id),onChange:()=>{Z(z=>z.includes(o.id)?z.filter(s=>s!==o.id):[...z,o.id])}}),e.jsx("span",{style:{color:X.includes(o.id)?"var(--text)":"var(--text-light)",fontWeight:X.includes(o.id)?500:400},children:o.label})]},o.id))}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",gap:"1rem"},children:[e.jsx("button",{style:{background:"none",border:"none",color:"var(--primary)",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>Z(yt.map(o=>o.id)),onMouseEnter:o=>o.currentTarget.style.background="rgba(14, 165, 233, 0.05)",onMouseLeave:o=>o.currentTarget.style.background="none",children:"Pilih Semua"}),e.jsx("button",{style:{background:"none",border:"none",color:"#64748b",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>Z(ra),onMouseEnter:o=>o.currentTarget.style.background="#f1f5f9",onMouseLeave:o=>o.currentTarget.style.background="none",children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(qe,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:k?"2.5rem":"0.625rem",height:"42px",borderRadius:"8px",border:"1px solid var(--border)",fontSize:"0.9rem",width:"100%",background:"#f8fafc"},placeholder:"Cari cabang, alamat atau telepon...",value:k,onChange:o=>P(o.target.value)})]})]}),S?e.jsxs("div",{style:{padding:"8rem 0",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[e.jsx(ta,{className:"animate-spin",size:40,color:"var(--primary)"}),e.jsx("p",{style:{color:"var(--text-light)",fontWeight:500},children:"Memuat data cabang..."})]}):e.jsx("div",{className:"table-container",style:{margin:0},children:e.jsxs("table",{style:{width:"100%",minWidth:"600px"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"60px",padding:"0.625rem 0.75rem",textAlign:"center",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"NO"}),X.includes("kode_cabang")&&e.jsx("th",{style:{width:"130px",padding:"0.625rem 0.75rem",textAlign:"center",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Kode Cabang"}),X.includes("cabang")&&e.jsx("th",{style:{padding:"0.625rem 0.75rem",textAlign:"left",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Nama Cabang"}),X.includes("alamat")&&e.jsx("th",{style:{padding:"0.625rem 0.75rem",textAlign:"left",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Alamat"}),X.includes("telepon")&&e.jsx("th",{style:{width:"160px",padding:"0.625rem 0.75rem",textAlign:"left",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Telepon"}),e.jsx("th",{style:{width:"100px",padding:"0.625rem 0.75rem",textAlign:"center",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Aksi"})]})}),e.jsx("tbody",{children:Ce.length>0?Ce.map((o,z)=>e.jsxs("tr",{style:{transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"0.625rem 0.75rem",textAlign:"center",fontWeight:500,color:"#64748b",fontSize:"0.875rem"},children:z+1}),X.includes("kode_cabang")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",fontWeight:600,color:"var(--text)",textAlign:"center"},children:e.jsx("span",{style:{background:"#f1f5f9",color:"#1e293b",padding:"0.2rem 0.625rem",borderRadius:"4px",fontSize:"0.8125rem",border:"1px solid #e2e8f0"},children:o.kode_cabang})}),X.includes("cabang")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",color:"var(--text)",fontSize:"0.9rem",fontWeight:500},children:o.cabang}),X.includes("alamat")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",color:"#64748b",fontSize:"0.875rem"},children:e.jsx("div",{style:{maxWidth:"350px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:o.alamat,children:o.alamat||"-"})}),X.includes("telepon")&&e.jsx("td",{style:{padding:"0.625rem 0.75rem",color:"#64748b",fontSize:"0.875rem"},children:o.telepon||"-"}),e.jsx("td",{style:{padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",borderRadius:"6px",width:"28px",height:"28px"},onClick:()=>Ne(o),title:"Edit Cabang",children:e.jsx(at,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",color:"#ef4444",borderRadius:"6px",width:"28px",height:"28px"},onClick:()=>je(o.id),title:"Hapus Cabang",children:e.jsx(Ut,{size:14})})]})})]},o.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:X.length+2,style:{textAlign:"center",padding:"5rem 0"},children:[e.jsx("div",{style:{opacity:.5,marginBottom:"1rem"},children:e.jsx(Ft,{size:64,style:{margin:"0 auto"}})}),e.jsx("p",{style:{color:"var(--text-light)",fontSize:"1rem"},children:k?`Tidak ditemukan hasil untuk "${k}"`:"Belum ada data cabang."})]})})})]})})]}),_&&e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",style:{maxWidth:"450px",borderRadius:"16px",padding:0,maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsxs("div",{style:{padding:"2rem",flex:1,overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",display:"flex",alignItems:"center",gap:"0.75rem",fontWeight:700},children:A?e.jsxs(e.Fragment,{children:[e.jsx(at,{size:24,color:"var(--primary)"})," Edit Cabang"]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{size:24,color:"var(--primary)"})," Tambah Cabang"]})}),e.jsx("button",{onClick:ye,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s",marginTop:"-0.5rem",marginRight:"-0.5rem"},onMouseEnter:o=>o.currentTarget.style.color="#64748b",onMouseLeave:o=>o.currentTarget.style.color="#94a3b8",children:e.jsx(ge,{size:24})})]}),e.jsxs("form",{onSubmit:We,children:[e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Kode Cabang"}),e.jsx("input",{required:!0,maxLength:"3",placeholder:"Contoh: 10",style:{height:"48px",borderRadius:"8px"},value:x.kode_cabang,onChange:o=>b({...x,kode_cabang:o.target.value})}),e.jsx("small",{style:{color:"var(--text-light)",marginTop:"0.25rem",display:"block"},children:"Maksimal 3 karakter"})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Nama Cabang"}),e.jsx("input",{required:!0,placeholder:"Masukkan nama cabang",style:{height:"48px",borderRadius:"8px"},value:x.cabang,onChange:o=>b({...x,cabang:o.target.value})})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Telepon"}),e.jsx("input",{placeholder:"Contoh: 0234-123456",style:{height:"48px",borderRadius:"8px"},value:x.telepon,onChange:o=>b({...x,telepon:o.target.value})})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{fontWeight:600,color:"var(--text)",marginBottom:"0.5rem"},children:"Alamat"}),e.jsx("textarea",{placeholder:"Masukkan alamat lengkap cabang",style:{padding:"0.75rem",borderRadius:"8px",border:"1px solid var(--border)",width:"100%",minHeight:"100px",fontSize:"0.95rem",fontFamily:"inherit"},value:x.alamat,onChange:o=>b({...x,alamat:o.target.value})})]}),A&&e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsxs("button",{type:"button",className:"btn btn-outline",onClick:()=>{ye(),_e(A)},style:{width:"100%",padding:"0.75rem",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",borderColor:"var(--primary)",color:"var(--primary)",fontWeight:600},children:[e.jsx(qt,{size:20}),"Kelola Rute"]}),e.jsx("small",{style:{color:"var(--text-light)",marginTop:"0.5rem",display:"block",textAlign:"center"},children:"Atur rute yang tersedia di cabang ini"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{flex:1,padding:"0.625rem",borderRadius:"8px",fontWeight:600},onClick:ye,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{flex:2,padding:"0.625rem",borderRadius:"8px",fontWeight:600,boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:A?"Simpan Perubahan":"Simpan Data"})]})]})]})})}),e.jsx(Wa,{isOpen:O,onClose:()=>q(!1),onConfirm:Me,title:"Hapus Cabang?",message:"Tindakan ini tidak dapat dibatalkan. Seluruh data terkait cabang ini mungkin terdampak.",type:"danger"}),de&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"700px",borderRadius:"16px",padding:0,maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h2",{style:{fontSize:"1.25rem",fontWeight:700,display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(qt,{size:24,color:"var(--primary)"}),"Kelola Rute - ",xe?.cabang]}),e.jsx("button",{onClick:()=>ne(!1),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ge,{size:24})})]}),e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid var(--border)",background:"#f8fafc"},children:[e.jsxs("div",{style:{position:"relative",marginBottom:"1rem"},children:[e.jsx(qe,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{autoFocus:!0,placeholder:"Ketik untuk mencari rute...",value:se,onChange:o=>Ie(o.target.value),style:{paddingLeft:"2.5rem",paddingRight:se?"2.5rem":"1rem",height:"44px",borderRadius:"8px",border:"2px solid var(--primary)",width:"100%",fontSize:"0.95rem",boxShadow:"0 0 0 3px rgba(14, 165, 233, 0.1)"}}),se&&e.jsx("button",{onClick:()=>Ie(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"#e2e8f0",border:"none",borderRadius:"50%",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#64748b",transition:"all 0.2s"},onMouseEnter:o=>{o.currentTarget.style.background="#cbd5e1",o.currentTarget.style.color="#334155"},onMouseLeave:o=>{o.currentTarget.style.background="#e2e8f0",o.currentTarget.style.color="#64748b"},title:"Clear search",children:e.jsx(ge,{size:14})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:ce,className:"btn btn-outline",style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"Pilih Semua"}),e.jsx("button",{onClick:Se,className:"btn btn-outline",style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"Hapus Semua"})]}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"var(--text-light)",fontWeight:500},children:[ie.length," rute dipilih"]})]})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem 2rem"},children:ze?e.jsx("div",{style:{padding:"3rem",textAlign:"center"},children:e.jsx(ta,{className:"animate-spin",size:32,color:"var(--primary)",style:{margin:"0 auto"}})}):e.jsx("div",{style:{display:"grid",gap:"0.5rem"},children:I.filter(o=>o.kode_rute.toLowerCase().includes(se.toLowerCase())||o.rute.toLowerCase().includes(se.toLowerCase())).map(o=>e.jsxs("label",{className:`route-checkbox-item ${ie.includes(o.kode_rute)?"selected":""}`,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",border:"1px solid var(--border)",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:ie.includes(o.kode_rute),onChange:()=>Q(o.kode_rute),style:{width:"18px",height:"18px",accentColor:"var(--primary)",cursor:"pointer"}}),e.jsxs("div",{style:{flex:1,pointerEvents:"none"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem",color:"var(--text)"},children:o.kode_rute}),e.jsx("div",{style:{fontSize:"0.8125rem",color:"var(--text-light)"},children:o.rute})]})]},o.kode_rute))})}),e.jsxs("div",{style:{padding:"1.5rem 2rem",borderTop:"1px solid #f1f5f9",display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>ne(!1),className:"btn btn-outline",style:{padding:"0.625rem 1.5rem",borderRadius:"8px",fontWeight:600},children:"Batal"}),e.jsx("button",{onClick:U,className:"btn btn-primary",style:{padding:"0.625rem 2rem",borderRadius:"8px",fontWeight:600,boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:"Simpan Perubahan"})]})]})}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideDown {
                    from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
                .animate-spin {
                    animation: spin 1s linear infinite;
                }
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                .route-checkbox-item {
                    background: white;
                    transition: background-color 0.15s ease;
                }
                .route-checkbox-item:hover {
                    background: #f8fafc;
                }
                .route-checkbox-item.selected {
                    background: #f0f9ff;
                }
                .route-checkbox-item.selected:hover {
                    background: #e0f2fe;
                }
                @media print {
                    .no-print {
                        display: none !important;
                    }
                    body {
                        background: white !important;
                        padding: 0 !important;
                    }
                    .card {
                        box-shadow: none !important;
                        border: 1px solid #e2e8f0 !important;
                        padding: 0 !important;
                    }
                    .table-container {
                        overflow: visible !important;
                    }
                    table {
                        width: 100% !important;
                        border-collapse: collapse !important;
                    }
                    th, td {
                        border: 1px solid #e2e8f0 !important;
                        padding: 8px !important;
                        font-size: 10pt !important;
                    }
                    .header {
                        margin-bottom: 20px !important;
                    }
                    @page {
                        size: auto;
                        margin: 15mm;
                    }
                }
            `}})]})}const ga=({value:v,onChange:G,minDate:S=Ge(new Date),maxDate:D=new Date})=>{const[k,P]=r.useState(!1),[_,V]=r.useState(v||new Date),O=r.useRef(null);r.useEffect(()=>{const l=x=>{O.current&&!O.current.contains(x.target)&&P(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const q=l=>{l.stopPropagation();const x=Lt(_);Xe(it(x),S)||V(x)},J=l=>{l.stopPropagation();const x=Ht(_,1);Ze(Ge(x),D)||V(x)},E=l=>{l.stopPropagation();const x=Pt(_);Xe(it(x),S)||V(x)},A=l=>{l.stopPropagation();const x=Ot(_,1);Ze(Ge(x),D)||V(x)},M=l=>{Xe(l,S)&&!xt(l,S)||Ze(l,D)&&!xt(l,D)||(G(l),P(!1))},u=ya({start:ka(Ge(_)),end:ja(it(_))});return e.jsxs("div",{className:"custom-datepicker",style:{position:"relative"},ref:O,children:[e.jsxs("div",{onClick:()=>P(!k),style:{height:"42px",padding:"0 0.75rem 0 2.5rem",borderRadius:"8px",border:"1px solid var(--border)",background:"#f8fafc",fontSize:"0.875rem",color:"#64748b",display:"flex",alignItems:"center",cursor:"pointer",minWidth:"180px",fontWeight:500,position:"relative"},children:[e.jsx($t,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),v?Ve(v,"dd MMMM yyyy",{locale:ma}):"Pilih Tanggal"]}),k&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"16px",boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1)",width:"300px",padding:"1.25rem",animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1.5rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("button",{onClick:q,disabled:Xe(it(Lt(_)),S),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:Xe(it(Lt(_)),S)?"#e2e8f0":"#64748b"},children:e.jsx(et,{size:18})}),e.jsx("span",{style:{minWidth:"45px",textAlign:"center",fontWeight:600,color:"#1e293b",fontSize:"0.9rem"},children:Ve(_,"MMM")}),e.jsx("button",{onClick:J,disabled:Ze(Ge(Ht(_,1)),D),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:Ze(Ge(Ht(_,1)),D)?"#e2e8f0":"#64748b"},children:e.jsx(tt,{size:18})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("button",{onClick:E,disabled:Xe(it(Pt(_)),S),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:Xe(it(Pt(_)),S)?"#e2e8f0":"#64748b"},children:e.jsx(et,{size:18})}),e.jsx("span",{style:{fontWeight:600,color:"#1e293b",fontSize:"0.9rem"},children:Ve(_,"yyyy")}),e.jsx("button",{onClick:A,disabled:Ze(Ge(Ot(_,1)),D),style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:Ze(Ge(Ot(_,1)),D)?"#e2e8f0":"#64748b"},children:e.jsx(tt,{size:18})})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",textAlign:"center",marginBottom:"8px"},children:["S","M","T","W","T","F","S"].map((l,x)=>e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:500,color:"#94a3b8",padding:"4px"},children:l},x))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"2px"},children:u.map((l,x)=>{const b=v&&xt(l,v),de=va(l),ne=wa(l,_),xe=Xe(l,S)&&!xt(l,S),c=Ze(l,D)&&!xt(l,D),I=xe||c;return e.jsxs("div",{onClick:()=>!I&&M(l),style:{aspectRatio:"1/1",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.8125rem",cursor:I?"not-allowed":"pointer",color:I?"#e2e8f0":ne?"#1e293b":"#cbd5e1",position:"relative",fontWeight:b||de?700:400},children:[b&&e.jsx("div",{style:{position:"absolute",width:"32px",height:"32px",borderRadius:"50%",border:"1px solid #000",zIndex:0}}),e.jsx("span",{style:{zIndex:1},children:Ve(l,"d")})]},x)})}),e.jsx("button",{onClick:()=>{G(new Date),V(new Date),P(!1)},style:{width:"100%",marginTop:"1rem",padding:"0.5rem",background:"#f8fafc",border:"none",borderRadius:"8px",fontSize:"0.75rem",fontWeight:600,color:"var(--primary)",cursor:"pointer"},children:"Pilih Hari Ini"})]}),e.jsx("style",{children:`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(5px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]})},Ea=({value:v,onChange:G,disableCurrent:S=!1,disablePastYears:D=!1})=>{const[k,P]=r.useState(!1),[_,V]=r.useState(v||new Date),O=r.useRef(null);r.useEffect(()=>{const u=l=>{O.current&&!O.current.contains(l.target)&&P(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const q=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],J=new Date,E=J.getMonth(),A=J.getFullYear(),M=u=>{if(_.getFullYear()>A||_.getFullYear()===A&&(S?u>=E:u>E))return;const x=new Date(_.getFullYear(),u,1);G(x),P(!1)};return e.jsxs("div",{style:{position:"relative"},ref:O,children:[e.jsxs("div",{onClick:()=>P(!k),style:{height:"42px",padding:"0 0.75rem 0 2.5rem",borderRadius:"8px",border:"1px solid var(--border)",background:"#f8fafc",fontSize:"0.875rem",color:"#1e293b",display:"flex",alignItems:"center",cursor:"pointer",minWidth:"180px",fontWeight:600,position:"relative"},children:[e.jsx($t,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),Ve(v,"MMMM yyyy",{locale:ma}),e.jsx(Qe,{size:16,style:{marginLeft:"auto",color:"#64748b"}})]}),k&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"16px",boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1)",width:"280px",padding:"1.25rem",animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.25rem"},children:[e.jsx("button",{onClick:()=>!D&&V(Pt(_)),disabled:D,style:{background:"none",border:"none",cursor:D?"not-allowed":"pointer",color:D?"#e2e8f0":"#64748b"},children:e.jsx(et,{size:20})}),e.jsx("span",{style:{fontWeight:700,fontSize:"1.1rem",color:"#1e293b"},children:_.getFullYear()}),e.jsx("button",{onClick:()=>{_.getFullYear()<A&&V(Ot(_,1))},style:{background:"none",border:"none",cursor:_.getFullYear()<A?"pointer":"not-allowed",color:_.getFullYear()<A?"#64748b":"#e2e8f0"},disabled:_.getFullYear()>=A,children:e.jsx(tt,{size:20})})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px"},children:q.map((u,l)=>{const x=v.getMonth()===l&&v.getFullYear()===_.getFullYear(),b=_.getFullYear()>A||_.getFullYear()===A&&(S?l>=E:l>E),de=D&&_.getFullYear()<A,ne=b||de;return e.jsx("button",{onClick:()=>!ne&&M(l),disabled:ne,style:{padding:"10px 5px",borderRadius:"8px",border:"1px solid "+(x?"var(--primary)":"transparent"),background:x?"rgba(14, 165, 233, 0.1)":"transparent",color:x?"var(--primary)":ne?"#cbd5e1":"#1e293b",fontSize:"0.8125rem",fontWeight:x?700:500,cursor:ne?"not-allowed":"pointer",transition:"all 0.2s",opacity:ne?.6:1},onMouseEnter:xe=>{!x&&!ne&&(xe.target.style.background="#f1f5f9")},onMouseLeave:xe=>{!x&&!ne&&(xe.target.style.background="transparent")},children:u.substring(0,3)},u)})})]}),e.jsx("style",{children:`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(5px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]})},Mt="./api/recordings.php",Da="./api/customers.php",Et="http://localhost",jt=[{id:"id_sambungan",label:"NO. SAMBUNGAN"},{id:"nama",label:"NAMA PELANGGAN"},{id:"id_meter",label:"ID METER"},{id:"alamat",label:"ALAMAT"},{id:"stan_akhir",label:"STAN AKHIR"},{id:"petugas",label:"PETUGAS"},{id:"foto",label:"FOTO METER"},{id:"foto_rumah",label:"FOTO RUMAH"},{id:"status_laporan",label:"KONDISI METER"},{id:"koordinat",label:"KOORDINAT"},{id:"pemakaian",label:"PEMAKAIAN (m)"},{id:"update_date",label:"TGL PENCATATAN"}],ia=["id_sambungan","nama","id_meter","alamat","stan_akhir","pemakaian","petugas","foto","foto_rumah","status_laporan","koordinat","update_date"];function sa({isHistory:v=!1}){const[G,S]=r.useState([]),[D,k]=r.useState([]),[P,_]=r.useState([]),[V,O]=r.useState(!0),[q,J]=r.useState(""),[E,A]=r.useState(!1),[M,u]=r.useState(null),[l,x]=r.useState(!1),[b,de]=r.useState(!1),ne=r.useRef(null),xe=r.useRef(null),[c,I]=r.useState(()=>{const a=localStorage.getItem("pdam_visible_columns_rec_v7");return a?JSON.parse(a):ia}),[L,ie]=r.useState(1),[be,se]=r.useState(10),[Ie,ze]=r.useState("nama"),[$e,ue]=r.useState(null),[Pe,w]=r.useState(null),[X,Z]=r.useState(null),[H,fe]=r.useState(!1),[Ne,ye]=r.useState(0),[We,je]=r.useState(null),[Me,_e]=r.useState(null),[Q,ce]=r.useState(null),[Se,U]=r.useState(!1),[Ye,Be]=r.useState(null),[De,ke]=r.useState(!1),[Ce,o]=r.useState(""),z=r.useRef(null),[s,N]=r.useState({id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",bulan:new Date().getMonth()+1,tahun:new Date().getFullYear(),stan_akhir:0,foto:"",foto_rumah:"",kode_tarif:"",longitude:"",latitude:"",petugas:"Admin",status_laporan:""}),[te,oe]=r.useState([]),[i,h]=r.useState([]),[m,ee]=r.useState([]);r.useEffect(()=>{R(),he(),ae(),pe()},[]),r.useEffect(()=>{const a=d=>{ne.current&&!ne.current.contains(d.target)&&x(!1),xe.current&&!xe.current.contains(d.target)&&de(!1),z.current&&!z.current.contains(d.target)&&ke(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const ae=async()=>{try{const d=await(await fetch("./api/officers.php")).json();h(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch officers:",a)}},pe=async()=>{try{const d=await(await fetch("./api/options.php?type=status_kondisi")).json();ee(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch status kondisi:",a)}},R=async()=>{try{O(!0);const d=await(await fetch(Mt)).json();S(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch recordings:",a)}finally{O(!1)}},he=async()=>{try{const d=await(await fetch(Da)).json();k(Array.isArray(d)?d:[])}catch(a){console.error("Failed to fetch customers:",a)}};r.useEffect(()=>{if(!s.id_pelanggan){oe([]);return}let a=s.bulan-1,d=s.tahun;a===0&&(a=12,d=s.tahun-1);const y=G.filter(W=>(W.id_pelanggan==s.id_pelanggan||W.id_sambungan==s.id_sambungan)&&W.bulan==a&&W.tahun==d);oe(y)},[s.id_pelanggan,s.bulan,s.tahun,G]);const Le=async(a,d)=>{if(!(!a||!d)){U(!0);try{const y=new FormData;y.append("image",a),y.append("user_input",d);const C=await(await fetch("http://localhost:5000/validate",{method:"POST",body:y})).json();C.error?(console.error("AI Error:",C.error),ce({status:"ERROR",message:C.error})):(ce({similarity:C.similarity_percent,status:C.status,detected:C.detected,bestMatch:C.best_match}),C.debug_image&&Be(C.debug_image))}catch(y){console.error("AI fetch failed:",y),ce({status:"ERROR",message:"Koneksi ke AI terputus"})}finally{U(!1)}}};r.useEffect(()=>{localStorage.setItem("pdam_visible_columns_rec_v2",JSON.stringify(c))},[c]),r.useEffect(()=>{function a(d){ne.current&&!ne.current.contains(d.target)&&x(!1),xe.current&&!xe.current.contains(d.target)&&de(!1),z.current&&!z.current.contains(d.target)&&ke(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const lt=async a=>{const d=D.find(y=>y.id==a);if(d){let y=s.bulan-1,W=s.tahun;if(y===0&&(y=12,W=s.tahun-1),G.find(C=>(C.id_pelanggan==d.id||C.id_sambungan==d.id_sambungan)&&C.bulan==y&&C.tahun==W),N(C=>({...C,id_pelanggan:d.id,id_sambungan:d.id_sambungan,id_meter:d.id_meter,nama:d.nama,alamat:d.alamat,kode_tarif:d.kode_tarif,stan_akhir:0,longitude:"",latitude:"",petugas:""})),d.kode_rute)try{const t=await(await fetch(`./api/officers.php?route_code=${d.kode_rute}`)).json();h(Array.isArray(t)?t:[]),Array.isArray(t)&&t.length===1&&N(p=>({...p,petugas:t[0].nama}))}catch(C){console.error("Failed to fetch officers for route:",C)}else ae()}},Ue=async(a=null)=>{if(a){u(a),N({...a}),ue(a.foto||null),w(a.foto_rumah||null),je(null),_e(null);const d=D.find(y=>y.id==a.id_pelanggan);if(d&&d.kode_rute)try{const W=await(await fetch(`./api/officers.php?route_code=${d.kode_rute}`)).json();let C=Array.isArray(W)?W:[];if(a.petugas&&!C.some(t=>t.nama===a.petugas)){const f=(await(await fetch("./api/officers.php")).json()||[]).find(g=>g.nama===a.petugas);f&&C.push(f)}h(C),!a.petugas&&C.length===1&&N(t=>({...t,petugas:C[0].nama}))}catch(y){console.error("Failed to fetch officers for edit:",y)}}else u(null),N({id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",bulan:new Date().getMonth()+1,tahun:new Date().getFullYear(),stan_akhir:0,foto:"",foto_rumah:"",kode_tarif:"",longitude:"",latitude:"",petugas:"",status_laporan:""}),oe([]),w(null),je(null),_e(null),_(D),ae();ke(!1),o(""),A(!0)},He=()=>{A(!1),u(null),ue(null),w(null),je(null),_e(null),fe(!1),ye(0),ce(null),Be(null)},ut=(a,d="foto")=>{const y=a.target.files[0];if(y){fe(!0),ye(0);const W=new FileReader;let C=0;const t=setInterval(()=>{C+=Math.random()*30,C>=100&&(C=100,clearInterval(t),W.onloadend=()=>{d==="foto_rumah"?(w(W.result),_e(y)):(ue(W.result),je(y),s.stan_akhir&&Number(s.stan_akhir)!==0&&Le(y,s.stan_akhir)),setTimeout(()=>{fe(!1),ye(0)},500)},W.readAsDataURL(y)),ye(C)},100)}},dt=a=>{a==="foto"?(ue(null),je(null),ce(null),Be(null),N(d=>({...d,foto:null}))):(w(null),_e(null),N(d=>({...d,foto_rumah:null})))};r.useEffect(()=>{if(Q&&Q.detected&&E){const a=s.stan_akhir||"",y=Q.detected.split("");let W=0;for(const p of String(a)){const f=y.indexOf(p);f!==-1&&(W++,y.splice(f,1))}const C=String(a).length>0?W/String(a).length*100:0;let t="RED";C>=99.9?t="GREEN":C>=50&&(t="YELLOW"),C!==Q.similarity&&ce(p=>({...p,similarity:Math.round(C*100)/100,status:t}))}},[s.stan_akhir,E]);const ht=async a=>{if(a.preventDefault(),H)return;const d=new FormData;Object.keys(s).forEach(W=>{W!=="foto"&&W!=="foto_rumah"&&d.append(W,s[W]===0||s[W]?s[W]:"")}),We?d.append("foto",We):s.foto&&d.append("foto",s.foto),Me?d.append("foto_rumah",Me):s.foto_rumah&&d.append("foto_rumah",s.foto_rumah),Q&&Q.status&&d.append("ai_ocr_status",Q.status);const y=M?`${Mt}?id=${M.id}`:Mt;try{me.fire({title:"Menyimpan Data...",text:"Mohon tunggu sebentar",allowOutsideClick:!1,didOpen:()=>{me.showLoading()}});const C=await(await fetch(y,{method:"POST",body:d})).json();C.message?(me.fire({title:"Berhasil!",text:"Data pencatatan berhasil disimpan.",icon:"success",timer:1500,showConfirmButton:!1}),R(),He()):me.fire("Gagal!",C.error||"Terjadi kesalahan saat menyimpan.","error")}catch(W){console.error("Save failed:",W),me.fire("Error!","Gagal menghubungi server.","error")}},gt=async a=>{if((await me.fire({title:"Hapus Pencatatan?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#64748b",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{(await(await fetch(`${Mt}?id=${a}`,{method:"DELETE"})).json()).message&&(me.fire({title:"Berhasil!",text:"Data pencatatan telah dihapus.",icon:"success",timer:1500,showConfirmButton:!1}),R())}catch(y){console.error("Delete failed:",y),me.fire("Error!","Gagal menghapus data.","error")}},n=()=>{const a=jt.filter(g=>c.includes(g.id)),d=a.map(g=>g.label),y=Ke.map(g=>a.map($=>$.id==="status_laporan"?m.find(Ae=>Ae.kode_kondisi===g.status_laporan)?.status_kondisi||g.status_laporan||"-":$.id==="koordinat"?g.latitude&&g.longitude?`${g.latitude}, ${g.longitude}`:"-":$.id==="pemakaian"?Te(g):$.id==="update_date"?g.update_date?g.update_date.slice(0,10):"-":g[$.id]||"-")),W=[d,...y].map(g=>g.map($=>`"${$}"`).join(",")).join(`
`),C=new Blob([W],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(C),p=document.createElement("a");p.setAttribute("href",t);const f=v?"history_pencatatan":"pencatatan_berjalan";p.setAttribute("download",`${f}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(p),p.click(),document.body.removeChild(p)},j=()=>{const a=jt.filter(t=>c.includes(t.id)),d=Ke.map(t=>{const p={};return a.forEach(f=>{let g=t[f.id];f.id==="status_laporan"?g=m.find($=>$.kode_kondisi===t.status_laporan)?.status_kondisi||t.status_laporan||"-":f.id==="koordinat"?g=t.latitude&&t.longitude?`${t.latitude}, ${t.longitude}`:"-":f.id==="pemakaian"?g=Te(t):f.id==="update_date"&&(g=t.update_date?t.update_date.slice(0,10):"-"),p[f.label]=g||"-"}),p}),y=Ee.json_to_sheet(d),W=Ee.book_new();Ee.book_append_sheet(W,y,"Pencatatan"),zt(W,`${v?"history_pencatatan":"pencatatan_berjalan"}_${new Date().toISOString().slice(0,10)}.xlsx`)},B=()=>{const a=new Ct("l","mm","a4"),d=new Date().toLocaleString("id-ID"),y=jt.filter(Y=>c.includes(Y.id));a.setFontSize(18),a.setTextColor(14,165,233);const W=v?"Laporan History Pencatatan Meter PDAM":"Laporan Pencatatan Meter PDAM Bulan Berjalan";a.text(W,14,15),a.setFontSize(10),a.setTextColor(100),a.text(`Jumlah Total: ${Ke.length} Data`,14,22),a.text(`Waktu Cetak: ${d}`,280,22,{align:"right"});const C=y.map(Y=>Y.label),t=Ke.map(Y=>y.map(Re=>Re.id==="status_laporan"?m.find(Qt=>Qt.kode_kondisi===Y.status_laporan)?.status_kondisi||Y.status_laporan||"-":Re.id==="koordinat"?Y.latitude&&Y.longitude?`${Y.latitude}, ${Y.longitude}`:"-":Re.id==="pemakaian"?Te(Y):Re.id==="update_date"?Y.update_date?Y.update_date.slice(0,10):"-":Y[Re.id]||"-"));At(a,{head:[C],body:t,startY:28,theme:"grid",styles:{fontSize:8},headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"}});const f=(a.lastAutoTable.finalY||28)+20;f+40>a.internal.pageSize.height&&(a.addPage(),a.text(`Waktu Cetak: ${d}`,280,22,{align:"right"}));const g=localStorage.getItem("username")||"Admin";a.setFontSize(10),a.setTextColor(50);const ve=a.internal.pageSize.width-20-40;a.text("Dicetak oleh,",ve,f,{align:"center"}),a.text("_______________________",ve,f+25,{align:"center"}),a.text(g,ve,f+30,{align:"center"});const re=v?"riwayat_pencatatan":"pencatatan_berjalan";a.save(`${re}_${new Date().toISOString().split("T")[0]}.pdf`)},F=()=>window.print(),[K,le]=r.useState(new Date),[we,T]=r.useState(()=>Lt(Ge(new Date))),Te=a=>{let d=parseInt(a.bulan)-1,y=parseInt(a.tahun);d===0&&(d=12,y-=1);const W=G.find(t=>t.id_pelanggan===a.id_pelanggan&&parseInt(t.bulan)===d&&parseInt(t.tahun)===y);if(!W)return"Data Belum Tersedia";const C=parseInt(a.stan_akhir)-parseInt(W.stan_akhir);return parseInt(a.stan_akhir)===0?0:C},Ke=G.filter(a=>{if(v){const y=a.update_date?new Date(a.update_date):null;if(!y)return!1;const W=we.getMonth(),C=we.getFullYear();if(y.getMonth()!==W||y.getFullYear()!==C)return!1}else{const y=a.update_date?.slice(0,10),W=K?new Date(K.getTime()-K.getTimezoneOffset()*6e4).toISOString().slice(0,10):null;if(W&&y!==W)return!1}const d=q.toLowerCase().trim();return d?Ie==="nama"?(a.nama?.toLowerCase()||"").includes(d):Ie==="id_sambungan"?(a.id_sambungan?.toLowerCase()||"").includes(d):Ie==="petugas"?(a.petugas?.toLowerCase()||"").includes(d):(a.nama?.toLowerCase()||"").includes(d):!0});r.useEffect(()=>{ie(1)},[q,be]);const nt=()=>{let a=[],y=Math.max(1,L-2),W=Math.min(Je,y+5-1);W-y+1<5&&(y=Math.max(1,W-5+1));for(let C=y;C<=W;C++)a.push(C);return a},Je=Math.ceil(Ke.length/be),rt=L*be,Rt=rt-be,Tt=Ke.slice(Rt,rt);return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .customer-table thead th {
                        position: sticky; top: 0; z-index: 30; background: #f8fafc !important; 
                        box-shadow: inset 0 -2px 0 var(--border);
                        text-transform: uppercase;
                        font-size: 0.7rem; font-weight: 700; letter-spacing: 0.05em; color: #64748b; 
                        padding: 1rem 1.25rem !important;
                        white-space: nowrap;
                    }
                    .customer-table tbody tr:nth-of-type(even) td {
                        background-color: #fafbfc;
                    }
                    .customer-table tbody tr:hover td {
                        background-color: #eff6ff !important;
                    }
                    .customer-table td, .customer-table th {
                        padding: 0.875rem 1.25rem !important;
                        vertical-align: middle;
                        font-size: 0.875rem;
                        color: #334155;
                    }
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left,
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #fafbfc !important;
                    }

                    @media print {
                        .no-print, .no-print * {
                            display: none !important;
                        }
                        
                        body {
                            background: white !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .card {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .table-container {
                            overflow: visible !important;
                            max-height: none !important;
                            width: 100% !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .customer-table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            table-Layout: auto !important;
                            font-size: 8pt !important;
                        }

                        .customer-table th, .customer-table td {
                            border: 1px solid #e2e8f0 !important;
                            padding: 4pt !important;
                            overflow: visible !important;
                            white-space: normal !important;
                            word-break: break-word !important;
                            min-width: 0 !important;
                            width: auto !important;
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .sticky-col-left, .sticky-col-right {
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .customer-table th, .customer-table td { 
                            border: 1px solid #000 !important; 
                            padding: 2px 4px !important;
                            white-space: normal !important;
                            word-break: break-word;
                            font-size: 7pt !important;
                        }
                        @page {
                            size: landscape;
                            margin: 0.5cm;
                        }
                        .print-footer { display: block !important; position: fixed; bottom: 0; right: 0; width: 300px; text-align: center; font-size: 10pt; color: #000; }
                    }
                    .print-footer { display: none; }

                        header.header {
                            margin-bottom: 1rem !important;
                        }

                        h1 {
                            font-size: 16pt !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{background:"rgba(14, 165, 233, 0.1)",padding:"0.625rem",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(st,{size:32,color:"var(--primary)"})}),v?"History Pencatatan":"Pencatatan Meter"]}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.95rem",marginTop:"0.25rem"},children:v?"History lengkap pencatatan meter pelanggan":"Manajemen pencatatan meter pelanggan bulan berjalan"})]}),e.jsxs("div",{className:"header-actions no-print",children:[e.jsx("button",{className:"btn btn-outline",onClick:n,title:"Export CSV",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:j,title:"Export Excel",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:B,title:"Export PDF",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:F,title:"Print",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(_t,{size:18})}),!v&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>Ue(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:600,whiteSpace:"nowrap",boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:[e.jsx(ot,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Catatan"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flex:1,minWidth:"300px"},children:[e.jsxs("div",{style:{position:"relative"},ref:ne,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>x(!l),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",background:l?"#f1f5f9":"#f8fafc",border:`1px solid ${l?"var(--primary)":"var(--border)"}`,color:l?"var(--primary)":"var(--text)",borderRadius:"8px",fontWeight:600},children:[e.jsx(St,{size:18}),e.jsx("span",{children:"Pilih Kolom"})]}),l&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px",maxHeight:"450px",overflowY:"auto"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem"},children:jt.filter(a=>v||a.id!=="pemakaian").map(a=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px"},onMouseEnter:d=>d.currentTarget.style.background="#f8fafc",onMouseLeave:d=>d.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:c.includes(a.id),onChange:()=>I(d=>d.includes(a.id)?d.filter(y=>y!==a.id):[...d,a.id])}),e.jsx("span",{style:{color:c.includes(a.id)?"var(--text)":"var(--text-light)",fontWeight:c.includes(a.id)?500:400},children:a.label})]},a.id))}),e.jsxs("div",{style:{borderTop:"1px solid var(--border)",marginTop:"0.75rem",paddingTop:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{onClick:()=>I(jt.map(a=>a.id)),style:{fontSize:"0.8rem",color:"var(--primary)",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Pilih Semua"}),e.jsx("button",{onClick:()=>I(ia),style:{fontSize:"0.8rem",color:"#64748b",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:xe,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>de(!b),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",background:b?"#f1f5f9":"#f8fafc",border:`1px solid ${b?"var(--primary)":"var(--border)"}`,color:b?"var(--primary)":"var(--text)",borderRadius:"8px",minWidth:"100px",fontWeight:600},children:[e.jsx("span",{children:"Filter"}),e.jsx(Qe,{size:16})]}),b&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px"},children:[{id:"nama",label:"By Nama"},{id:"id_sambungan",label:"By No. Sambungan"},{id:"petugas",label:"By Petugas"}].map(a=>e.jsx("button",{onClick:()=>{ze(a.id),de(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:Ie===a.id?"#f1f5f9":"none",color:Ie===a.id?"var(--primary)":"var(--text)",borderRadius:"8px",cursor:"pointer"},children:a.label},a.id))})]}),v?e.jsx(Ea,{value:we,onChange:a=>T(a),disableCurrent:!0,disablePastYears:!0}):e.jsx(ga,{value:K,onChange:a=>le(a)}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(qe,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:q?"2.5rem":"0.625rem",height:"42px",borderRadius:"8px",border:"1px solid var(--border)",background:"#f8fafc",width:"100%"},placeholder:"Ketik kata kunci pencarian...",value:q,onChange:a=>J(a.target.value)}),q&&e.jsx("button",{onClick:()=>J(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ge,{size:16})})]})]})}),V?e.jsx("div",{style:{padding:"4rem",textAlign:"center",color:"var(--text-light)"},children:"Loading recordings..."}):e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto"},children:e.jsxs("table",{className:"customer-table",style:{tableLayout:"fixed",width:"max-content",minWidth:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"60px",minWidth:"60px",textAlign:"center"},children:"NO"}),c.includes("id_sambungan")&&e.jsx("th",{style:{width:"140px",minWidth:"140px",textAlign:"left"},children:"NO. SAMBUNGAN"}),c.includes("nama")&&e.jsx("th",{style:{width:"200px",minWidth:"200px",textAlign:"left"},children:"NAMA PELANGGAN"}),c.includes("id_meter")&&e.jsx("th",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:"ID METER"}),c.includes("alamat")&&e.jsx("th",{style:{width:"250px",minWidth:"250px",textAlign:"left"},children:"ALAMAT"}),c.includes("stan_akhir")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"STAN AKHIR"}),v&&c.includes("pemakaian")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"center"},children:"PEMAKAIAN (m)"}),c.includes("petugas")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"PETUGAS"}),c.includes("foto")&&e.jsx("th",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:"FOTO METER"}),c.includes("foto_rumah")&&e.jsx("th",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:"FOTO RUMAH"}),c.includes("status_laporan")&&e.jsx("th",{style:{width:"140px",minWidth:"140px",textAlign:"center"},children:"KONDISI METER"}),c.includes("koordinat")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"KOORDINAT"}),c.includes("update_date")&&e.jsx("th",{style:{width:"140px",minWidth:"140px",textAlign:"left"},children:"TGL PENCATATAN"}),!v&&e.jsx("th",{className:"no-print sticky-col-right",style:{width:"100px",minWidth:"100px",textAlign:"center",background:"#f8fafc",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"AKSI"})]})}),e.jsx("tbody",{children:Tt.length>0?Tt.map((a,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{width:"60px",minWidth:"60px",textAlign:"center",fontWeight:500,color:"#64748b"},children:(L-1)*be+d+1}),c.includes("id_sambungan")&&e.jsx("td",{style:{width:"140px",minWidth:"140px",fontWeight:600,textAlign:"left"},children:a.id_sambungan}),c.includes("nama")&&e.jsx("td",{style:{width:"200px",minWidth:"200px",textAlign:"left"},children:a.nama}),c.includes("id_meter")&&e.jsx("td",{style:{width:"120px",minWidth:"120px",textAlign:"left"},children:a.id_meter}),c.includes("alamat")&&e.jsx("td",{title:a.alamat,style:{width:"250px",maxWidth:"250px",minWidth:"250px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"left"},children:a.alamat}),c.includes("stan_akhir")&&e.jsx("td",{style:{width:"100px",minWidth:"100px",textAlign:"center",fontWeight:600,color:"var(--primary)"},children:a.stan_akhir}),v&&c.includes("pemakaian")&&e.jsx("td",{style:{width:"150px",minWidth:"150px",textAlign:"center"},children:(()=>{const y=Te(a);return y==="Data Belum Tersedia"?e.jsx("span",{style:{fontSize:"0.7rem",color:"#64748b",background:"#f1f5f9",padding:"0.2rem 0.5rem",borderRadius:"4px",fontWeight:500,whiteSpace:"nowrap"},children:"DATA BELUM TERSEDIA"}):e.jsx("span",{style:{fontWeight:600,color:"#0f172a",fontSize:"0.9rem"},children:y})})()}),c.includes("petugas")&&e.jsx("td",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:a.petugas}),c.includes("foto")&&e.jsx("td",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:a.foto?"pointer":"default"},onClick:()=>a.foto&&Z(a.foto),title:a.foto?"Klik untuk memperbesar":"Tidak ada foto",children:a.foto?e.jsx("img",{src:a.foto.startsWith("/")?`${Et}${a.foto}`:a.foto,alt:"Foto",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(Oe,{size:16})})}),c.includes("foto_rumah")&&e.jsx("td",{style:{width:"110px",minWidth:"110px",textAlign:"center"},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:a.foto_rumah?"pointer":"default"},onClick:()=>a.foto_rumah&&Z(a.foto_rumah),title:a.foto_rumah?"Klik untuk memperbesar":"Tidak ada foto",children:a.foto_rumah?e.jsx("img",{src:a.foto_rumah.startsWith("/")?`${Et}${a.foto_rumah}`:a.foto_rumah,alt:"Foto Rumah",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(Oe,{size:16})})}),c.includes("status_laporan")&&e.jsx("td",{style:{width:"140px",minWidth:"140px",textAlign:"center"},children:(()=>{const y=m.find(C=>C.kode_kondisi===a.status_laporan)?.status_kondisi||a.status_laporan,W=y==="Normal";return e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:600,backgroundColor:W?"#dcfce7":y?"#fee2e2":"#f1f5f9",color:W?"#166534":y?"#991b1b":"#64748b",display:"inline-block"},children:y||"-"})})()}),c.includes("koordinat")&&e.jsx("td",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:a.latitude&&a.longitude?e.jsx("a",{href:`https://www.google.com/maps?q=${a.latitude},${a.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",fontWeight:500,textDecoration:"underline",fontSize:"0.75rem"},title:"Buka di Google Maps",children:e.jsxs("span",{style:{letterSpacing:"-0.02em"},children:[a.latitude,", ",a.longitude]})}):"-"}),c.includes("update_date")&&e.jsx("td",{style:{width:"140px",minWidth:"140px",fontSize:"0.75rem",textAlign:"left"},children:a.update_date?.slice(0,10)}),!v&&e.jsx("td",{className:"no-print sticky-col-right",style:{width:"100px",minWidth:"100px",textAlign:"center",background:"inherit",padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px"},onClick:()=>Ue(a),title:"Edit",children:e.jsx(at,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px",color:"#ef4444"},onClick:()=>gt(a.id),title:"Hapus",children:e.jsx(Ut,{size:14})})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:c.length+2,style:{textAlign:"center",padding:"2rem",color:"var(--text-light)"},children:"Tidak ada data pencatatan ditemukan."})})})]})}),!V&&Ke.length>0&&e.jsxs("div",{className:"no-print",style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:["Menampilkan ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Rt+1})," sampai ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Math.min(rt,Ke.length)})," dari ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Ke.length})," pencatatan"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",marginBottom:0},children:"Baris per halaman:"}),e.jsx("select",{value:be,onChange:a=>se(Number(a.target.value)),style:{width:"auto",padding:"0.25rem 0.5rem",height:"auto"},children:[10,25,50,100].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:L===1,onClick:()=>ie(1),children:e.jsx(Jt,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:L===1,onClick:()=>ie(a=>Math.max(1,a-1)),children:e.jsx(et,{size:18})}),nt().map(a=>e.jsx("button",{className:`btn ${L===a?"btn-primary":"btn-outline"}`,style:{minWidth:"36px",height:"36px",padding:0,justifyContent:"center"},onClick:()=>ie(a),children:a},a)),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:L===Je,onClick:()=>ie(a=>Math.min(Je,a+1)),children:e.jsx(tt,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:L===Je,onClick:()=>ie(Je),children:e.jsx(Xt,{size:18})})]})]})]})]}),E&&e.jsx("div",{className:"modal-overlay",style:{animation:"fadeIn 0.2s",backgroundColor:"rgba(15, 23, 42, 0.75)",backdropFilter:"blur(4px)"},children:e.jsxs("div",{className:"modal-content",style:{animation:"slideUp 0.3s",maxWidth:"950px",borderRadius:"20px",padding:0,overflow:"hidden",maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",background:"white"},children:[e.jsxs("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:[M?"Edit":"Tambah"," Catatan Meter"]}),e.jsx("button",{onClick:He,style:{width:"36px",height:"36px",background:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer",color:"#64748b",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:e.jsx(ge,{size:20})})]}),e.jsxs("form",{onSubmit:ht,style:{padding:"2rem",overflowY:"auto",flex:1},children:[e.jsxs("div",{className:"modal-grid",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"form-group",style:{position:"relative"},ref:z,children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Pelanggan"}),e.jsxs("div",{onClick:()=>!M&&ke(!De),style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"0.95rem",background:M?"#f8fafc":"white",cursor:M?"not-allowed":"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"45px"},children:[e.jsx("span",{style:{color:s.id_pelanggan?"#1e293b":"#94a3b8"},children:s.id_pelanggan?`${s.id_sambungan} - ${s.nama}`:"Cari dan Pilih Pelanggan"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.id_pelanggan&&!M&&e.jsx("button",{onClick:a=>{a.stopPropagation(),N(d=>({...d,id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",kode_tarif:"",petugas:""})),oe([]),ke(!1)},style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:"#94a3b8",display:"flex",alignItems:"center",borderRadius:"50%"},onMouseEnter:a=>a.currentTarget.style.background="#f1f5f9",onMouseLeave:a=>a.currentTarget.style.background="none",title:"Hapus pilihan",children:e.jsx(ge,{size:16})}),!M&&e.jsx(Qe,{size:18,style:{color:"#94a3b8",transform:De?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),De&&e.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,zIndex:100,background:"white",border:"1px solid #e2e8f0",borderRadius:"10px",marginTop:"4px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",overflow:"hidden",animation:"fadeIn 0.1s ease-out"},children:[e.jsx("div",{style:{padding:"0.75rem",borderBottom:"1px solid #f1f5f9",background:"#f8fafc"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(qe,{size:14,style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Cari pelanggan (Nama / No. Sambungan)...",value:Ce,onChange:a=>o(a.target.value),onClick:a=>a.stopPropagation(),style:{width:"100%",padding:"0.5rem 0.75rem 0.5rem 2.25rem",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"0.875rem"}})]})}),e.jsxs("div",{style:{maxHeight:"250px",overflowY:"auto"},children:[P.filter(a=>(a.nama||"").toLowerCase().includes(Ce.toLowerCase())||(a.id_sambungan||"").toLowerCase().includes(Ce.toLowerCase())).map(a=>e.jsxs("div",{onClick:d=>{d.stopPropagation(),lt(a.id),ke(!1),o("")},style:{padding:"0.75rem 1rem",cursor:"pointer",fontSize:"0.875rem",borderBottom:"1px solid #f8fafc",background:s.id_pelanggan==a.id?"#f0f9ff":"white",color:s.id_pelanggan==a.id?"#0ea5e9":"#1e293b"},onMouseEnter:d=>d.currentTarget.style.background="#f8fafc",onMouseLeave:d=>d.currentTarget.style.background=s.id_pelanggan==a.id?"#f0f9ff":"white",children:[e.jsx("div",{style:{fontWeight:600},children:a.id_sambungan}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[a.nama," - ",a.alamat]})]},a.id)),P.filter(a=>(a.nama||"").toLowerCase().includes(Ce.toLowerCase())||(a.id_sambungan||"").toLowerCase().includes(Ce.toLowerCase())).length===0&&e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#94a3b8",fontSize:"0.875rem"},children:"Pelanggan tidak ditemukan"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Tanggal Pencatatan"}),e.jsxs("div",{style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f8fafc",display:"flex",alignItems:"center",gap:"0.5rem",color:"#64748b",fontSize:"0.875rem"},children:[e.jsx($t,{size:16}),e.jsx("span",{style:{fontWeight:600},children:M?new Date(s.tahun,s.bulan-1).toLocaleString("id-ID",{month:"long",year:"numeric"}):new Date().toLocaleString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Awal (Bulan Lalu)"}),e.jsxs("div",{style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",background:te.length>0?"#f0f9ff":"#fff1f2",display:"flex",alignItems:"center",gap:"0.5rem",color:te.length>0?"#0369a1":"#be123c",fontSize:"0.95rem",fontWeight:700},children:[e.jsx(ua,{size:16}),e.jsx("span",{children:te.length>0?te[0].stan_akhir:"Stan Awal Belum Tersedia"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Akhir"}),e.jsx("input",{type:"number",style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #e2e8f0"},value:s.stan_akhir,onChange:a=>N({...s,stan_akhir:a.target.value}),onBlur:()=>{s.stan_akhir&&Number(s.stan_akhir)!==0&&We&&!Q&&Le(We,s.stan_akhir)},placeholder:"0",autoComplete:"off"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Pemakaian (m)"}),e.jsxs("div",{style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f8fafc",display:"flex",alignItems:"center",gap:"0.5rem",color:s.stan_akhir&&Number(s.stan_akhir)!==0&&te.length>0&&Number(s.stan_akhir)-Number(te[0].stan_akhir)<0?"#ef4444":"#1e293b",fontSize:"0.95rem",fontWeight:800},children:[e.jsx(st,{size:16,color:s.stan_akhir&&Number(s.stan_akhir)!==0&&te.length>0&&Number(s.stan_akhir)-Number(te[0].stan_akhir)<0?"#ef4444":"#0ea5e9"}),e.jsx("span",{children:(()=>{const a=Number(s.stan_akhir);if(!s.stan_akhir||a===0)return"0 m";const d=te.length>0?Number(te[0].stan_akhir):0,y=a-d;return y+" m"+(y<0?" (Meter Mundur)":"")})()})]}),e.jsx("div",{style:{marginTop:"0.5rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:Se?e.jsxs("div",{style:{color:"#64748b",fontSize:"0.7rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("div",{className:"spinner-border spinner-border-sm",style:{width:"12px",height:"12px"}}),e.jsx("span",{children:"Menganalisa..."})]}):Q?e.jsx(e.Fragment,{children:Q.status==="ERROR"?e.jsxs("span",{className:"badge",style:{backgroundColor:"#fee2e2",color:"#991b1b",border:"1px solid #fecaca",fontSize:"0.7rem"},children:[" ",Q.message]}):e.jsx(e.Fragment,{children:e.jsx("span",{className:"badge",style:{backgroundColor:Q.status==="GREEN"?"#dcfce7":Q.status==="YELLOW"?"#fef9c3":"#fee2e2",color:Q.status==="GREEN"?"#166534":Q.status==="YELLOW"?"#854d0e":"#991b1b",fontSize:"0.75rem",padding:"0.25rem 0.75rem",border:"1px solid",borderColor:Q.status==="GREEN"?"#bbf7d0":Q.status==="YELLOW"?"#fef08a":"#fecaca"},children:Q.status==="GREEN"?" Match 100%":Q.status==="YELLOW"?` Match ${Q.similarity}%`:` Mismatch (${Q.similarity}%)`})})}):null})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-group",children:e.jsx(Fe,{label:"Petugas",value:s.petugas,onChange:a=>N({...s,petugas:a.target.value}),options:i.filter(a=>a.status_aktif==="Aktif").map(a=>({value:a.nama,label:a.cabang?`Cabang ${a.cabang}`:""})),placeholder:"Pilih Petugas",searchPlaceholder:"Cari petugas...",disabled:!!M})}),e.jsx("div",{className:"form-group",children:e.jsx(Fe,{label:"Status Laporan",value:s.status_laporan,onChange:a=>N({...s,status_laporan:a.target.value}),options:m.map(a=>({value:a.kode_kondisi,label:a.status_kondisi})),placeholder:"Pilih Status Laporan",searchPlaceholder:"Cari status laporan...",hideValue:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Latitude"}),e.jsx("input",{type:"text",style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0"},value:s.latitude,onChange:a=>N({...s,latitude:a.target.value}),placeholder:"Contoh: -6.123456"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Longitude"}),e.jsx("input",{type:"text",style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0"},value:s.longitude,onChange:a=>N({...s,longitude:a.target.value}),placeholder:"Contoh: 106.123456"})]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{background:"#f8fafc",borderRadius:"12px",padding:"1rem",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem",color:"#64748b",fontSize:"0.875rem",fontWeight:600},children:[e.jsx($t,{size:16})," History Pencatatan"]}),te.length>0?e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.75rem",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",padding:"0.5rem",borderBottom:"1px solid #e2e8f0",color:"#64748b"},children:"Bulan"}),e.jsx("th",{style:{textAlign:"right",padding:"0.5rem",borderBottom:"1px solid #e2e8f0",color:"#64748b"},children:"Stan Akhir"})]})}),e.jsx("tbody",{children:te.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{style:{padding:"0.5rem",borderBottom:"1px solid #e2e8f0"},children:[new Date(0,a.bulan-1).toLocaleString("id-ID",{month:"short"})," ",a.tahun]}),e.jsx("td",{style:{padding:"0.5rem",borderBottom:"1px solid #e2e8f0",textAlign:"right",fontWeight:600},children:a.stan_akhir})]},a.id))})]})}):e.jsx("div",{style:{textAlign:"center",padding:"1rem",color:"#ef4444",fontSize:"0.75rem",fontStyle:"italic",fontWeight:600},children:"Stan Awal Belum Tersedia"})]}),e.jsx("div",{style:{borderTop:"1px solid #e2e8f0",margin:"0.5rem 0"}}),e.jsx("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[{id:"foto",label:"FOTO METER",preview:$e},{id:"foto_rumah",label:"FOTO RUMAH",preview:Pe}].map(a=>e.jsx("div",{style:{textAlign:"center",flex:1},children:e.jsxs("div",{style:{width:"100%",aspectRatio:"4/3",border:M?"2px solid #e2e8f0":"2px dashed #e2e8f0",borderRadius:"12px",position:"relative",overflow:"hidden",background:M?"#f1f5f9":"#f8fafc",cursor:M?"default":"pointer",opacity:M?.8:1},children:[a.preview?e.jsx("img",{src:a.preview&&a.preview.startsWith("/")?`${Et}${a.preview}`:a.preview,style:{width:"100%",height:"100%",objectFit:"cover",filter:M?"grayscale(20%)":"none"},alt:"Preview"}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(Oe,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]}),!M&&e.jsx("input",{type:"file",onChange:d=>ut(d,a.id),style:{position:"absolute",inset:0,opacity:0,cursor:"pointer"}}),e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,background:"rgba(0,0,0,0.6)",color:"white",fontSize:"0.65rem",padding:"6px",fontWeight:600,textAlign:"center"},children:[a.label," ",M&&"(View Only)"]}),a.preview&&!M&&e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),dt(a.id)},style:{position:"absolute",top:"4px",right:"4px",zIndex:20,background:"#ef4444",border:"none",borderRadius:"6px",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:"pointer",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:"Hapus Foto",children:e.jsx(ge,{size:12,strokeWidth:3})})]})},a.id))}),H&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--primary)",textAlign:"center"},children:["Mengupload foto... (",Math.round(Ne),"%)"]})]})]}),e.jsxs("div",{style:{marginTop:"2.5rem",paddingTop:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{padding:"0.625rem 1.5rem",borderRadius:"8px",fontWeight:600},onClick:He,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{padding:"0.625rem 2rem",borderRadius:"8px",fontWeight:600,boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},disabled:H,children:H?"Memproses...":M?"Simpan Perubahan":"Simpan Data"})]})]})]})}),X&&e.jsx("div",{className:"lightbox-overlay",onClick:()=>Z(null),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem",animation:"fadeIn 0.2s"},children:e.jsxs("div",{style:{position:"relative",maxWidth:"90%",maxHeight:"90%"},onClick:a=>a.stopPropagation(),children:[e.jsx("button",{style:{position:"absolute",top:"-40px",right:0,background:"none",border:"none",color:"white",cursor:"pointer"},onClick:()=>Z(null),children:e.jsx(ge,{size:32})}),e.jsx("img",{src:X&&X.startsWith("/")?`${Et}${X}`:X,alt:"Preview",style:{maxWidth:"100%",maxHeight:"85vh",borderRadius:"8px",boxShadow:"0 20px 40px rgba(0,0,0,0.3)"}})]})}),e.jsxs("div",{className:"print-footer",children:[e.jsx("p",{style:{margin:"0 0 40px 0"},children:"Dicetak oleh,"}),e.jsx("div",{style:{borderBottom:"1px solid black",width:"200px",margin:"0 auto 10px auto"}}),e.jsx("p",{children:localStorage.getItem("username")||"Admin"})]})]})}const Dt="./api/officers.php",oa="http://localhost",pt=[{id:"id",label:"ID"},{id:"nik",label:"NIK"},{id:"ktp",label:"NO. KTP"},{id:"kode_cabang",label:"CABANG"},{id:"kode_rute",label:"RUTE"},{id:"nama",label:"NAMA PETUGAS"},{id:"foto_petugas",label:"FOTO"},{id:"alamat",label:"ALAMAT"},{id:"telepon",label:"NO. TELEPON"},{id:"tgl_masuk",label:"TGL MASUK"},{id:"tgl_keluar",label:"TGL KELUAR"},{id:"status_aktif",label:"STATUS"},{id:"update_date",label:"LAST UPDATE"}],la=["id","nik","ktp","foto_petugas","kode_cabang","nama","telepon","status_aktif"];function La(){const[v,G]=r.useState([]),[S,D]=r.useState([]),[k,P]=r.useState(""),[_,V]=r.useState(!1),[O,q]=r.useState(!1),[J,E]=r.useState(null),[A,M]=r.useState(null),[u,l]=r.useState({nik:"",nama:"",alamat:"",telepon:"",ktp:"",tgl_masuk:"",tgl_keluar:"",kode_cabang:"",kode_rute:[],foto_petugas:"",status_aktif:"Aktif"}),[x,b]=r.useState([]),[de,ne]=r.useState([]),[xe,c]=r.useState(!1),[I,L]=r.useState(""),[ie,be]=r.useState(!1),[se,Ie]=r.useState(!1),[ze,$e]=r.useState("nama"),[ue,Pe]=r.useState(()=>{const i=localStorage.getItem("pdam_visible_columns_officers_v2");return i?JSON.parse(i):la}),[w,X]=r.useState(1),[Z,H]=r.useState(10),fe=r.useRef(null),Ne=r.useRef(null);r.useEffect(()=>{Se();const i=h=>{fe.current&&!fe.current.contains(h.target)&&be(!1),Ne.current&&!Ne.current.contains(h.target)&&Ie(!1)};return document.addEventListener("mousedown",i),ye(),()=>document.removeEventListener("mousedown",i)},[]),r.useEffect(()=>{u.kode_cabang?We(u.kode_cabang):ne([])},[u.kode_cabang]);const ye=async()=>{try{const h=await(await fetch("./api/options.php?type=cabang")).json();b(Array.isArray(h)?h:[])}catch(i){console.error("Failed to fetch branches:",i)}},We=async i=>{try{const ee=(await(await fetch(`./api/branch_routes.php?kode_cabang=${i}`)).json()).filter(ae=>ae.assigned).map(ae=>({kode_rute:ae.kode_rute,rute:ae.rute}));ne(Array.isArray(ee)?ee:[])}catch(h){console.error("Failed to fetch routes:",h)}};r.useEffect(()=>{const i=k.toLowerCase(),h=v.filter(m=>k?ze==="nama"?m.nama&&m.nama.toLowerCase().includes(i):ze==="nik"?m.nik&&String(m.nik).includes(i):ze==="alamat"?m.alamat&&m.alamat.toLowerCase().includes(i):!1:!0);D(h),X(1)},[k,v,ze]);const[je,Me]=r.useState(!1),[_e,Q]=r.useState(0),ce=i=>{const h=i.target.files[0];if(h){if(h.size>2*1024*1024){me.fire("Error","Ukuran foto maksimal 2MB","error");return}Me(!0),Q(0);const m=new FileReader;let ee=0;const ae=setInterval(()=>{ee+=Math.random()*30,ee>=100&&(ee=100,clearInterval(ae),m.onloadend=()=>{l(pe=>({...pe,foto_petugas:m.result})),E(pe=>({...pe,selectedFile:h})),setTimeout(()=>{Me(!1),Q(0)},500)},m.readAsDataURL(h)),Q(ee)},100)}},Se=async()=>{try{V(!0);const h=await(await fetch(Dt)).json();G(Array.isArray(h)?h:[])}catch(i){console.error("Failed to fetch officers:",i),me.fire("Error","Gagal memuat data petugas","error")}finally{V(!1)}},U=(i=null)=>{i?(E(i),l({nik:i.nik||"",nama:i.nama||"",alamat:i.alamat||"",telepon:i.telepon||"",ktp:i.ktp||"",tgl_masuk:i.tgl_masuk||"",tgl_keluar:i.tgl_keluar||"",kode_cabang:i.kode_cabang||"",kode_rute:Array.isArray(i.kode_rute)?i.kode_rute:i.kode_rute?[i.kode_rute]:[],foto_petugas:i.foto_petugas||"",status_aktif:i.status_aktif||"Aktif"})):(E(null),l({nik:"",nama:"",alamat:"",telepon:"",ktp:"",tgl_masuk:new Date().toISOString().split("T")[0],tgl_keluar:"",kode_cabang:"",kode_rute:[],foto_petugas:"",status_aktif:"Aktif"})),q(!0)},Ye=()=>{q(!1),E(null)},Be=async i=>{i.preventDefault();const h=new FormData;h.append("nik",u.nik),h.append("nama",u.nama),h.append("alamat",u.alamat),h.append("telepon",u.telepon),h.append("ktp",u.ktp),h.append("tgl_masuk",u.tgl_masuk),h.append("tgl_keluar",u.tgl_keluar),h.append("kode_cabang",u.kode_cabang),h.append("kode_rute",u.kode_rute),h.append("status_aktif",u.status_aktif),J?.selectedFile?h.append("foto_petugas",J.selectedFile):h.append("foto_petugas",u.foto_petugas||"");const m=J&&J.id?`${Dt}?id=${J.id}`:Dt;try{V(!0);const ae=await(await fetch(m,{method:"POST",body:h})).json();if(ae.message)me.fire("Sukses",J?"Data petugas diperbarui":"Data petugas ditambahkan","success"),q(!1),Se();else throw new Error(ae.error||"Gagal menyimpan")}catch(ee){console.error(ee),me.fire("Error","Gagal menyimpan data petugas","error")}finally{V(!1)}},De=async i=>{if((await me.fire({title:"Hapus Petugas?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal",confirmButtonColor:"#ef4444"})).isConfirmed)try{const ee=await(await fetch(`${Dt}?id=${i}`,{method:"DELETE"})).json();if(ee.message)me.fire("Terhapus!","Data petugas telah dihapus.","success"),Se();else throw new Error(ee.error)}catch(m){me.fire("Gagal!",m.message,"error")}},ke=()=>{const i=pt.filter(he=>ue.includes(he.id)&&he.id!=="foto_petugas"),h=i.map(he=>he.label),m=S.map(he=>i.map(Le=>he[Le.id]||"-")),ee=[h,...m].map(he=>he.map(Le=>`"${Le}"`).join(",")).join(`
`),ae=new Blob([ee],{type:"text/csv;charset=utf-8;"}),pe=URL.createObjectURL(ae),R=document.createElement("a");R.setAttribute("href",pe),R.setAttribute("download",`data_petugas_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(R),R.click(),document.body.removeChild(R)},Ce=()=>{const i=pt.filter(ae=>ue.includes(ae.id)&&ae.id!=="foto_petugas"),h=S.map(ae=>{const pe={};return i.forEach(R=>{pe[R.label]=ae[R.id]||"-"}),pe}),m=Ee.json_to_sheet(h),ee=Ee.book_new();Ee.book_append_sheet(ee,m,"Petugas"),zt(ee,`data_petugas_${new Date().toISOString().split("T")[0]}.xlsx`)},o=()=>{const i=new Ct("l","mm","a4"),h=new Date().toLocaleString("id-ID"),m=pt.filter(pe=>ue.includes(pe.id)&&pe.id!=="foto_petugas");i.setFontSize(18),i.setTextColor(14,165,233),i.text("Laporan Data Petugas PDAM",14,15),i.setFontSize(10),i.setTextColor(100),i.text(`Jumlah Total: ${S.length} Petugas`,14,22),i.text(`Waktu Cetak: ${h}`,280,22,{align:"right"});const ee=["No",...m.map(pe=>pe.label)],ae=S.map((pe,R)=>[R+1,...m.map(he=>pe[he.id]||"-")]);At(i,{startY:28,head:[ee],body:ae,theme:"grid",headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"},styles:{fontSize:8}}),i.save(`data_petugas_${new Date().toISOString().split("T")[0]}.pdf`)},z=()=>{window.print()},s=w*Z,N=s-Z,te=S.slice(N,s),oe=Math.ceil(S.length/Z);return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .customer-table {
                        width: 100%;
                        border-collapse: separate; /* Recommended for sticky headers */
                        border-spacing: 0;
                    }
                    .customer-table thead th {
                        position: sticky; top: 0; z-index: 30; background: #f8fafc !important; 
                        box-shadow: inset 0 -2px 0 var(--border);
                        text-transform: uppercase;
                        font-size: 0.7rem; font-weight: 700; letter-spacing: 0.05em; color: #64748b; 
                        padding: 1rem 1.25rem !important;
                        white-space: nowrap;
                    }
                    .customer-table tbody tr:nth-of-type(even) td {
                        background-color: #fafbfc;
                    }
                    .customer-table tbody tr:hover td {
                        background-color: #eff6ff !important;
                    }
                    .customer-table td, .customer-table th {
                        padding: 0.875rem 1.25rem !important;
                        vertical-align: middle;
                        font-size: 0.875rem;
                        color: #334155;
                    }
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left,
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #fafbfc !important;
                    }
                    .badge {
                        padding: 0.25rem 0.75rem;
                        border-radius: 9999px;
                        font-size: 0.75rem;
                        font-weight: 600;
                    }
                    .badge-active {
                        background-color: #dcfce7;
                        color: #166534;
                    }
                    .badge-inactive {
                        background-color: #fee2e2;
                        color: #991b1b;
                    }

                    @media print {
                        .no-print, .no-print * {
                            display: none !important;
                        }
                        
                        body {
                            background: white !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .card {
                            box-shadow: none !important;
                            border: none !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .table-container {
                            overflow: visible !important;
                            max-height: none !important;
                            width: 100% !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }

                        .customer-table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            table-Layout: auto !important;
                            font-size: 8pt !important;
                        }

                        .customer-table th, .customer-table td {
                            border: 1px solid #e2e8f0 !important;
                            padding: 4pt !important;
                            overflow: visible !important;
                            white-space: normal !important;
                            word-break: break-word !important;
                            min-width: 0 !important;
                            width: auto !important;
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        .sticky-col-left {
                            position: static !important;
                            background: transparent !important;
                            box-shadow: none !important;
                        }

                        @page {
                            size: landscape;
                            margin: 1cm;
                        }

                        header.header {
                            margin-bottom: 1rem !important;
                        }

                        h1 {
                            font-size: 16pt !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{background:"rgba(14, 165, 233, 0.1)",padding:"0.625rem",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Zt,{size:32,color:"var(--primary)"})}),"Data Petugas"]}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.95rem",marginTop:"0.25rem"},children:"Kelola daftar petugas pencatat meter lapangan"})]}),e.jsxs("div",{className:"header-actions no-print",style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-outline",onClick:ke,title:"Export CSV",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:Ce,title:"Export Excel",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:o,title:"Export PDF",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:z,title:"Print",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(_t,{size:18})})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>U(),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:600,whiteSpace:"nowrap",boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:[e.jsx(ot,{size:20}),e.jsx("span",{className:"hide-mobile",children:"Tambah Petugas"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flex:1,minWidth:"300px"},children:[e.jsxs("div",{style:{position:"relative"},ref:fe,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>be(!ie),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",background:ie?"#f1f5f9":"#f8fafc",border:`1px solid ${ie?"var(--primary)":"var(--border)"}`,color:ie?"var(--primary)":"var(--text)",borderRadius:"8px",fontWeight:600},children:[e.jsx(St,{size:18}),e.jsx("span",{children:"Pilih Kolom"})]}),ie&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px",maxHeight:"400px",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem",flexShrink:0},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"0.25rem",overflowY:"auto"},children:pt.map(i=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",padding:"0.5rem 0.75rem",fontSize:"0.875rem",borderRadius:"6px"},onMouseEnter:h=>h.currentTarget.style.background="#f8fafc",onMouseLeave:h=>h.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",style:{width:"16px",height:"16px",accentColor:"var(--primary)"},checked:ue.includes(i.id),onChange:()=>Pe(h=>h.includes(i.id)?h.filter(m=>m!==i.id):[...h,i.id])}),e.jsx("span",{style:{color:ue.includes(i.id)?"var(--text)":"var(--text-light)",fontWeight:ue.includes(i.id)?500:400},children:i.label})]},i.id))}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",gap:"1rem",flexShrink:0},children:[e.jsx("button",{style:{background:"none",border:"none",color:"var(--primary)",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>Pe(pt.map(i=>i.id)),onMouseEnter:i=>i.currentTarget.style.background="rgba(14, 165, 233, 0.05)",onMouseLeave:i=>i.currentTarget.style.background="none",children:"Pilih Semua"}),e.jsx("button",{style:{background:"none",border:"none",color:"#64748b",fontSize:"0.75rem",fontWeight:700,cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},onClick:()=>Pe(la),onMouseEnter:i=>i.currentTarget.style.background="#f1f5f9",onMouseLeave:i=>i.currentTarget.style.background="none",children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:Ne,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>Ie(!se),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",background:se?"#f1f5f9":"#f8fafc",border:`1px solid ${se?"var(--primary)":"var(--border)"}`,color:se?"var(--primary)":"var(--text)",borderRadius:"8px",minWidth:"100px",fontWeight:600},children:[e.jsx("span",{children:"Filter"}),e.jsx(Qe,{size:16})]}),se&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px"},children:[{id:"nama",label:"By Nama"},{id:"nik",label:"By NIK"},{id:"alamat",label:"By Alamat"},{id:"kode_cabang",label:"By Cabang"},{id:"kode_rute",label:"By Rute"},{id:"telepon",label:"By No. Telepon"},{id:"tgl_masuk",label:"By Tanggal Masuk"},{id:"tgl_keluar",label:"By Tanggal Keluar"},{id:"status_aktif",label:"By Status"}].map(i=>e.jsx("button",{onClick:()=>{$e(i.id),Ie(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:ze===i.id?"#f1f5f9":"none",color:ze===i.id?"var(--primary)":"var(--text)",borderRadius:"8px",cursor:"pointer"},children:i.label},i.id))})]}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(qe,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:k?"2.5rem":"0.625rem",height:"42px",borderRadius:"8px",border:"1px solid var(--border)",background:"#f8fafc",width:"100%"},placeholder:`Cari ${ze==="nama"?"Nama":ze==="nik"?"NIK":"Alamat"}...`,value:k,onChange:i=>P(i.target.value)}),k&&e.jsx("button",{onClick:()=>P(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ge,{size:16})})]})]}),!_&&S.length>0&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{height:"32px",width:"32px",padding:0,borderRadius:"6px"},disabled:w===1,onClick:()=>X(i=>Math.max(1,i-1)),children:e.jsx(et,{size:16})}),e.jsxs("span",{style:{fontSize:"0.875rem"},children:["Halaman ",e.jsx("strong",{children:w})," dari ",oe]}),e.jsx("button",{className:"btn btn-outline",style:{height:"32px",width:"32px",padding:0,borderRadius:"6px"},disabled:w===oe,onClick:()=>X(i=>Math.min(oe,i+1)),children:e.jsx(tt,{size:16})})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto",margin:"1rem -1rem 0",width:"calc(100% + 2rem)"},children:e.jsxs("table",{className:"customer-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"60px",textAlign:"center"},children:"NO"}),ue.map(i=>{const h=pt.find(ee=>ee.id===i);if(!h)return null;let m={padding:"0.625rem 0.75rem",whiteSpace:"nowrap",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em",background:"#f8fafc"};switch(i){case"id":m={...m,minWidth:"60px",textAlign:"center"};break;case"nik":m={...m,minWidth:"110px",textAlign:"left"};break;case"ktp":m={...m,minWidth:"130px",textAlign:"left"};break;case"kode_cabang":m={...m,minWidth:"80px",textAlign:"center"};break;case"kode_rute":m={...m,minWidth:"80px",textAlign:"center"};break;case"nama":m={...m,minWidth:"220px",textAlign:"left"};break;case"foto_petugas":m={...m,minWidth:"80px",textAlign:"center"};break;case"alamat":m={...m,minWidth:"280px",textAlign:"left"};break;case"telepon":m={...m,minWidth:"120px",textAlign:"left"};break;case"tgl_masuk":case"tgl_keluar":m={...m,minWidth:"110px",textAlign:"center"};break;case"status_aktif":m={...m,minWidth:"100px",textAlign:"center"};break;case"update_date":m={...m,minWidth:"150px",textAlign:"left"};break;default:m={...m,minWidth:"150px",textAlign:"left"}}return e.jsx("th",{style:m,children:h.label},i)}),e.jsx("th",{className:"no-print sticky-col-right",style:{width:"100px",textAlign:"center",background:"#f8fafc",fontSize:"0.8rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.05em"},children:"AKSI"})]})}),e.jsx("tbody",{children:_?e.jsx("tr",{children:e.jsx("td",{colSpan:ue.length+2,style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Memuat data..."})}):te.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:ue.length+2,style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:"Tidak ada data ditemukan"})}):te.map((i,h)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{textAlign:"center",fontWeight:500,color:"#64748b",padding:"12px 16px"},children:h+1+(w-1)*Z}),ue.map(m=>{const ee="12px 16px";if(m==="status_aktif")return e.jsx("td",{style:{textAlign:"center",padding:ee},children:e.jsx("span",{className:`badge ${i.status_aktif==="Aktif"?"badge-active":"badge-inactive"}`,children:i[m]||"-"})},m);if(m==="foto_petugas")return e.jsx("td",{style:{width:"80px",textAlign:"center",padding:ee},children:e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"6px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",border:"1px solid #e2e8f0",color:"#94a3b8",overflow:"hidden",cursor:i.foto_petugas?"pointer":"default"},onClick:()=>i.foto_petugas&&M(i.foto_petugas),title:i.foto_petugas?"Klik untuk memperbesar":"Tidak ada foto",children:i.foto_petugas?e.jsx("img",{src:i.foto_petugas&&i.foto_petugas.startsWith("/")?`${oa}${i.foto_petugas}`:i.foto_petugas,alt:"Foto",style:{width:"100%",height:"100%",objectFit:"cover"},onError:pe=>{pe.target.onerror=null,pe.target.style.display="none",pe.target.parentElement.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;width:100%"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-camera"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg></div>'}}):e.jsx(Oe,{size:16})})},m);const ae=["id","kode_cabang","kode_rute","tgl_masuk","tgl_keluar"].includes(m);return e.jsx("td",{style:{textAlign:ae?"center":"left",padding:ee,fontWeight:m==="nama"?600:400,color:m==="nama"?"#334155":"inherit"},children:m==="kode_rute"?Array.isArray(i[m])&&i[m].length>0?i[m].length>1?`${i[m][0]},`:i[m][0]:e.jsx("span",{style:{color:"#94a3b8",fontStyle:"italic",fontSize:"0.8rem"},children:"Belum ada Rute"}):i[m]||"-"},m)}),e.jsx("td",{className:"no-print sticky-col-right",style:{textAlign:"center",background:"inherit",padding:"0.625rem 0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.35rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px"},onClick:()=>U(i),title:"Edit",children:e.jsx(at,{size:14})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.25rem",width:"28px",height:"28px",borderRadius:"6px",color:"#ef4444"},onClick:()=>De(i.id),title:"Hapus",children:e.jsx(Ut,{size:14})})]})})]},i.id))})]})})]}),A&&e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:2e3,background:"rgba(0,0,0,0.9)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"zoom-out"},onClick:()=>M(null),children:[e.jsx("img",{src:A&&A.startsWith("/")?`${oa}${A}`:A,alt:"Full Preview",style:{maxWidth:"90%",maxHeight:"90vh",objectFit:"contain",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}}),e.jsx("button",{style:{position:"absolute",top:"2rem",right:"2rem",background:"white",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onClick:()=>M(null),children:e.jsx(ge,{size:24,color:"#000"})})]}),O&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"white",borderRadius:"20px",width:"100%",maxWidth:"800px",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,background:"white",zIndex:10},children:[e.jsxs("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#0f172a",display:"flex",alignItems:"center",gap:"0.75rem"},children:[J?e.jsx(at,{size:24,color:"var(--primary)"}):e.jsx(ot,{size:24,color:"var(--primary)"}),J?"Edit Petugas":"Tambah Petugas"]}),e.jsx("button",{onClick:Ye,style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s"},onMouseEnter:i=>i.currentTarget.style.color="#64748b",onMouseLeave:i=>i.currentTarget.style.color="#94a3b8",children:e.jsx(ge,{size:24})})]}),e.jsxs("form",{onSubmit:Be,style:{padding:"2rem"},children:[e.jsxs("div",{className:"grid-6-col-responsive",children:[e.jsx("div",{className:"form-group",style:{gridColumn:"span 6"},children:e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"0.5rem"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{width:"180px",height:"140px",border:"2px dashed #cbd5e1",borderRadius:"16px",padding:"0",background:"#f8fafc",transition:"all 0.3s",cursor:"pointer",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},onClick:()=>document.getElementById("foto-upload").click(),onMouseEnter:i=>{i.currentTarget.style.borderColor="var(--primary)",i.currentTarget.style.background="#f1f5f9"},onMouseLeave:i=>{i.currentTarget.style.borderColor="#cbd5e1",i.currentTarget.style.background="#f8fafc"},children:[e.jsx("input",{id:"foto-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:i=>ce(i)}),u.foto_petugas?e.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[e.jsx("img",{src:u.foto_petugas,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.5), transparent)",display:"flex",alignItems:"flex-end",justifyContent:"center",padding:"1rem"},children:e.jsxs("span",{style:{color:"white",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Oe,{size:16})," Ganti Foto"]})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(Oe,{size:32}),e.jsx("span",{style:{fontSize:"0.75rem",marginTop:"0.5rem",fontWeight:500},children:"Ambil Foto"})]}),je&&e.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(255,255,255,0.8)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:10},children:[e.jsx("div",{style:{width:"48px",height:"48px",border:"4px solid #e2e8f0",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"}}),e.jsxs("span",{style:{fontWeight:600,color:"var(--primary)"},children:["Mengupload... ",Math.round(_e),"%"]})]})]}),e.jsx("div",{style:{background:"rgba(30, 41, 59, 0.7)",color:"white",fontSize:"0.65rem",padding:"6px",fontWeight:600,letterSpacing:"0.025em",borderBottomLeftRadius:"12px",borderBottomRightRadius:"12px",marginTop:"-24px",position:"relative",zIndex:5,width:"180px",marginInline:"auto"},children:"FOTO PETUGAS"})]})})}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"NIK"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"NIK Petugas",value:u.nik,onChange:i=>l({...u,nik:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 4"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Nama Lengkap"}),e.jsx("input",{type:"text",required:!0,className:"input-field",placeholder:"Nama Petugas",value:u.nama,onChange:i=>l({...u,nama:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 6"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Alamat"}),e.jsx("textarea",{rows:"2",className:"input-field",placeholder:"Alamat Lengkap",value:u.alamat,onChange:i=>l({...u,alamat:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"No. Telepon"}),e.jsx("input",{type:"text",className:"input-field",placeholder:"08xxx",value:u.telepon,onChange:i=>l({...u,telepon:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"No. KTP"}),e.jsx("input",{type:"text",className:"input-field",placeholder:"Nomor KTP",value:u.ktp,onChange:i=>l({...u,ktp:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Status Aktif"}),e.jsxs("select",{className:"input-field",value:u.status_aktif,onChange:i=>l({...u,status_aktif:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[e.jsx("option",{value:"Aktif",children:"Aktif"}),e.jsx("option",{value:"Tidak Aktif",children:"Tidak Aktif"})]})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 3"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Tanggal Masuk"}),e.jsx("input",{type:"date",className:"input-field",value:u.tgl_masuk,onChange:i=>l({...u,tgl_masuk:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 3"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Tanggal Keluar"}),e.jsx("input",{type:"date",className:"input-field",value:u.tgl_keluar,onChange:i=>l({...u,tgl_keluar:i.target.value}),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0"}})]}),e.jsxs("div",{style:{display:"contents"},children:[e.jsx(Fe,{label:"Cabang",containerStyle:{gridColumn:"span 3",marginBottom:0},options:x.map(i=>({value:i.kode_cabang,label:i.cabang})),value:u.kode_cabang,onChange:i=>l({...u,kode_cabang:i.target.value,kode_rute:[]}),placeholder:"Pilih Cabang",searchPlaceholder:"Cari cabang...",required:!0}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 3",marginBottom:0},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600,color:"#64748b"},children:"Rute yang Ditangani"}),e.jsxs("button",{type:"button",disabled:!u.kode_cabang,onClick:()=>c(!0),style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid #e2e8f0",background:u.kode_cabang?"white":"#f8fafc",textAlign:"left",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:u.kode_cabang?"pointer":"not-allowed",color:u.kode_cabang?"#334155":"#94a3b8"},children:[e.jsx("span",{children:u.kode_rute.length>0?`${u.kode_rute.length} Rute Dipilih`:u.kode_cabang?"Pilih Rute":"Pilih Cabang Dahulu"}),e.jsx(qt,{size:18})]})]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem",marginTop:"2rem"},children:[e.jsx("button",{type:"button",onClick:Ye,className:"btn btn-outline",style:{padding:"0.625rem 1.5rem",borderRadius:"8px",fontWeight:600},children:"Batal"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 2rem",borderRadius:"8px",fontWeight:600,boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:[e.jsx(Aa,{size:18})," Simpan"]})]})]})]})}),xe&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(15, 23, 42, 0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[e.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:700,color:"#0f172a"},children:"Pilih Rute"}),e.jsx("button",{onClick:()=>c(!1),style:{background:"none",border:"none",color:"#94a3b8",cursor:"pointer"},children:e.jsx(ge,{size:24})})]}),e.jsxs("div",{style:{padding:"1rem 1.5rem",borderBottom:"1px solid #f1f5f9",background:"#f8fafc"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(qe,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{autoFocus:!0,placeholder:"Ketik untuk mencari rute...",value:I,onChange:i=>L(i.target.value),style:{paddingLeft:"2.5rem",paddingRight:I?"2.5rem":"1rem",height:"44px",borderRadius:"8px",border:"2px solid var(--primary)",width:"100%",fontSize:"0.95rem",boxShadow:"0 0 0 3px rgba(14, 165, 233, 0.1)"}}),I&&e.jsx("button",{onClick:()=>L(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"#e2e8f0",border:"none",borderRadius:"50%",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#64748b",transition:"all 0.2s"},onMouseEnter:i=>{i.currentTarget.style.background="#cbd5e1",i.currentTarget.style.color="#334155"},onMouseLeave:i=>{i.currentTarget.style.background="#e2e8f0",i.currentTarget.style.color="#64748b"},title:"Clear search",children:e.jsx(ge,{size:14})})]}),e.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.875rem",color:"#64748b",fontWeight:500},children:[u.kode_rute.length," dari ",de.length," rute dipilih"]})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem 1.5rem"},children:de.length===0?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#94a3b8"},children:"Tidak ada rute tersedia untuk cabang ini"}):e.jsx("div",{style:{display:"grid",gap:"0.5rem"},children:de.filter(i=>i.kode_rute.toLowerCase().includes(I.toLowerCase())||i.rute.toLowerCase().includes(I.toLowerCase())).map(i=>e.jsxs("label",{className:`route-checkbox-item ${u.kode_rute.includes(i.kode_rute)?"selected":""}`,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:u.kode_rute.includes(i.kode_rute),onChange:()=>{l(h=>({...h,kode_rute:h.kode_rute.includes(i.kode_rute)?h.kode_rute.filter(m=>m!==i.kode_rute):[...h.kode_rute,i.kode_rute]}))},style:{width:"18px",height:"18px",accentColor:"var(--primary)",cursor:"pointer"}}),e.jsxs("div",{style:{flex:1,pointerEvents:"none"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem",color:"#0f172a"},children:i.kode_rute}),e.jsx("div",{style:{fontSize:"0.8125rem",color:"#64748b"},children:i.rute})]})]},i.kode_rute))})}),e.jsx("div",{style:{padding:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",gap:"1rem",justifyContent:"flex-end"},children:e.jsx("button",{onClick:()=>c(!1),className:"btn btn-primary",style:{padding:"0.625rem 2rem",borderRadius:"8px",fontWeight:600,boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:"Selesai"})})]})}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .route-checkbox-item {
                    background: white;
                    transition: background-color 0.15s ease;
                }
                .route-checkbox-item:hover {
                    background: #f8fafc;
                }
                .route-checkbox-item.selected {
                    background: #f0f9ff;
                }
                .route-checkbox-item.selected:hover {
                    background: #e0f2fe;
                }
            `}})]})}function Pa(){const[v,G]=r.useState([]),[S,D]=r.useState([]),[k,P]=r.useState([]),[_,V]=r.useState(!1),[O,q]=r.useState(""),[J,E]=r.useState("");r.useEffect(()=>{A()},[]);const A=async()=>{try{const x=await(await fetch("./api/options.php?type=cabang")).json();G(Array.isArray(x)?x:[])}catch(l){console.error("Failed to fetch branches:",l)}},M=async l=>{if(!l){D([]);return}try{const b=await(await fetch(`./api/officers.php?branch_code=${l}`)).json();D(Array.isArray(b)?b:[])}catch(x){console.error("Failed to fetch officers:",x)}},u=async l=>{if(!l){P([]);return}V(!0);try{const b=await(await fetch(`./api/customers.php?officer_id=${l}`)).json(),de=Array.isArray(b)?b:[];P(de)}catch(x){console.error("Failed to fetch customers:",x),me.fire("Error","Gagal memuat data pelanggan","error")}finally{V(!1)}};return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out",minHeight:"100%",display:"flex",flexDirection:"column"},children:[e.jsx("header",{className:"header",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{background:"rgba(14, 165, 233, 0.1)",padding:"0.625rem",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(za,{size:32,color:"var(--primary)"})}),"Pemetaan Tugas"]}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.95rem",marginTop:"0.25rem"},children:"Daftar wilayah tugas petugas"})]})}),e.jsxs("div",{className:"card",style:{flex:1,display:"flex",flexDirection:"column",padding:"1.5rem",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"1.5rem",flexWrap:"wrap",alignItems:"center",background:"#f8fafc",padding:"1.25rem",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[e.jsx(Fe,{label:"PILIH CABANG",placeholder:"-- Pilih Cabang --",icon:Ft,options:v.map(l=>({value:l.kode_cabang,label:l.cabang})),value:O,onChange:l=>{const x=l.target.value;q(x),E(""),M(x),P([])},containerStyle:{flex:"0 0 280px",marginBottom:0},hideValue:!0}),e.jsx(Fe,{label:"PILIH PETUGAS",placeholder:O?"-- Pilih Petugas --":"Pilih cabang dahulu",icon:Zt,options:S.map(l=>({value:String(l.id),label:l.nama})),value:J,disabled:!O,onChange:l=>{const x=l.target.value;E(x),u(x)},containerStyle:{flex:"0 0 320px",marginBottom:0},hideValue:!0}),_&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--primary)",fontWeight:600,fontSize:"0.875rem",marginLeft:"1rem"},children:[e.jsx(Yt,{size:16,className:"spin"}),e.jsx("span",{children:"Memproses..."})]}),!_&&J&&e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsxs("button",{onClick:()=>u(J),title:"Perbarui Data",style:{display:"flex",alignItems:"center",gap:"0.5rem",background:"white",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem 0.75rem",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem",fontWeight:600,transition:"all 0.2s"},onMouseEnter:l=>{l.currentTarget.style.background="#f0f9ff",l.currentTarget.style.borderColor="var(--primary)"},onMouseLeave:l=>{l.currentTarget.style.background="white",l.currentTarget.style.borderColor="#e2e8f0"},children:[e.jsx(Yt,{size:14}),"Refresh Data"]}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"#64748b",background:"white",padding:"0.5rem 1rem",borderRadius:"8px",border:"1px solid #e2e8f0"},children:["Total: ",e.jsx("strong",{style:{color:"var(--primary)",fontSize:"1rem"},children:k.length})," Pelanggan"]})]})]}),e.jsx("div",{className:"table-container",style:{flex:1,overflow:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f1f5f9"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:600,color:"#475569"},children:"NO"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:600,color:"#475569"},children:"RUTE"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:600,color:"#475569"},children:"NO. SAMBUNGAN"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:600,color:"#475569"},children:"NAMA PELANGGAN"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontSize:"0.875rem",fontWeight:600,color:"#475569"},children:"ALAMAT"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontSize:"0.875rem",fontWeight:600,color:"#475569"},children:"KOORDINAT"})]})}),e.jsx("tbody",{children:k.length>0?k.map((l,x)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.75rem 1rem",fontSize:"0.875rem",color:"#64748b"},children:x+1}),e.jsx("td",{style:{padding:"0.75rem 1rem",fontSize:"0.875rem",fontWeight:500},children:l.kode_rute}),e.jsx("td",{style:{padding:"0.75rem 1rem",fontSize:"0.875rem",fontWeight:500},children:l.id_sambungan}),e.jsx("td",{style:{padding:"0.75rem 1rem",fontSize:"0.875rem",fontWeight:600,color:"#0f172a"},children:l.nama}),e.jsx("td",{style:{padding:"0.75rem 1rem",fontSize:"0.875rem",color:"#64748b"},children:l.alamat||"-"}),e.jsx("td",{style:{padding:"0.75rem 1rem",textAlign:"center"},children:l.latitude&&l.longitude?e.jsxs("a",{href:`https://www.google.com/maps?q=${l.latitude},${l.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",display:"inline-flex",alignItems:"center",gap:"0.25rem",textDecoration:"none",fontSize:"0.8rem",fontWeight:500},children:[e.jsx(Ra,{size:14})," Lihat"]}):e.jsx("span",{style:{color:"#94a3b8",fontSize:"0.8rem"},children:"-"})})]},x)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:J?"Tidak ada data pelanggan untuk petugas ini.":"Silakan pilih cabang dan petugas terlebih dahulu."})})})]})})]}),e.jsx("style",{children:`
                    .spin { animation: spin 1s linear infinite; }
                    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                `})]})}const da="./api/recordings.php",Oa="./api/customers.php",mt="http://localhost",Vt=[{id:"id_sambungan",label:"NO. SAMBUNGAN"},{id:"id_meter",label:"ID METER"},{id:"id_tag",label:"ID TAG"},{id:"nama",label:"NAMA"},{id:"alamat",label:"ALAMAT"},{id:"kode_tarif",label:"TARIF"},{id:"stan_akhir",label:"STAND AKHIR"},{id:"stan_awal",label:"STAN AWAL"},{id:"koordinat",label:"KOORDINAT"},{id:"PEMAKAIAN (m)",label:"PEMAKAIAN (m)"},{id:"hasil_analisa",label:"HASIL ANALISA"},{id:"ai_ocr_status",label:"STATUS OCR"},{id:"status_laporan",label:"KONDISI METER"},{id:"tgl_verifikasi",label:"TGL VERIFIKASI"}],ca=["id_sambungan","id_meter","id_tag","nama","alamat","kode_tarif","stan_akhir","stan_awal","PEMAKAIAN (m)","ai_ocr_status","hasil_analisa","status_laporan","tgl_verifikasi"];function pa({ocrStatusFilter:v}){const[G,S]=r.useState([]),[D,k]=r.useState([]),[P,_]=r.useState([]),[V,O]=r.useState(!0),[q,J]=r.useState(""),[E,A]=r.useState(!1),[M,u]=r.useState(!1),l=r.useRef(null),x=r.useRef(null),[b,de]=r.useState(()=>{const t=localStorage.getItem("pdam_visible_columns_analysis");return t?JSON.parse(t):ca}),[ne,xe]=r.useState(!1),[c,I]=r.useState(null),[L,ie]=r.useState(null),[be,se]=r.useState([]),[Ie,ze]=r.useState(null),[$e,ue]=r.useState(!1),[Pe,w]=r.useState(null),[X,Z]=r.useState(null),[H,fe]=r.useState(1),[Ne,ye]=r.useState({x:0,y:0}),[We,je]=r.useState(!1),[Me,_e]=r.useState({x:0,y:0}),Q=r.useRef(null),[ce,Se]=r.useState(1),[U,Ye]=r.useState(10),[Be,De]=r.useState("nama"),[ke,Ce]=r.useState(new Date),[o,z]=r.useState(!1),[s,N]=r.useState(null),[te,oe]=r.useState([]),[i,h]=r.useState(null),[m,ee]=r.useState(null),[ae,pe]=r.useState(null),[R,he]=r.useState({id:"",id_pelanggan:"",id_sambungan:"",id_meter:"",nama:"",alamat:"",kode_tarif:"",stan_awal:"",stan_akhir:0,pemakaian:"",petugas:"",status_laporan:"",latitude:"",longitude:"",foto:null,foto_rumah:null,bulan:"",tahun:"",ai_ocr_status:""}),Le=async()=>{try{O(!0);const[t,p]=await Promise.all([fetch(da),fetch(Oa)]),[f,g]=await Promise.all([t.json(),p.json()]);S(Array.isArray(f)?f:[]),k(Array.isArray(g)?g:[])}catch(t){console.error("Failed to fetch data:",t),me.fire("Error","Gagal memuat data analis.","error")}finally{O(!1)}},lt=async()=>{try{const p=await(await fetch("./api/options.php?type=status_kondisi")).json();_(Array.isArray(p)?p:[])}catch(t){console.error("Failed to fetch status kondisi:",t)}},Ue=t=>D.find(p=>String(p.id)===String(t))||{},He=t=>{let p=parseInt(t.bulan)-1,f=parseInt(t.tahun);p===0&&(p=12,f-=1);const g=G.find($=>(String($.id_pelanggan)===String(t.id_pelanggan)||$.id_sambungan&&t.id_sambungan&&String($.id_sambungan)===String(t.id_sambungan))&&parseInt($.bulan)===p&&parseInt($.tahun)===f);return g?parseInt(g.stan_akhir):0},ut=(t,p)=>!t||!p?null:`https://www.google.com/maps?q=${t},${p}`,[dt,ht]=r.useState([]);r.useEffect(()=>{Le(),lt(),F(),gt()},[]);const gt=async()=>{try{oe([{id:1,nama:"Warsono",status_aktif:"Aktif",cabang:"Utama"},{id:2,nama:"Budi Santoso",status_aktif:"Aktif",cabang:"Utama"},{id:3,nama:"Ahmad Yani",status_aktif:"Aktif",cabang:"Barat"}])}catch(t){console.error("Error fetching officers:",t)}},n=async t=>{N(t);const p=He(t),f=parseInt(t.stan_akhir)-p;he({id:t.id,id_pelanggan:t.id_pelanggan,id_sambungan:t.id_sambungan,id_meter:t.id_meter,nama:t.nama,alamat:t.alamat,kode_tarif:t.kode_tarif,stan_awal:p,stan_akhir:t.stan_akhir,pemakaian:f,petugas:t.petugas,status_laporan:t.status_laporan,latitude:t.latitude,longitude:t.longitude,foto:t.foto,foto_rumah:t.foto_rumah,bulan:t.bulan,tahun:t.tahun,ai_ocr_status:t.ai_ocr_status}),h(t.foto),ee(t.foto_rumah),z(!0)},j=()=>{z(!1),N(null),h(null),ee(null)},B=async t=>{t.preventDefault();try{O(!0);const p=new FormData,f=new Date,g=f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-"+String(f.getDate()).padStart(2,"0")+" "+String(f.getHours()).padStart(2,"0")+":"+String(f.getMinutes()).padStart(2,"0")+":"+String(f.getSeconds()).padStart(2,"0");Object.keys(R).forEach(ve=>{p.append(ve,R[ve]===0||R[ve]?R[ve]:"")});const $=T(s);if(($==="YELLOW"||$==="RED")&&p.append("tgl_verifikasi",g),!(await fetch(`${da}${s?"?id="+s.id:""}`,{method:"POST",body:p})).ok)throw new Error("Failed to update recording");await Le(),j(),me.fire({icon:"success",title:"Berhasil",text:"Data pencatatan berhasil diperbarui",timer:1500,showConfirmButton:!1})}catch(p){console.error("Error saving edit:",p),me.fire({icon:"error",title:"Gagal",text:"Terjadi kesalahan saat menyimpan data"})}finally{O(!1)}};r.useEffect(()=>{const t=p=>{l.current&&!l.current.contains(p.target)&&A(!1),x.current&&!x.current.contains(p.target)&&u(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const F=async()=>{try{const p=await(await fetch("./api/options.php?type=status_analisa")).json();ht(Array.isArray(p)?p:[])}catch(t){console.error("Failed to fetch status analisa:",t)}},K=t=>{const p=He(t),f=parseInt(t.stan_akhir)-p;return parseInt(t.stan_akhir)===0?0:f},le=t=>{if(t<0)return"Meter Mundur";if(!dt.length)return"-";const p=dt.find(f=>{const g=parseInt(f.min),$=parseInt(f.max);return t>=g&&t<=$});return p?p.status_analisa:"-"},we=t=>{if(!t)return"#64748b";const p=t.toLowerCase();return p.includes("mundur")?"#ef4444":p.includes("lonjakan")||p.includes("tinggi")||p.includes("diatas")?"#f97316":p.includes("periksa")?"#eab308":p.includes("nol")||p.includes("tidak ada")?"#8b5cf6":p.includes("normal")?"#22c55e":"#64748b"},T=t=>t?t.ai_ocr_status?String(t.ai_ocr_status):t.stan_akhir&&t.foto?"GREEN":"":"",Te=G.filter(t=>{if(v){const ve=T(t),re=String(ve).toUpperCase().trim();if(v==="REVIEW"){if(re!=="YELLOW"&&re!=="RED")return!1}else{const Y=String(v).toUpperCase().trim();if(re!==Y)return!1}}const p=t.update_date?.slice(0,10),f=ke?new Date(ke.getTime()-ke.getTimezoneOffset()*6e4).toISOString().slice(0,10):null;if(f&&p!==f)return!1;const g=q.toLowerCase().trim();if(!g)return!0;const $=Ue(t.id_pelanggan);return[t.nama,t.id_sambungan,t.id_meter,$.id_tag].filter(Boolean).map(ve=>String(ve).toLowerCase()).join(" ").includes(g)}),Ke=()=>{let t=[],f=Math.max(1,ce-2),g=Math.min(nt,f+5-1);g-f+1<5&&(f=Math.max(1,g-5+1));for(let $=f;$<=g;$++)t.push($);return t};r.useEffect(()=>{Se(1)},[q,U,ke]);const nt=Math.ceil(Te.length/U),Je=Te.slice((ce-1)*U,ce*U),rt=()=>{const t=Vt.filter(g=>b.includes(g.id)),p=t.map(g=>g.label),f=Te.map((g,$)=>{const Ae=Ue(g.id_pelanggan),ve=He(g),re=K(g);return t.map(Y=>{if(Y.id==="id_sambungan")return g.id_sambungan;if(Y.id==="id_meter")return g.id_meter;if(Y.id==="id_tag")return Ae.id_tag||"-";if(Y.id==="nama")return g.nama;if(Y.id==="alamat")return g.alamat;if(Y.id==="kode_tarif")return g.kode_tarif;if(Y.id==="stan_akhir")return g.stan_akhir;if(Y.id==="stan_awal")return ve;if(Y.id==="koordinat")return g.latitude&&g.longitude?`${g.latitude}, ${g.longitude}`:"-";if(Y.id==="ai_ocr_status"){const Re=g.ai_ocr_status||(g.stan_akhir&&g.foto?"GREEN":"");return Re==="GREEN"?"Sesuai":Re==="YELLOW"?"Butuh Review":Re==="RED"?"Mismatch":"-"}return Y.id==="PEMAKAIAN (m)"?re:Y.id==="hasil_analisa"?le(re):Y.id==="status_laporan"?P.find(Re=>Re.kode_kondisi===g.status_laporan)?.status_kondisi||g.status_laporan||"-":Y.id==="tgl_verifikasi"?g.tgl_verifikasi||"-":""})});return{headers:p,rows:f,columns:t}},Rt=()=>{const{headers:t,rows:p}=rt(),f=["No",...t],g=p.map((Y,Re)=>[Re+1,...Y]),$=[f,...g].map(Y=>Y.map(Re=>`"${Re}"`).join(",")).join(`
`),Ae=new Blob([$],{type:"text/csv;charset=utf-8;"}),ve=URL.createObjectURL(Ae),re=document.createElement("a");re.setAttribute("href",ve),re.setAttribute("download",`Analisa_Meter_${Ve(ke,"dd_MMM_yyyy")}.csv`),document.body.appendChild(re),re.click(),document.body.removeChild(re)},Tt=()=>{const{headers:t,rows:p}=rt(),f=p.map((Ae,ve)=>{const re={NO:ve+1};return t.forEach((Y,Re)=>{re[Y]=Ae[Re]}),re}),g=Ee.json_to_sheet(f),$=Ee.book_new();Ee.book_append_sheet($,g,"Analisa Baca Meter"),zt($,`Analisa_Meter_${Ve(ke,"dd_MMM_yyyy")}.xlsx`)},a=()=>{const t=new Ct("l","mm","a4"),p=new Date().toLocaleString("id-ID"),{headers:f,rows:g}=rt();t.setFontSize(18),t.setTextColor(14,165,233),t.text("Laporan Analisa Baca Meter",14,15),t.setFontSize(10),t.setTextColor(100),t.text(`Tanggal: ${Ve(ke,"dd MMMM yyyy")}`,14,22),t.text(`Jumlah Data: ${Te.length}`,14,27),t.text(`Dicetak pada: ${p}`,280,22,{align:"right"});const $=["No",...f],Ae=g.map((xa,fa)=>[fa+1,...xa]);At(t,{head:[$],body:Ae,startY:32,theme:"grid",headStyles:{fillColor:[241,245,249],textColor:[100,116,139],fontStyle:"bold"},styles:{fontSize:8},columnStyles:{0:{cellWidth:10}}});const re=(t.lastAutoTable.finalY||32)+20;re+40>t.internal.pageSize.height&&(t.addPage(),t.text(`Dicetak pada: ${p}`,280,22,{align:"right"}));const Y=localStorage.getItem("username")||"Admin";t.setFontSize(10),t.setTextColor(50);const Kt=t.internal.pageSize.width-20-40;t.text("Dicetak oleh,",Kt,re,{align:"center"}),t.text("_______________________",Kt,re+25,{align:"center"}),t.text(Y,Kt,re+30,{align:"center"}),t.save(`Analisa_Meter_${Ve(ke,"dd_MMM_yyyy")}.pdf`)},d=()=>window.print(),y=async t=>{console.log("Fetching history for:",t),se([]);try{const f=await(await fetch(`./api/customer_history.php?id_sambungan=${t}`)).json();se(Array.isArray(f)?f:[])}catch(p){console.error("Error fetching customer history:",p),se([])}},W=async t=>{if(!t)return;I(t);const p=G.find(f=>f.id_sambungan===t.id_sambungan&&Number(f.bulan)===(Number(t.bulan)===1?12:Number(t.bulan)-1)&&Number(f.tahun)===(Number(t.bulan)===1?Number(t.tahun)-1:Number(t.tahun)));ie(p||null),xe(!0),y(t.id_sambungan)},C=()=>{xe(!1),I(null),ie(null),se([])};return e.jsxs("div",{style:{animation:"fadeIn 0.5s ease-out"},children:[e.jsx("style",{children:`
                    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                    
                    .customer-table {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0;
                    }
                    .customer-table thead th { 
                        position: sticky; top: 0; z-index: 30; background: #f8fafc !important; 
                        box-shadow: inset 0 -2px 0 var(--border);
                        text-transform: uppercase;
                        font-size: 0.7rem; font-weight: 700; letter-spacing: 0.05em; color: #64748b; 
                        padding: 1rem 1.25rem !important;
                        white-space: nowrap;
                    }
                    .customer-table tbody tr { transition: all 0.2s ease; }
                    .customer-table tbody tr:nth-of-type(even) td { background-color: #fafbfc; }
                    .customer-table tbody tr:hover td { background-color: #eff6ff !important; }
                    .customer-table td { 
                        padding: 0.875rem 1.25rem !important; vertical-align: middle; 
                        border-bottom: 1px solid #f1f5f9; 
                        font-size: 0.875rem; color: #334155;
                    }
                    
                    .sticky-col-left {
                        position: sticky !important;
                        left: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-left {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-left {
                        background-color: #fafbfc !important;
                    }

                    .sticky-col-right {
                        position: sticky !important;
                        right: 0;
                        z-index: 20 !important;
                        background: white !important;
                    }
                    .customer-table thead th.sticky-col-right {
                        background: #f8fafc !important;
                        z-index: 40 !important;
                        box-shadow: inset 0 -2px 0 var(--border);
                    }
                    .customer-table tbody tr:nth-of-type(even) .sticky-col-right {
                        background-color: #fafbfc !important;
                    }

                    .badge { 
                        padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; 
                        display: inline-flex; align-items: center; gap: 0.35rem; white-space: nowrap;
                    }
                    
                    .card {
                        background: var(--surface); border-radius: var(--radius);
                        box-shadow: var(--shadow);
                        padding: 1.5rem; border: 1px solid var(--border);
                    }

                    @media print {
                        .no-print { display: none !important; }
                        body { background: white !important; margin: 0 !important; }
                        .card { box-shadow: none !important; border: none !important; padding: 0 !important; margin: 0 !important; width: 100% !important; }
                        .customer-table { font-size: 7pt !important; width: 100% !important; border-collapse: collapse !important; }
                        .customer-table th, .customer-table td { 
                            border: 1px solid #000 !important; 
                            padding: 2px 4px !important; 
                            white-space: normal !important;
                            word-break: break-word;
                        }
                        @page { size: landscape; margin: 0.5cm; }
                        .print-footer { display: block !important; position: fixed; bottom: 0; right: 0; width: 300px; text-align: center; font-size: 10pt; color: #000; }
                    }
                    .print-footer { display: none; }
                    @media (max-width: 768px) {
                        .header {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 1rem;
                        }
                        .header-actions {
                            width: 100%;
                            justify-content: flex-start;
                            overflow-x: auto;
                            padding-bottom: 0.5rem;
                        }
                        .hide-mobile {
                            display: none;
                        }
                        .table-container {
                            margin: 1rem 0 !important;
                            width: 100% !important;
                            overflow-x: auto !important;
                        }
                        .card {
                            padding: 1rem !important;
                        }
                    }
                `}),e.jsxs("header",{className:"header",style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"1rem",fontSize:"1.875rem",fontWeight:800,color:"#0f172a",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{background:"rgba(14, 165, 233, 0.1)",padding:"0.625rem",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ha,{size:32,color:"var(--primary)"})}),v==="REVIEW"?"Update Analisa Meter":"Analisa Baca Meter"]}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.95rem",marginTop:"0.25rem"},children:v==="REVIEW"?"Review dan verifikasi hasil pembacaan meter otomatis (Kuning & Merah)":"Dashboard analisis penggunaan meter pelanggan seluruh area"})]}),e.jsx("div",{className:"header-actions no-print",style:{display:"flex",gap:"0.5rem"},children:v==="REVIEW"?e.jsxs("button",{className:"btn btn-primary",onClick:Le,disabled:V,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",borderRadius:"8px",fontWeight:600,boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:[e.jsx(Yt,{size:18,className:V?"animate-spin":""}),V?"Memuat...":"Refresh Data"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-outline",onClick:Rt,title:"Export CSV",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(kt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:Tt,title:"Export Excel",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(vt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:a,title:"Export PDF",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(wt,{size:18})}),e.jsx("button",{className:"btn btn-outline",onClick:d,title:"Print",style:{height:"42px",width:"42px",padding:0,borderRadius:"8px"},children:e.jsx(_t,{size:18})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative"},ref:l,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>A(!E),style:{height:"42px",padding:"0 1.25rem",borderRadius:"8px",fontWeight:600,display:"flex",alignItems:"center",gap:"0.625rem"},children:[e.jsx(St,{size:18}),e.jsx("span",{children:"Pilih Kolom"})]}),E&&e.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",padding:"1.25rem",minWidth:"240px"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"0.875rem",marginBottom:"1rem",borderBottom:"1px solid var(--border)",paddingBottom:"0.5rem"},children:"Tampilkan Kolom"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:Vt.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.5rem",cursor:"pointer",borderRadius:"6px"},onMouseEnter:p=>p.currentTarget.style.background="#f8fafc",onMouseLeave:p=>p.currentTarget.style.background="none",children:[e.jsx("input",{type:"checkbox",checked:b.includes(t.id),style:{width:"16px",height:"16px",accentColor:"var(--primary)"},onChange:()=>de(p=>p.includes(t.id)?p.filter(f=>f!==t.id):[...p,t.id])}),e.jsx("span",{style:{fontSize:"0.875rem",color:b.includes(t.id)?"var(--text)":"var(--text-light)"},children:t.label})]},t.id))}),e.jsxs("div",{style:{borderTop:"1px solid var(--border)",marginTop:"0.75rem",paddingTop:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{onClick:()=>de(Vt.map(t=>t.id)),style:{fontSize:"0.8rem",color:"var(--primary)",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Pilih Semua"}),e.jsx("button",{onClick:()=>de(ca),style:{fontSize:"0.8rem",color:"#64748b",background:"none",border:"none",cursor:"pointer",fontWeight:600},children:"Reset Default"})]})]})]}),e.jsxs("div",{style:{position:"relative"},ref:x,children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>u(!M),style:{height:"42px",padding:"0 1.25rem",display:"flex",alignItems:"center",gap:"0.625rem",background:M?"#f1f5f9":"#f8fafc",border:`1px solid ${M?"var(--primary)":"var(--border)"}`,color:M?"var(--primary)":"var(--text)",borderRadius:"8px",minWidth:"100px"},children:[e.jsx("span",{style:{fontWeight:600},children:"Filter"}),e.jsx(Qe,{size:16})]}),M&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,zIndex:1e3,background:"white",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 12px 30px rgba(0,0,0,0.12)",padding:"0.5rem",minWidth:"200px"},children:[{id:"nama",label:"By Nama"},{id:"id_sambungan",label:"By No. Sambungan"},{id:"id_meter",label:"By ID Meter"},{id:"id_tag",label:"By ID Tag"}].map(t=>e.jsx("button",{onClick:()=>{De(t.id),u(!1)},style:{width:"100%",textAlign:"left",padding:"0.75rem 1rem",border:"none",background:Be===t.id?"#f1f5f9":"none",color:Be===t.id?"var(--primary)":"var(--text)",borderRadius:"8px",cursor:"pointer"},children:t.label},t.id))})]}),e.jsx("div",{style:{height:"42px",display:"flex",alignItems:"center"},children:e.jsx(ga,{value:ke,onChange:Ce})}),e.jsxs("div",{style:{position:"relative",flex:"0 1 350px"},children:[e.jsx(qe,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-light)"}}),e.jsx("input",{style:{paddingLeft:"2.5rem",paddingRight:q?"2.5rem":"0.625rem",height:"42px",borderRadius:"8px",border:"1px solid var(--border)",background:"#f8fafc",width:"100%",fontSize:"0.875rem"},placeholder:"Ketik kata kunci pencarian...",value:q,onChange:t=>J(t.target.value)}),q&&e.jsx("button",{onClick:()=>J(""),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-light)"},children:e.jsx(ge,{size:16})})]})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"calc(100vh - 350px)",overflowY:"auto",margin:"1rem -1rem 0",width:"calc(100% + 2rem)"},children:e.jsxs("table",{className:"customer-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky-col-left",style:{width:"80px",textAlign:"center"},children:"NO"}),b.includes("id_sambungan")&&e.jsx("th",{style:{width:"180px",minWidth:"180px",textAlign:"left"},children:"NO. SAMBUNGAN"}),b.includes("id_meter")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"ID METER"}),b.includes("id_tag")&&e.jsx("th",{style:{width:"150px",minWidth:"150px",textAlign:"left"},children:"ID TAG"}),b.includes("nama")&&e.jsx("th",{style:{width:"250px",minWidth:"250px",textAlign:"left"},children:"NAMA"}),b.includes("alamat")&&e.jsx("th",{style:{width:"350px",minWidth:"350px",textAlign:"left"},children:"ALAMAT"}),b.includes("kode_tarif")&&e.jsx("th",{style:{width:"100px",minWidth:"100px",textAlign:"center"},children:"TARIF"}),b.includes("stan_akhir")&&e.jsx("th",{style:{width:"130px",minWidth:"130px",textAlign:"center"},children:"STAND AKHIR"}),b.includes("stan_awal")&&e.jsx("th",{style:{width:"130px",minWidth:"130px",textAlign:"center"},children:"STAN AWAL"}),b.includes("koordinat")&&e.jsx("th",{style:{width:"200px",minWidth:"200px",textAlign:"left"},children:"KOORDINAT"}),b.includes("PEMAKAIAN (m)")&&e.jsx("th",{style:{width:"160px",minWidth:"160px",textAlign:"center"},children:"PEMAKAIAN (m)"}),b.includes("ai_ocr_status")&&e.jsx("th",{style:{width:"180px",minWidth:"180px",textAlign:"center"},children:"STATUS OCR"}),b.includes("hasil_analisa")&&e.jsx("th",{style:{width:"180px",minWidth:"180px",textAlign:"center"},children:"HASIL ANALISA"}),b.includes("status_laporan")&&e.jsx("th",{style:{width:"180px",minWidth:"180px",textAlign:"center"},children:"KONDISI METER"}),b.includes("tgl_verifikasi")&&e.jsx("th",{style:{width:"180px",minWidth:"180px",textAlign:"center"},children:"TGL VERIFIKASI"}),e.jsx("th",{className:"no-print sticky-col-right",style:{width:"120px",minWidth:"120px",textAlign:"center"},children:"AKSI"})]})}),e.jsx("tbody",{children:V?e.jsx("tr",{children:e.jsx("td",{colSpan:b.length+2,style:{textAlign:"center",padding:"3rem"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[e.jsx(Yt,{size:32,className:"animate-spin",color:"var(--primary)"}),e.jsx("span",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:"Memuat data..."})]})})}):Je.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:b.length+2,style:{textAlign:"center",padding:"3rem"},children:e.jsx("div",{style:{color:"#94a3b8",fontSize:"0.875rem"},children:"Tidak ada data ditemukan"})})}):Je.map((t,p)=>{const f=Ue(t.id_pelanggan),g=He(t),$=K(t);return e.jsxs("tr",{children:[e.jsx("td",{className:"sticky-col-left",style:{textAlign:"center",fontWeight:500,color:"#64748b",padding:"0.625rem 0.75rem"},children:(ce-1)*U+p+1}),b.includes("id_sambungan")&&e.jsx("td",{style:{textAlign:"left"},children:t.id_sambungan}),b.includes("id_meter")&&e.jsx("td",{style:{textAlign:"left"},children:t.id_meter}),b.includes("id_tag")&&e.jsx("td",{style:{textAlign:"left"},children:f.id_tag||"-"}),b.includes("nama")&&e.jsx("td",{style:{fontWeight:600,color:"#334155",textAlign:"left"},children:t.nama}),b.includes("alamat")&&e.jsx("td",{style:{fontSize:"0.8rem",maxWidth:"300px",whiteSpace:"normal",textAlign:"left"},children:t.alamat}),b.includes("kode_tarif")&&e.jsx("td",{style:{textAlign:"center"},children:t.kode_tarif}),b.includes("stan_akhir")&&e.jsx("td",{style:{textAlign:"center"},children:t.stan_akhir}),b.includes("stan_awal")&&e.jsx("td",{style:{textAlign:"center"},children:g}),b.includes("koordinat")&&e.jsx("td",{style:{width:"180px",textAlign:"left"},children:t.latitude&&t.longitude?e.jsx("a",{href:ut(t.latitude,t.longitude),target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",fontWeight:500,textDecoration:"underline",fontSize:"0.75rem"},title:"Buka di Google Maps",children:e.jsxs("span",{style:{letterSpacing:"-0.02em"},children:[t.latitude,", ",t.longitude]})}):"-"}),b.includes("PEMAKAIAN (m)")&&e.jsx("td",{style:{fontWeight:600,textAlign:"center",color:"#0f172a",fontSize:"0.9rem"},children:$}),b.includes("ai_ocr_status")&&e.jsx("td",{style:{textAlign:"center"},children:(()=>{const Ae=T(t);if(!Ae)return"-";const re={GREEN:{label:"Sesuai",color:"#166534",bg:"#dcfce7",border:"#bbf7d0",icon:" "},YELLOW:{label:"Butuh Review",color:"#854d0e",bg:"#fef9c3",border:"#fef08a",icon:" "},RED:{label:"Tidak Sesuai",color:"#991b1b",bg:"#fee2e2",border:"#fecaca",icon:" "},VERIFIED:{label:"Sudah Di Verifikasi",color:"#1d4ed8",bg:"#dbeafe",border:"#bfdbfe",icon:" "},"Sesuai (Manual)":{label:"Sudah Terverifikasi",color:"#1d4ed8",bg:"#dbeafe",border:"#bfdbfe",icon:" "}}[Ae]||{label:Ae,color:"#64748b",bg:"#f1f5f9",border:"#e2e8f0",icon:""};return e.jsxs("span",{className:"badge",style:{backgroundColor:re.bg,color:re.color,border:"1px solid",borderColor:re.border,fontSize:"0.7rem",padding:"0.35rem 0.875rem",borderRadius:"10px",fontWeight:700,display:"inline-flex",alignItems:"center",gap:"0.35rem",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[re.icon,re.label]})})()}),b.includes("hasil_analisa")&&e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{className:"badge",style:{backgroundColor:we(le($))+"15",color:we(le($)),padding:"0.35rem 0.875rem",borderRadius:"10px",fontWeight:800,fontSize:"0.7rem",display:"inline-flex",alignItems:"center",boxShadow:"0 1px 2px rgba(0,0,0,0.03)"},children:le($)})}),b.includes("status_laporan")&&e.jsx("td",{style:{textAlign:"center"},children:(()=>{const Ae=P.find(re=>re.kode_kondisi===t.status_laporan)?.status_kondisi||t.status_laporan,ve=Ae==="Normal";return e.jsx("span",{className:"badge",style:{backgroundColor:ve?"#dcfce7":Ae?"#fee2e2":"#f1f5f9",color:ve?"#166534":Ae?"#991b1b":"#64748b",padding:"0.35rem 0.875rem",borderRadius:"10px",fontSize:"0.7rem",fontWeight:700,display:"inline-flex",alignItems:"center",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:Ae||"-"})})()}),b.includes("tgl_verifikasi")&&e.jsx("td",{style:{textAlign:"center",fontSize:"0.85rem",color:"#64748b"},children:t.tgl_verifikasi||"-"}),e.jsx("td",{className:"no-print sticky-col-right",style:{textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"0.4rem",justifyContent:"center"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.3rem",borderRadius:"6px"},onClick:()=>W(t),title:"Lihat",children:e.jsx(Ta,{size:14,color:"#0ea5e9"})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.3rem",borderRadius:"6px"},onClick:()=>n(t),title:"Edit",children:e.jsx(at,{size:14,color:"#202328ff"})})]})})]},t.id)})})]})}),!V&&Te.length>0&&e.jsxs("div",{className:"no-print",style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{color:"var(--text-light)",fontSize:"0.875rem"},children:["Menampilkan ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:(ce-1)*U+1})," sampai ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Math.min(ce*U,Te.length)})," dari ",e.jsx("span",{style:{fontWeight:600,color:"var(--text)"},children:Te.length})," data analisa"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",marginBottom:0},children:"Baris per halaman:"}),e.jsx("select",{value:U,onChange:t=>Ye(Number(t.target.value)),style:{width:"auto",padding:"0.25rem 0.5rem",height:"auto"},children:[10,25,50,100].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ce===1,onClick:()=>Se(1),children:e.jsx(Jt,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ce===1,onClick:()=>Se(t=>Math.max(1,t-1)),children:e.jsx(et,{size:18})}),Ke().map(t=>e.jsx("button",{className:`btn ${ce===t?"btn-primary":"btn-outline"}`,style:{minWidth:"36px",height:"36px",padding:0,justifyContent:"center"},onClick:()=>Se(t),children:t},t)),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ce===nt,onClick:()=>Se(t=>Math.min(nt,t+1)),children:e.jsx(tt,{size:18})}),e.jsx("button",{className:"btn btn-outline",style:{padding:"0.4rem"},disabled:ce===nt,onClick:()=>Se(nt),children:e.jsx(Xt,{size:18})})]})]})]})]}),ne&&c&&e.jsx("div",{className:"modal-overlay",style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.75)",backdropFilter:"blur(4px)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.2s"},children:e.jsxs("div",{className:"modal-content",style:{background:"white",width:"90%",maxWidth:"650px",maxHeight:"85vh",borderRadius:"20px",overflow:"hidden",display:"flex",flexDirection:"column",animation:"slideUp 0.3s"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:"Detail Analisa Meter"}),e.jsx("button",{onClick:C,style:{width:"36px",height:"36px",background:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer",color:"#64748b",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:e.jsx(ge,{size:20})})]}),e.jsxs("div",{style:{padding:"1.25rem 2rem",overflowY:"auto",flex:1},children:[e.jsxs("div",{style:{maxWidth:"580px",margin:"0 auto",display:"flex",flexDirection:"column",gap:"0.625rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingBottom:"0.5rem",borderBottom:"2px solid #f1f5f9",marginBottom:"0.25rem"},children:[e.jsx("div",{style:{width:"4px",height:"1.25rem",background:"var(--primary)",borderRadius:"2px"}}),e.jsx("h3",{style:{fontSize:"0.9375rem",fontWeight:700,color:"#1e293b",margin:0,textTransform:"uppercase",letterSpacing:"0.025em"},children:"Detail Pelanggan"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.25rem 1rem",padding:"1.5rem",background:"#f8fafc",borderRadius:"16px",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"Nama Pelanggan"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:700,color:"#1e293b"},children:c.nama})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"No. Sambungan"}),e.jsx("div",{style:{fontSize:"0.9375rem",fontWeight:600,color:"#334155"},children:c.id_sambungan})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"ID Meter"}),e.jsx("div",{style:{fontSize:"0.9375rem",fontWeight:600,color:"#334155"},children:c.id_meter})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"ID Tag"}),e.jsx("div",{style:{fontSize:"0.9375rem",fontWeight:600,color:"#334155"},children:Ue(c.id_pelanggan).id_tag||"-"})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",textAlign:"center",paddingTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.35rem"},children:"Hasil OCR"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",color:T(c)==="GREEN"?"#166534":T(c)==="YELLOW"?"#854d0e":T(c)==="RED"?"#991b1b":T(c)==="VERIFIED"?"#1d4ed8":"#64748b",fontWeight:700,fontSize:"0.875rem"},children:[T(c)==="GREEN"&&e.jsx(ct,{size:18}),T(c)==="YELLOW"&&e.jsx(Bt,{size:18}),T(c)==="RED"&&e.jsx(Gt,{size:18}),(T(c)==="VERIFIED"||T(c)==="Sesuai (Manual)")&&e.jsx(ct,{size:18}),e.jsx("span",{style:{textTransform:"uppercase"},children:T(c)==="GREEN"?"SESUAI":T(c)==="YELLOW"?"BUTUH REVIEW":T(c)==="RED"?"TIDAK SESUAI":T(c)==="VERIFIED"||T(c)==="Sesuai (Manual)"?"SUDAH VERIFIKASI":"-"})]})]})]}),e.jsx("div",{style:{borderTop:"1px solid #e2e8f0",margin:"0.5rem 0"}}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginTop:"0.25rem"},children:[e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Rumah Awal"}),e.jsx("div",{onClick:()=>L?.foto_rumah&&Z(L.foto_rumah),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:L?.foto_rumah?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>L?.foto_rumah&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:L?.foto_rumah?"Klik untuk memperbesar":"",children:L?.foto_rumah?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:L.foto_rumah.startsWith("/")?`${mt}${L.foto_rumah}`:L.foto_rumah,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Rumah Awal"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(It,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(Oe,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Rumah Akhir"}),e.jsx("div",{onClick:()=>c.foto_rumah&&Z(c.foto_rumah),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:c.foto_rumah?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>c.foto_rumah&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:c.foto_rumah?"Klik untuk memperbesar":"",children:c.foto_rumah?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:c.foto_rumah&&c.foto_rumah.startsWith("/")?`${mt}${c.foto_rumah}`:c.foto_rumah,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Rumah Akhir"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(It,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(Oe,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Meter Awal"}),e.jsx("div",{onClick:()=>L?.foto&&Z(L.foto),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:L?.foto?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>L?.foto&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:L?.foto?"Klik untuk memperbesar":"",children:L?.foto?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:L?.foto&&L.foto.startsWith("/")?`${mt}${L.foto}`:L.foto,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Meter Awal"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(It,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(Oe,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",padding:"0.4rem",borderRadius:"16px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsx("label",{style:{fontSize:"0.6rem",fontWeight:700,color:"#64748b",marginBottom:"0.25rem",display:"block",textTransform:"uppercase",letterSpacing:"0.05em",textAlign:"center"},children:"Foto Meter Akhir"}),e.jsx("div",{onClick:()=>c.foto&&Z(c.foto),style:{width:"100%",aspectRatio:"4/3",border:"1px solid #f1f5f9",borderRadius:"10px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:c.foto?"zoom-in":"default",transition:"transform 0.2s"},onMouseEnter:t=>c.foto&&(t.currentTarget.style.transform="scale(1.02)"),onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",title:c.foto?"Klik untuk memperbesar":"",children:c.foto?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:c.foto&&c.foto.startsWith("/")?`${mt}${c.foto}`:c.foto,style:{width:"100%",height:"100%",objectFit:"cover"},alt:"Foto Meter Akhir"}),e.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",background:"rgba(255, 255, 255, 0.9)",padding:"0.25rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(It,{size:16,color:"#64748b"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:[e.jsx(Oe,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]})})]})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginTop:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1",maxWidth:"280px"},children:[e.jsx("label",{style:{fontSize:"0.6875rem",fontWeight:700,color:"#64748b",marginBottom:"0.375rem",display:"block",textTransform:"uppercase",textAlign:"center",letterSpacing:"0.05em"},children:"Stan Awal"}),e.jsx("div",{style:{width:"100%",padding:"0.625rem",borderRadius:"8px",border:"1px solid #bfdbfe",background:"#f0f9ff",color:"#0284c7",textAlign:"center",fontSize:"1rem",fontWeight:700,boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.05)"},children:L?L.stan_akhir:0})]}),e.jsxs("div",{className:"form-group",style:{flex:"1",maxWidth:"280px"},children:[e.jsx("label",{style:{fontSize:"0.6875rem",fontWeight:700,color:"#64748b",marginBottom:"0.375rem",display:"block",textTransform:"uppercase",textAlign:"center",letterSpacing:"0.05em"},children:"Stan Akhir"}),e.jsx("div",{style:{width:"100%",padding:"0.625rem",borderRadius:"8px",border:"1px solid #bfdbfe",background:"#f0f9ff",color:"#0284c7",textAlign:"center",fontSize:"1rem",fontWeight:700,boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.05)"},children:c.stan_akhir})]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsxs("div",{className:"form-group",style:{width:"calc(33.33% - 0.5rem)"},children:[e.jsx("label",{style:{fontSize:"0.6875rem",fontWeight:700,color:"#475569",marginBottom:"0.375rem",display:"block",textTransform:"uppercase",textAlign:"center",letterSpacing:"0.05em"},children:"Pemakaian"}),e.jsx("div",{style:{width:"100%",padding:"0.625rem",borderRadius:"8px",border:"2px solid #3b82f6",background:"#e0f2fe",color:"#1d4ed8",textAlign:"center",fontSize:"1.0625rem",fontWeight:800,boxShadow:"0 4px 6px -1px rgba(59, 130, 246, 0.15)"},children:(()=>{const t=parseInt(c.stan_akhir);if(t===0)return"0 m";const p=L?parseInt(L.stan_akhir):0;return t-p+" m"})()})]})})]})]}),e.jsx("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-outline",style:{padding:"0.75rem 4rem",borderRadius:"10px",fontWeight:600},onClick:C,children:"Tutup"})})]})]})}),X&&e.jsx("div",{ref:Q,className:"modal-overlay",style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",cursor:We?"grabbing":H>1?"grab":"zoom-out",animation:"fadeIn 0.2s",overflow:"hidden"},onClick:t=>{t.target===t.currentTarget&&(Z(null),fe(1),ye({x:0,y:0}))},onWheel:t=>{t.stopPropagation();const p=t.deltaY*-.001;fe(f=>Math.min(Math.max(1,f+p),5))},children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[e.jsx("img",{src:X,style:{maxWidth:H===1?"95%":"none",maxHeight:H===1?"95vh":"none",width:H>1?`${H*100}%`:"auto",objectFit:"contain",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",transform:`translate(${Ne.x}px, ${Ne.y}px)`,transition:We?"none":"transform 0.1s ease-out",userSelect:"none",pointerEvents:"none"},alt:"Preview",draggable:!1}),H>1&&e.jsx("div",{style:{position:"absolute",inset:0,cursor:We?"grabbing":"grab"},onMouseDown:t=>{je(!0),_e({x:t.clientX-Ne.x,y:t.clientY-Ne.y})},onMouseMove:t=>{We&&ye({x:t.clientX-Me.x,y:t.clientY-Me.y})},onMouseUp:()=>je(!1),onMouseLeave:()=>je(!1)}),e.jsx("button",{onClick:()=>{Z(null),fe(1),ye({x:0,y:0})},style:{position:"absolute",top:"20px",right:"20px",background:"white",border:"none",padding:"12px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",transition:"transform 0.2s",zIndex:10},onMouseEnter:t=>t.currentTarget.style.transform="scale(1.1)",onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",children:e.jsx(ge,{size:24,color:"#1e293b"})}),H>1&&e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(255, 255, 255, 0.9)",padding:"8px 16px",borderRadius:"20px",fontSize:"0.875rem",fontWeight:600,color:"#1e293b",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",userSelect:"none"},children:[Math.round(H*100),"%"]})]})}),ae&&e.jsx("div",{className:"modal-overlay",style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.2s"},onClick:()=>pe(null),children:e.jsxs("div",{style:{position:"relative",maxWidth:"90%",maxHeight:"90vh"},children:[e.jsx("img",{src:ae&&ae.startsWith("/")?`${mt}${ae}`:ae,style:{maxWidth:"100%",maxHeight:"90vh",objectFit:"contain",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},alt:"Preview"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),pe(null)},style:{position:"absolute",top:"20px",right:"20px",background:"white",border:"none",padding:"12px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",transition:"transform 0.2s",zIndex:10},onMouseEnter:t=>t.currentTarget.style.transform="scale(1.1)",onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",children:e.jsx(ge,{size:24,color:"#1e293b"})})]})}),o&&e.jsx("div",{className:"modal-overlay",style:{animation:"fadeIn 0.2s",backgroundColor:"rgba(15, 23, 42, 0.75)",backdropFilter:"blur(4px)",position:"fixed",inset:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-content",style:{animation:"slideUp 0.3s",width:"90%",maxWidth:"950px",borderRadius:"20px",padding:0,overflow:"hidden",maxHeight:"90vh",display:"flex",flexDirection:"column",background:"white"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #f1f5f9",display:"flex",justifyContent:"space-between",alignItems:"center",background:"white"},children:[e.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:"Koreksi Analisa Meter"}),e.jsx("button",{onClick:j,style:{width:"36px",height:"36px",background:"#f1f5f9",border:"none",borderRadius:"8px",cursor:"pointer",color:"#64748b",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:e.jsx(ge,{size:20})})]}),e.jsxs("form",{onSubmit:B,style:{padding:"2rem",overflowY:"auto",flex:1},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",paddingLeft:"0.5rem",borderLeft:"4px solid var(--primary)"},children:e.jsx("h3",{style:{fontSize:"0.875rem",fontWeight:700,color:"#1e293b",textTransform:"uppercase",letterSpacing:"0.05em",margin:0},children:"Detail Pelanggan"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.25rem 1rem",background:"#f8fafc",padding:"1.5rem",borderRadius:"16px",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"Nama Pelanggan"}),e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:700,color:"#0f172a"},children:R.nama})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"No. Sambungan"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:"#334155"},children:R.id_sambungan})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"ID Meter"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:"#334155"},children:R.id_meter})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.25rem"},children:"ID Tag"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:"#334155"},children:R.id_tag||Ue(R.id_pelanggan).id_tag||"-"})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",textAlign:"center",paddingTop:"0.75rem",borderTop:"1px dashed #cbd5e1"},children:[e.jsx("div",{style:{fontSize:"0.65rem",fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.35rem"},children:v==="REVIEW"?"Pilih Status OCR":"Hasil OCR"}),v==="REVIEW"?e.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:"0.5rem",marginTop:"0.25rem"},children:[{id:"GREEN",label:"SESUAI",icon:e.jsx(ct,{size:16}),color:"#166534",bg:"#dcfce7"},{id:"YELLOW",label:"REVIEW",icon:e.jsx(Bt,{size:16}),color:"#854d0e",bg:"#fef9c3"},{id:"RED",label:"TIDAK SESUAI",icon:e.jsx(Gt,{size:16}),color:"#991b1b",bg:"#fee2e2"},{id:"VERIFIED",label:"VERIFIKASI",icon:e.jsx(ct,{size:16}),color:"#1d4ed8",bg:"#dbeafe"}].map(t=>{const f=T(R)===t.id;return e.jsxs("button",{type:"button",onClick:()=>he(g=>({...g,ai_ocr_status:t.id})),style:{display:"flex",alignItems:"center",gap:"0.35rem",padding:"0.4rem 0.75rem",borderRadius:"8px",fontSize:"0.7rem",fontWeight:700,transition:"all 0.2s ease",cursor:"pointer",border:f?`2px solid ${t.color}`:"1px solid #e2e8f0",backgroundColor:f?t.bg:"#fff",color:f?t.color:"#64748b",boxShadow:f?"0 2px 4px rgba(0,0,0,0.05)":"none",transform:f?"scale(1.05)":"scale(1)"},children:[t.icon,e.jsx("span",{children:t.label})]},t.id)})}):e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",color:T(R)==="GREEN"?"#166534":T(R)==="YELLOW"?"#854d0e":T(R)==="RED"?"#991b1b":T(R)==="VERIFIED"?"#1d4ed8":"#64748b",fontWeight:700,fontSize:"0.9rem"},children:[T(R)==="GREEN"&&e.jsx(ct,{size:18}),T(R)==="YELLOW"&&e.jsx(Bt,{size:18}),T(R)==="RED"&&e.jsx(Gt,{size:18}),(T(R)==="VERIFIED"||T(R)==="Sesuai (Manual)")&&e.jsx(ct,{size:18}),e.jsx("span",{style:{textTransform:"uppercase"},children:T(R)==="GREEN"?"SESUAI":T(R)==="YELLOW"?"BUTUH REVIEW":T(R)==="RED"?"TIDAK SESUAI":T(R)==="VERIFIED"||T(R)==="Sesuai (Manual)"?"SUDAH VERIFIKASI":"-"})]})]})]})]}),e.jsxs("div",{className:"grid-2-col",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Awal (Bulan Lalu)"}),e.jsxs("div",{style:{width:"100%",padding:"0.75rem",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f0f9ff",display:"flex",alignItems:"center",gap:"0.5rem",color:"#0369a1",fontSize:"0.95rem",fontWeight:700},children:[e.jsx(ua,{size:16}),e.jsx("span",{children:R.stan_awal})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"0.5rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Stan Akhir"}),e.jsx("input",{type:"number",style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #ef4444",fontSize:"1rem",background:"#fef2f2"},value:R.stan_akhir,onChange:t=>he({...R,stan_akhir:t.target.value}),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600,color:"#64748b",marginBottom:"0.5rem",display:"block"},children:"Pemakaian (m)"}),e.jsxs("div",{style:{width:"100%",padding:"0 0.75rem",height:"48px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"#f8fafc",display:"flex",alignItems:"center",gap:"0.5rem",color:"#1e293b",fontSize:"0.95rem",fontWeight:800},children:[e.jsx(st,{size:16,color:"#0ea5e9"}),e.jsx("span",{children:(()=>{const t=Number(R.stan_akhir||0);return t===0?"0 m":t-Number(R.stan_awal||0)+" m"})()})]})]})]})]}),e.jsx("div",{children:e.jsx("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[{id:"foto",label:"FOTO METER",preview:i},{id:"foto_rumah",label:"FOTO RUMAH",preview:m}].map(t=>e.jsx("div",{style:{textAlign:"center",flex:1},children:e.jsxs("div",{onClick:()=>t.preview&&pe(t.preview),style:{width:"100%",aspectRatio:"4/3",border:"2px solid #e2e8f0",borderRadius:"12px",position:"relative",overflow:"hidden",background:"#f8fafc",cursor:t.preview?"pointer":"default"},children:[t.preview?e.jsx("img",{src:t.preview&&t.preview.startsWith("/")?`${mt}${t.preview}`:t.preview,style:{width:"100%",height:"100%",objectFit:"cover"},alt:t.label}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"#cbd5e1"},children:[e.jsx(Oe,{size:24}),e.jsx("span",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:"Tidak Ada Foto"})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0,0,0,0.5)",color:"white",fontSize:"0.6rem",padding:"4px",textTransform:"uppercase",fontWeight:700},children:t.label})]})},t.id))})})]}),e.jsxs("div",{style:{marginTop:"2.5rem",paddingTop:"1.5rem",borderTop:"1px solid #f1f5f9",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-outline",style:{padding:"0.625rem 1.5rem",borderRadius:"8px",fontWeight:600},onClick:j,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{padding:"0.625rem 2rem",borderRadius:"8px",fontWeight:600,boxShadow:"0 4px 6px -1px rgba(14, 165, 233, 0.2)"},children:"Simpan Perubahan"})]})]})]})}),e.jsxs("div",{className:"print-footer",children:[e.jsx("p",{style:{margin:"0 0 40px 0"},children:"Dicetak oleh,"}),e.jsx("div",{style:{borderBottom:"1px solid black",width:"200px",margin:"0 auto 10px auto"}}),e.jsx("p",{children:localStorage.getItem("username")||"Admin"})]})]})}function Ba(){const[v,G]=r.useState(localStorage.getItem("pdam_active_tab")||"pelanggan"),[S,D]=r.useState(window.innerWidth>768),[k,P]=r.useState(window.innerWidth<=768),[_,V]=r.useState(["analisa"]);r.useEffect(()=>{localStorage.setItem("pdam_active_tab",v)},[v]),r.useEffect(()=>{const E=()=>{const A=window.innerWidth<=768;P(A),D(!A)};return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const O=[{id:"cabang_parent",label:"Data Cabang",icon:e.jsx(Ft,{size:20}),subItems:[{id:"cabang",label:"Daftar Cabang"},{id:"petugas",label:"Daftar Petugas"},{id:"petugas_mapping",label:"Pemetaan Tugas"}]},{id:"pelanggan",label:"Data Pelanggan",icon:e.jsx(Zt,{size:20})},{id:"catat",label:"Pencatatan Meter Berjalan",icon:e.jsx(st,{size:20})},{id:"analisa",label:"Analisa Baca Meter",icon:e.jsx(ha,{size:20}),subItems:[{id:"analisa_review",label:"Daftar Koreksi ABM"}]},{id:"history_catat",label:"History Pencatatan",icon:e.jsx(Ia,{size:20})}],q=E=>{G(E),k&&D(!1)},J=E=>{V(A=>A.includes(E)?A.filter(M=>M!==E):[...A,E])};return e.jsxs("div",{className:"app-layout",children:[e.jsx("div",{className:`sidebar-overlay ${k&&S?"visible":""}`,onClick:()=>D(!1)}),e.jsxs("header",{className:"mobile-header",children:[e.jsx("button",{className:"btn-menu",onClick:()=>D(!0),children:e.jsx(aa,{size:24})}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("img",{src:"logo.svg",alt:"PDAM Smart",style:{height:"50px",width:"auto"}})})]}),e.jsxs("aside",{className:`sidebar ${k?S?"visible-mobile":"hidden-mobile":S?"open":"closed"}`,children:[e.jsxs("div",{className:"sidebar-header",style:{justifyContent:"center",padding:S||k?"2rem 1rem":"1rem 0.5rem",transition:"padding 0.3s ease"},children:[e.jsx("img",{src:"logo.png",alt:"PDAM App",style:{height:"130px",maxHeight:"15vh",width:"auto",maxWidth:"100%",borderRadius:"8px",display:S||k?"block":"none",animation:"fadeIn 0.7s cubic-bezier(0.2, 0.8, 0.2, 1)"}}),e.jsx("img",{src:"logo-icon.svg",alt:"PDAM",style:{height:"40px",width:"40px",objectFit:"contain",display:S||k?"none":"block"}}),k&&e.jsx("button",{onClick:()=>D(!1),style:{position:"absolute",right:"10px",top:"15px",background:"none",border:"none",color:"white",cursor:"pointer"},children:e.jsx(ge,{size:24})})]}),e.jsx("nav",{className:"sidebar-nav",children:O.map(E=>{const A=E.subItems&&E.subItems.length>0,M=v===E.id,u=A&&E.subItems.some(x=>x.id===v),l=_.includes(E.id);return e.jsxs("div",{className:"menu-group",children:[e.jsxs("button",{className:`nav-item ${M?"active":""} ${u?"parent-active":""}`,onClick:()=>{A?(J(E.id),E.id!=="cabang_parent"&&q(E.id),S||D(!0)):q(E.id)},children:[E.icon,(S||k)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:E.label}),A&&e.jsx(Qe,{size:16,className:`chevron-icon ${l?"rotated":""}`})]})]}),A&&(S||k)&&e.jsx("div",{className:`nav-submenu ${l?"open":""}`,children:E.subItems.map(x=>e.jsxs("button",{className:`sub-nav-item ${v===x.id?"active":""}`,onClick:()=>q(x.id),children:[e.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"currentColor"}}),e.jsx("span",{children:x.label})]},x.id))})]},E.id)})}),!k&&e.jsx("button",{className:"sidebar-toggle",onClick:()=>D(!S),children:S?e.jsx(ge,{size:18}):e.jsx(aa,{size:18})})]}),e.jsx("main",{className:"main-content",children:e.jsx("div",{className:"content-container",children:v==="pelanggan"?e.jsx(Na,{}):v==="catat"?e.jsx(sa,{}):v==="history_catat"?e.jsx(sa,{isHistory:!0}):v==="petugas"?e.jsx(La,{}):v==="petugas_mapping"?e.jsx(Pa,{}):v==="analisa"||v==="analisa_all"?e.jsx(pa,{},"analisa_all"):v==="analisa_review"?e.jsx(pa,{ocrStatusFilter:"REVIEW"},"analisa_review"):e.jsx(Ma,{})})})]})}_a.createRoot(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(Ba,{})}));
